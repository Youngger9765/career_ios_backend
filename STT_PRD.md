# STT_PRD.md - Realtime STT Counseling ç”¢å“éœ€æ±‚æ–‡ä»¶

---

## 1. å°ˆæ¡ˆæ¦‚è¿°

### 1.1 åŠŸèƒ½åç¨±
**Realtime STT Counseling**ï¼ˆå³æ™‚èªéŸ³è½‰æ–‡å­—è«®è©¢è¼”åŠ©ï¼‰

### 1.2 ç›®æ¨™
- **ä¸»è¦ç›®çš„**: å±•ç¤ºçµ¦è€é—†ï¼Œè­‰æ˜ AI è¼”åŠ©è«®è©¢çš„å¯è¡Œæ€§
- **ä½¿ç”¨å ´æ™¯**: è«®è©¢å¸«åœ¨è«®è©¢éç¨‹ä¸­ä½¿ç”¨ï¼Œç²å¾—å³æ™‚ AI ç£å°å»ºè­°
- **éšæ®µå®šä½**: Prototype å±•ç¤ºï¼ˆä¸ç¶å®š Auth/Sessionï¼Œä¸å„²å­˜åˆ°è³‡æ–™åº«ï¼‰

### 1.3 ä½¿ç”¨è€…
- **ç›®æ¨™ç”¨æˆ¶**: è«®è©¢å¸«
- **ä½¿ç”¨æ–¹å¼**: å¯¦éš›è«®è©¢éç¨‹ä¸­é–‹å•Ÿç¶²é ï¼Œé–‹å§‹éŒ„éŸ³å³å¯ä½¿ç”¨
- **æŠ€è¡“è¦æ±‚**: ç¾ä»£ç€è¦½å™¨ï¼ˆChrome/Edge/Safariï¼‰+ éº¥å…‹é¢¨æ¬Šé™

---

## 2. æ ¸å¿ƒåŠŸèƒ½

### 2.1 å³æ™‚èªéŸ³è½‰æ–‡å­—ï¼ˆSTTï¼‰

#### æŠ€è¡“æ–¹æ¡ˆ
**é¸å®š**: AssemblyAI Realtime API

#### é¸æ“‡ç†ç”±
| å„ªå‹¢ | èªªæ˜ |
|------|------|
| âœ… Speaker Diarization | è‡ªå‹•å€åˆ†è«®è©¢å¸«/æ¡ˆä¸»çš„è²éŸ³ |
| âœ… å…è²»é¡åº¦å¤§ | $50 å…è²»é¡åº¦ = 17,000 åˆ†é˜ |
| âœ… ä½å»¶é² | å¹³å‡ 300ms å»¶é²ï¼ˆå¯æ¥å—ï¼‰ |
| âœ… åƒ¹æ ¼å¯¦æƒ  | $0.00283/åˆ†é˜ï¼ˆç´„ $0.17/å°æ™‚ï¼‰ |
| âœ… WebSocket API | é©åˆå³æ™‚ä¸²æµ |
| âœ… ä¸­è‹±æ–‡æ”¯æ´ | æ”¯æ´ç¹é«”ä¸­æ–‡å’Œè‹±æ–‡ |

#### æ›¿ä»£æ–¹æ¡ˆæ¯”è¼ƒ
| æ–¹æ¡ˆ | å„ªé» | ç¼ºé» | çµè«– |
|------|------|------|------|
| ElevenLabs Scribe v2 | å»¶é²ä½ï¼ˆ< 100msï¼‰ | âŒ ç„¡ Speaker Diarization | ä¸æ¡ç”¨ |
| Google Chirp 3 | é«˜æº–ç¢ºç‡ | âš ï¸ åƒ¹æ ¼è¼ƒé«˜ï¼ˆ$0.016/minï¼‰ | å‚™é¸ |
| OpenAI Whisper | é–‹æºå…è²» | âŒ éå³æ™‚ï¼ˆéœ€ä¸Šå‚³éŸ³æª”ï¼‰ | ä¸é©ç”¨ |

#### åŠŸèƒ½éœ€æ±‚
1. **å³æ™‚é€å­—ç¨¿é¡¯ç¤º**
   - é¡¯ç¤ºæœ€æ–° 30 ç§’çš„å°è©±
   - å€åˆ† Speaker Aï¼ˆè«®è©¢å¸«ï¼‰å’Œ Speaker Bï¼ˆæ¡ˆä¸»ï¼‰
   - è‡ªå‹•æ»¾å‹•åˆ°æœ€æ–°å…§å®¹

2. **éŸ³è¨Šè™•ç†**
   - æ¡æ¨£ç‡ï¼š16kHzï¼ˆAssemblyAI è¦æ±‚ï¼‰
   - æ ¼å¼ï¼šPCM16
   - ç·©è¡å€ï¼š100ms chunks

3. **éŒ¯èª¤è™•ç†**
   - éº¥å…‹é¢¨æ¬Šé™æ‹’çµ• â†’ æç¤ºç”¨æˆ¶æˆæ¬Š
   - WebSocket æ–·ç·š â†’ è‡ªå‹•é‡é€£ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰
   - API Key ç„¡æ•ˆ â†’ é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯

---

### 2.2 æ¯åˆ†é˜ AI åˆ†æ

#### è§¸ç™¼æ©Ÿåˆ¶
- **é »ç‡**: æ¯ 60 ç§’è§¸ç™¼ä¸€æ¬¡
- **è§¸ç™¼æ¢ä»¶**: è‡³å°‘æœ‰ 10 ç§’ä»¥ä¸Šçš„å°è©±å…§å®¹
- **è§¸ç™¼æ™‚æ©Ÿ**: èƒŒæ™¯è‡ªå‹•åŸ·è¡Œï¼Œä¸æ‰“æ–·éŒ„éŸ³

#### åˆ†æå…§å®¹

##### 2.2.1 å°è©±æ­¸ç´ï¼ˆSummaryï¼‰
- **æ ¼å¼**: 1-2 å¥ç°¡æ½”æ‘˜è¦
- **å…§å®¹**: æœ¬åˆ†é˜ä¸»è¦è¨è«–çš„è­°é¡Œæˆ–æƒ…ç·’
- **ç¯„ä¾‹**: "æ¡ˆä¸»è¡¨é”å°å·¥ä½œçš„ç„¦æ…®ï¼Œè«®è©¢å¸«å¼•å°æ¢ç´¢ç„¦æ…®ä¾†æº"

##### 2.2.2 æé†’äº‹é …ï¼ˆAlertsï¼‰
- **æ ¼å¼**: 3-5 é»é‡é»æé†’
- **é¡å‹**:
  - âš ï¸ æƒ…ç·’è­¦ç¤ºï¼ˆè‡ªæ®ºã€è‡ªå‚·æ„åœ–ï¼‰
  - âš ï¸ å€«ç†è­°é¡Œï¼ˆé›™é‡é—œä¿‚ã€ä¿å¯†ç•Œé™ï¼‰
  - âš ï¸ æŠ€è¡“æé†’ï¼ˆéåº¦è©®é‡‹ã€æ‰“æ–·æ¡ˆä¸»ï¼‰
- **ç¯„ä¾‹**:
  ```
  âš ï¸ æ¡ˆä¸»æåˆ°ã€Œæ´»è‘—æ²’æ„ç¾©ã€ï¼Œéœ€è©•ä¼°è‡ªæ®ºé¢¨éšª
  âš ï¸ è«®è©¢å¸«é€£çºŒæå•ï¼Œæœªçµ¦æ¡ˆä¸»å……åˆ†è¡¨é”ç©ºé–“
  ```

##### 2.2.3 å»ºè­°å›æ‡‰ï¼ˆSuggestionsï¼‰
- **æ ¼å¼**: 2-3 é»å…·é«”å»ºè­°
- **é¡å‹**:
  - ğŸ’¡ åŒç†å›æ‡‰å»ºè­°
  - ğŸ’¡ æ¢ç´¢æ€§å•å¥
  - ğŸ’¡ æŠ€è¡“ä»‹å…¥å»ºè­°
- **ç¯„ä¾‹**:
  ```
  ğŸ’¡ å»ºè­°ä½¿ç”¨åæ˜ æƒ…æ„Ÿï¼šã€Œè½èµ·ä¾†ä½ æ„Ÿåˆ°å¾ˆç„¡åŠ›...ã€
  ğŸ’¡ å¯æ¢ç´¢ï¼šã€Œé€™ç¨®æ„Ÿè¦ºæ˜¯å¾ä»€éº¼æ™‚å€™é–‹å§‹çš„ï¼Ÿã€
  ```

#### AI æ¨¡å‹é…ç½®
- **æ¨¡å‹**: Gemini 2.5 Flash
- **åŸå› **:
  - âœ… é€Ÿåº¦å¿«ï¼ˆ< 2 ç§’å›æ‡‰ï¼‰
  - âœ… æˆæœ¬ä½ï¼ˆé©åˆæ¯åˆ†é˜åˆ†æï¼‰
  - âœ… ä¸­æ–‡ç†è§£èƒ½åŠ›å¼·
- **Token é™åˆ¶**:
  - Input: æœ€å¤š 4000 tokensï¼ˆç´„ 3 åˆ†é˜å°è©±ï¼‰
  - Output: æœ€å¤š 1000 tokens

#### Prompt è¨­è¨ˆ

```
ä½ æ˜¯ä¸€ä½è³‡æ·±è«®è©¢ç£å°ï¼Œæ­£åœ¨è§€å¯Ÿä¸€å ´è«®è©¢æœƒè«‡ã€‚

**ç•¶å‰æ™‚æ®µ**: {time_range}
**å°è©±é€å­—ç¨¿**:
{transcript}

è«‹æä¾›ä»¥ä¸‹åˆ†æï¼š

1. **å°è©±æ­¸ç´**ï¼ˆ1-2 å¥ï¼‰
   - æœ¬åˆ†é˜çš„æ ¸å¿ƒè­°é¡Œæˆ–æƒ…ç·’

2. **æé†’äº‹é …**ï¼ˆ3-5 é»ï¼‰
   - è‡ªæ®º/è‡ªå‚·é¢¨éšªè©•ä¼°
   - å€«ç†è­°é¡Œï¼ˆä¿å¯†ã€é›™é‡é—œä¿‚ï¼‰
   - è«®è©¢æŠ€è¡“ç›²é»ï¼ˆéåº¦è©®é‡‹ã€æ‰“æ–·ï¼‰

3. **å»ºè­°å›æ‡‰**ï¼ˆ2-3 é»ï¼‰
   - åŒç†å›æ‡‰å»ºè­°
   - æ¢ç´¢æ€§å•å¥
   - æŠ€è¡“ä»‹å…¥å»ºè­°

**å›æ‡‰æ ¼å¼**ï¼ˆJSONï¼‰:
{
  "summary": "...",
  "alerts": ["...", "..."],
  "suggestions": ["...", "..."]
}
```

---

### 2.3 åˆ†æå¡ç‰‡æµ

#### å±•ç¤ºæ–¹å¼
- **ä½ˆå±€**: å‚ç›´æ™‚é–“è»¸ï¼ˆæœ€æ–°åœ¨ä¸Šï¼‰
- **å‹•ç•«**: æ–°å¡ç‰‡æ·¡å…¥ï¼ˆfade-in 300msï¼‰
- **æ»¾å‹•**: è‡ªå‹•æ»¾å‹•åˆ°æœ€æ–°å¡ç‰‡

#### å¡ç‰‡è¨­è¨ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ 0:00 - 1:00                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ ğŸ“ å°è©±æ­¸ç´                          â”‚
â”‚ æ¡ˆä¸»è¡¨é”å°å·¥ä½œçš„ç„¦æ…®ï¼Œè«®è©¢å¸«å¼•å°æ¢    â”‚
â”‚ ç´¢ç„¦æ…®ä¾†æº                           â”‚
â”‚                                     â”‚
â”‚ âš ï¸ æé†’äº‹é …                          â”‚
â”‚ â€¢ æ¡ˆä¸»æåˆ°ã€Œæ´»è‘—æ²’æ„ç¾©ã€ï¼Œéœ€è©•ä¼°è‡ª    â”‚
â”‚   æ®ºé¢¨éšª                             â”‚
â”‚ â€¢ è«®è©¢å¸«é€£çºŒæå•ï¼Œæœªçµ¦æ¡ˆä¸»å……åˆ†è¡¨é”    â”‚
â”‚   ç©ºé–“                               â”‚
â”‚                                     â”‚
â”‚ ğŸ’¡ å»ºè­°å›æ‡‰                          â”‚
â”‚ â€¢ å»ºè­°ä½¿ç”¨åæ˜ æƒ…æ„Ÿï¼šã€Œè½èµ·ä¾†ä½ æ„Ÿåˆ°    â”‚
â”‚   å¾ˆç„¡åŠ›...ã€                        â”‚
â”‚ â€¢ å¯æ¢ç´¢ï¼šã€Œé€™ç¨®æ„Ÿè¦ºæ˜¯å¾ä»€éº¼æ™‚å€™é–‹    â”‚
â”‚   å§‹çš„ï¼Ÿã€                           â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å¡ç‰‡å…§å®¹
| æ¬„ä½ | èªªæ˜ | ç¯„ä¾‹ |
|------|------|------|
| æ™‚é–“ç¯„åœ | æœ¬æ¬¡åˆ†æçš„æ™‚é–“å€é–“ | 0:00-1:00, 1:00-2:00 |
| å°è©±æ­¸ç´ | 1-2 å¥æ‘˜è¦ | "æ¡ˆä¸»è¡¨é”å°å·¥ä½œçš„ç„¦æ…®..." |
| æé†’äº‹é … | 3-5 é»é‡é»ï¼ˆâš ï¸ åœ–ç¤ºï¼‰ | â€¢ è©•ä¼°è‡ªæ®ºé¢¨éšª<br>â€¢ æ³¨æ„å€«ç†ç•Œé™ |
| å»ºè­°å›æ‡‰ | 2-3 é»å»ºè­°ï¼ˆğŸ’¡ åœ–ç¤ºï¼‰ | â€¢ åæ˜ æƒ…æ„Ÿ<br>â€¢ æ¢ç´¢æ€§å•å¥ |

#### æ­·å²è¨˜éŒ„
- **å„²å­˜æ–¹å¼**: localStorageï¼ˆå‰ç«¯æš«å­˜ï¼‰
- **è³‡æ–™çµæ§‹**:
  ```json
  {
    "session_id": "2025-12-06-001",
    "start_time": "2025-12-06T10:00:00Z",
    "cards": [
      {
        "time_range": "0:00-1:00",
        "summary": "...",
        "alerts": ["...", "..."],
        "suggestions": ["...", "..."],
        "timestamp": "2025-12-06T10:01:00Z"
      }
    ]
  }
  ```
- **ä¿ç•™æ™‚é–“**: æœ¬åœ°ç€è¦½å™¨ä¿ç•™ï¼ˆæ¸…é™¤å¿«å–å³æ¶ˆå¤±ï¼‰
- **åŒ¯å‡ºåŠŸèƒ½**: è¤‡è£½ç‚º Markdown æ ¼å¼

---

## 3. æŠ€è¡“æ¶æ§‹

### 3.1 å‰ç«¯æ¶æ§‹

#### 3.1.1 é é¢
- **è·¯å¾‘**: `/realtime-counseling`
- **æª”æ¡ˆ**: `app/static/realtime_counseling.html`
- **é¡å‹**: ç¨ç«‹ HTMLï¼ˆä¸ä¾è³´æ¡†æ¶ï¼‰

#### 3.1.2 æŠ€è¡“æ£§
| æŠ€è¡“ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Vanilla JavaScript | ES6+ | æ ¸å¿ƒé‚è¼¯ |
| TailwindCSS | 3.4+ (CDN) | æ¨£å¼ |
| AssemblyAI SDK | Latest (CDN) | WebSocket ä¸²æµ |
| LocalStorage API | Native | æ­·å²è¨˜éŒ„ |

#### 3.1.3 åŠŸèƒ½æ¨¡çµ„

##### æ¨¡çµ„ 1: éº¥å…‹é¢¨éŒ„éŸ³æ§åˆ¶
```javascript
class AudioRecorder {
  async start() {
    // è«‹æ±‚éº¥å…‹é¢¨æ¬Šé™
    // åˆå§‹åŒ– MediaRecorder
    // é€£æ¥ AssemblyAI WebSocket
  }

  stop() {
    // åœæ­¢éŒ„éŸ³
    // é—œé–‰ WebSocket
    // ä¿å­˜æ­·å²è¨˜éŒ„
  }

  onTranscript(callback) {
    // æ¥æ”¶å³æ™‚é€å­—ç¨¿
  }
}
```

##### æ¨¡çµ„ 2: å³æ™‚é€å­—ç¨¿é¡¯ç¤º
```javascript
class TranscriptDisplay {
  append(speaker, text) {
    // æ·»åŠ æ–°é€å­—ç¨¿
    // å€åˆ† Speaker A/B
    // è‡ªå‹•æ»¾å‹•
  }

  clear() {
    // æ¸…é™¤é¡¯ç¤º
  }
}
```

##### æ¨¡çµ„ 3: æ¯åˆ†é˜åˆ†æè§¸ç™¼
```javascript
class AnalysisTrigger {
  constructor(intervalMs = 60000) {
    this.interval = intervalMs;
    this.buffer = [];
  }

  addTranscript(text) {
    this.buffer.push(text);
  }

  async triggerAnalysis() {
    // æ”¶é›†éå» 1 åˆ†é˜é€å­—ç¨¿
    // å‘¼å«å¾Œç«¯ API
    // è¿”å›åˆ†æçµæœ
  }
}
```

##### æ¨¡çµ„ 4: å‹•æ…‹å¡ç‰‡æµ
```javascript
class CardStream {
  addCard(data) {
    // å‰µå»ºæ–°å¡ç‰‡
    // æ·¡å…¥å‹•ç•«
    // è‡ªå‹•æ»¾å‹•
  }

  exportMarkdown() {
    // åŒ¯å‡ºç‚º Markdown
  }
}
```

##### æ¨¡çµ„ 5: æ­·å²è¨˜éŒ„ç®¡ç†
```javascript
class HistoryManager {
  save(sessionData) {
    localStorage.setItem('realtime_history', JSON.stringify(sessionData));
  }

  load() {
    return JSON.parse(localStorage.getItem('realtime_history') || '[]');
  }

  clear() {
    localStorage.removeItem('realtime_history');
  }
}
```

#### 3.1.4 UI ä½ˆå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ™ï¸ Realtime STT Counseling      [åœæ­¢éŒ„éŸ³] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ å³æ™‚é€å­—ç¨¿       â”‚  â”‚ AI åˆ†æå¡ç‰‡æµ    â”‚   â”‚
â”‚ â”‚                 â”‚  â”‚                 â”‚   â”‚
â”‚ â”‚ Speaker A: ...  â”‚  â”‚ [å¡ç‰‡ 3]        â”‚   â”‚
â”‚ â”‚ Speaker B: ...  â”‚  â”‚ [å¡ç‰‡ 2]        â”‚   â”‚
â”‚ â”‚ Speaker A: ...  â”‚  â”‚ [å¡ç‰‡ 1]        â”‚   â”‚
â”‚ â”‚                 â”‚  â”‚                 â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚ [é–‹å§‹éŒ„éŸ³] [æ¸…é™¤æ­·å²] [åŒ¯å‡º Markdown]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3.2 å¾Œç«¯ API

#### 3.2.1 API Endpoint

```
POST /api/v1/realtime/analyze
```

#### 3.2.2 Request Schema

```json
{
  "transcript": "å®Œæ•´é€å­—ç¨¿ï¼ˆéå» 1 åˆ†é˜ï¼‰",
  "speakers": [
    {
      "speaker": "counselor",
      "text": "è«®è©¢å¸«èªªçš„è©±",
      "timestamp": "0:30"
    },
    {
      "speaker": "client",
      "text": "æ¡ˆä¸»èªªçš„è©±",
      "timestamp": "0:45"
    }
  ],
  "time_range": "0:00-1:00"
}
```

#### 3.2.3 Response Schema

```json
{
  "summary": "å°è©±æ­¸ç´ï¼ˆ1-2 å¥ï¼‰",
  "alerts": [
    "æé†’äº‹é … 1",
    "æé†’äº‹é … 2",
    "æé†’äº‹é … 3"
  ],
  "suggestions": [
    "å»ºè­°å›æ‡‰ 1",
    "å»ºè­°å›æ‡‰ 2"
  ],
  "time_range": "0:00-1:00",
  "timestamp": "2025-12-06T10:01:00Z"
}
```

#### 3.2.4 éŒ¯èª¤è™•ç†

| HTTP Status | éŒ¯èª¤é¡å‹ | è™•ç†æ–¹å¼ |
|-------------|----------|----------|
| 400 | è«‹æ±‚æ ¼å¼éŒ¯èª¤ | è¿”å›è©³ç´°éŒ¯èª¤è¨Šæ¯ |
| 500 | Gemini API å¤±æ•— | è¿”å›é™ç´šå›æ‡‰ï¼ˆæ‘˜è¦ onlyï¼‰ |
| 503 | æœå‹™æš«æ™‚ä¸å¯ç”¨ | å‰ç«¯é‡è©¦ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰ |

#### 3.2.5 ä¸éœ€è¦çš„åŠŸèƒ½
- âŒ ä¸éœ€è¦ Authï¼ˆç„¡éœ€ç™»å…¥ï¼‰
- âŒ ä¸éœ€è¦ Session ç¶å®šï¼ˆä¸é—œè¯æ¡ˆä¾‹ï¼‰
- âŒ ä¸éœ€è¦ DB å„²å­˜ï¼ˆåƒ…å‰ç«¯æš«å­˜ï¼‰
- âŒ ä¸éœ€è¦ Rate Limitingï¼ˆPrototype éšæ®µï¼‰

---

### 3.3 æœå‹™å±¤è¨­è¨ˆ

#### 3.3.1 RealtimeAnalysisService

```python
class RealtimeAnalysisService:
    """å³æ™‚åˆ†ææœå‹™"""

    def __init__(self, gemini_service: GeminiService):
        self.gemini = gemini_service

    async def analyze_transcript(
        self,
        transcript: str,
        speakers: List[Speaker],
        time_range: str
    ) -> AnalysisResult:
        """åˆ†æé€å­—ç¨¿ï¼Œè¿”å›ç£å°å»ºè­°"""

        # 1. æ§‹å»º Prompt
        prompt = self._build_prompt(transcript, speakers, time_range)

        # 2. å‘¼å« Gemini
        response = await self.gemini.generate_text(
            prompt=prompt,
            model="gemini-2.5-flash",
            max_tokens=1000,
            temperature=0.7
        )

        # 3. è§£æå›æ‡‰
        result = self._parse_response(response)

        # 4. è¿”å›çµæœ
        return AnalysisResult(
            summary=result["summary"],
            alerts=result["alerts"],
            suggestions=result["suggestions"],
            time_range=time_range,
            timestamp=datetime.utcnow()
        )

    def _build_prompt(self, transcript: str, speakers: List[Speaker], time_range: str) -> str:
        """æ§‹å»ºç£å° Prompt"""
        # è©³ç´°å¯¦ä½œè¦‹ Prompt è¨­è¨ˆ

    def _parse_response(self, response: str) -> dict:
        """è§£æ Gemini å›æ‡‰ï¼ˆJSONï¼‰"""
        # è™•ç† JSON è§£æéŒ¯èª¤
        # è¿”å› dict
```

---

## 4. è³‡æ–™æµ

### 4.1 æ•´é«”æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éº¥å…‹é¢¨   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ PCM Audio (16kHz)
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AssemblyAI       â”‚
â”‚ WebSocket        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Realtime Transcript
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰ç«¯é¡¯ç¤ºé€å­—ç¨¿    â”‚
â”‚ (TranscriptDisplay)â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ æ¯ 60 ç§’
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç´¯ç©é€å­—ç¨¿       â”‚
â”‚ (AnalysisTrigger)â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ POST /api/v1/realtime/analyze
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¾Œç«¯ API         â”‚
â”‚ (RealtimeRouter) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Gemini åˆ†æ      â”‚
â”‚ (GeminiService)  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Analysis Result (JSON)
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰ç«¯é¡¯ç¤ºå¡ç‰‡     â”‚
â”‚ (CardStream)     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ localStorage     â”‚
â”‚ å„²å­˜æ­·å²         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æ™‚åºåœ–

```
User        Frontend       AssemblyAI      Backend        Gemini
 â”‚              â”‚              â”‚              â”‚             â”‚
 â”‚â”€ é»æ“ŠéŒ„éŸ³ â”€â”€â–¶â”‚              â”‚              â”‚             â”‚
 â”‚              â”‚â”€ è«‹æ±‚éº¥å…‹é¢¨ â”€â–¶â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚              â”‚             â”‚
 â”‚              â”‚â”€ WebSocket â”€â–¶â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚              â”‚             â”‚
 â”‚ èªªè©±ä¸­...    â”‚              â”‚              â”‚             â”‚
 â”‚              â”‚â—€â”€ Transcriptâ”€â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚              â”‚             â”‚
 â”‚              â”‚â”€ é¡¯ç¤ºé€å­—ç¨¿ â”€â–¶â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚              â”‚             â”‚
 â”‚ (60 ç§’å¾Œ)    â”‚              â”‚              â”‚             â”‚
 â”‚              â”‚â”€ POST /analyze â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚             â”‚
 â”‚              â”‚              â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚              â”‚â”€ Gemini â”€â”€â”€â–¶â”‚
 â”‚              â”‚              â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚              â”‚â—€â”€ Result â”€â”€â”€â”‚
 â”‚              â”‚              â”‚              â”‚             â”‚
 â”‚              â”‚â—€â”€ Analysis Result â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚
 â”‚              â”‚              â”‚              â”‚             â”‚
 â”‚              â”‚â”€ é¡¯ç¤ºå¡ç‰‡ â”€â”€â”€â–¶â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚              â”‚             â”‚
 â”‚              â”‚â”€ localStorageâ–¶â”‚              â”‚             â”‚
 â”‚              â”‚              â”‚              â”‚             â”‚
```

---

## 5. ç’°å¢ƒè®Šæ•¸

### 5.1 æ–°å¢ç’°å¢ƒè®Šæ•¸

```bash
# AssemblyAI API Keyï¼ˆç”¨æˆ¶éœ€è‡ªè¡Œç”³è«‹ï¼‰
ASSEMBLYAI_API_KEY=your_api_key_here
```

### 5.2 ç”³è«‹æ–¹å¼

1. å‰å¾€ [AssemblyAI](https://www.assemblyai.com/)
2. è¨»å†Šå…è²»å¸³è™Ÿ
3. å–å¾— API Keyï¼ˆ$50 å…è²»é¡åº¦ï¼‰
4. æ·»åŠ åˆ° `.env` æª”æ¡ˆ

### 5.3 é…ç½®æª”æ¡ˆ

```python
# app/core/config.py

class Settings(BaseSettings):
    # ... existing settings ...

    # AssemblyAI
    assemblyai_api_key: str = Field(
        ...,
        env="ASSEMBLYAI_API_KEY",
        description="AssemblyAI API Key"
    )
```

---

## 6. æª”æ¡ˆæ¸…å–®

### 6.1 å¾Œç«¯æª”æ¡ˆ

#### 6.1.1 Schemas
```
app/schemas/realtime.py
```
- `SpeakerSegment` - Speaker è³‡æ–™
- `AnalyzeRequest` - API è«‹æ±‚ schema
- `AnalysisResult` - API å›æ‡‰ schema

#### 6.1.2 Services
```
app/services/realtime_analysis_service.py
```
- `RealtimeAnalysisService` - æ ¸å¿ƒåˆ†ææœå‹™
- Prompt æ§‹å»ºé‚è¼¯
- Gemini å›æ‡‰è§£æ

#### 6.1.3 API Router
```
app/api/v1/realtime.py
```
- `POST /api/v1/realtime/analyze` - åˆ†æ endpoint
- éŒ¯èª¤è™•ç†
- å›æ‡‰æ ¼å¼åŒ–

#### 6.1.4 Tests
```
tests/integration/test_realtime_api.py
```
- å®Œæ•´ API æ¸¬è©¦
- TDD æµç¨‹

---

### 6.2 å‰ç«¯æª”æ¡ˆ

```
app/static/realtime_counseling.html
```

å®Œæ•´åŠŸèƒ½ï¼š
- éº¥å…‹é¢¨éŒ„éŸ³æ§åˆ¶
- AssemblyAI WebSocket æ•´åˆ
- å³æ™‚é€å­—ç¨¿é¡¯ç¤º
- æ¯åˆ†é˜åˆ†æè§¸ç™¼
- å‹•æ…‹å¡ç‰‡æµ
- localStorage æ­·å²è¨˜éŒ„
- Markdown åŒ¯å‡º

---

### 6.3 æ–‡æª”æª”æ¡ˆ

```
STT_PRD.md
```
- æœ¬ç”¢å“éœ€æ±‚æ–‡ä»¶

---

## 7. éåŠŸèƒ½éœ€æ±‚

### 7.1 æ•ˆèƒ½éœ€æ±‚

| æŒ‡æ¨™ | ç›®æ¨™ | æ¸¬é‡æ–¹å¼ |
|------|------|----------|
| STT å»¶é² | < 500ms | AssemblyAI å›å ±å»¶é² |
| API å›æ‡‰ | < 3s | å¾Œç«¯æ—¥èªŒ |
| å‰ç«¯æ¸²æŸ“ | < 100ms | Chrome DevTools |
| å¡ç‰‡æ·¡å…¥ | 300ms | CSS animation |

### 7.2 å¯ç”¨æ€§éœ€æ±‚

#### 7.2.1 éŸ¿æ‡‰å¼è¨­è¨ˆ
- **æ¡Œé¢**ï¼šé›™æ¬„ä½ˆå±€ï¼ˆé€å­—ç¨¿ + å¡ç‰‡æµï¼‰
- **å¹³æ¿**ï¼šå–®æ¬„ä½ˆå±€ï¼ˆå¯åˆ‡æ›ï¼‰
- **æ‰‹æ©Ÿ**ï¼šå–®æ¬„ä½ˆå±€ï¼ˆå‚ç›´æ»¾å‹•ï¼‰

#### 7.2.2 UI è¨­è¨ˆåŸå‰‡
- **å°ˆæ¥­æ„Ÿ**ï¼šç°¡æ½”ã€æ¸…çˆ½ã€å°ˆæ¥­
- **å¯è®€æ€§**ï¼šå­—é«”å¤§å°é©ä¸­ã€å°æ¯”åº¦é«˜
- **ä¸€è‡´æ€§**ï¼šèˆ‡ console.html é¢¨æ ¼ä¸€è‡´

#### 7.2.3 éŒ¯èª¤æç¤º
| éŒ¯èª¤é¡å‹ | æç¤ºè¨Šæ¯ | è™•ç†æ–¹å¼ |
|----------|----------|----------|
| éº¥å…‹é¢¨æ¬Šé™æ‹’çµ• | "è«‹å…è¨±éº¥å…‹é¢¨æ¬Šé™ä»¥ä½¿ç”¨éŒ„éŸ³åŠŸèƒ½" | é¡¯ç¤ºæç¤º + å¼•å° |
| WebSocket æ–·ç·š | "é€£ç·šä¸­æ–·ï¼Œæ­£åœ¨é‡æ–°é€£æ¥..." | è‡ªå‹•é‡é€£ |
| API å¤±æ•— | "åˆ†ææš«æ™‚ç„¡æ³•ä½¿ç”¨ï¼Œè«‹ç¨å¾Œå†è©¦" | é¡¯ç¤ºé™ç´šè¨Šæ¯ |

### 7.3 å®‰å…¨éœ€æ±‚

- **API Key ä¿è­·**ï¼šå¾Œç«¯ç’°å¢ƒè®Šæ•¸ï¼Œä¸æš´éœ²åˆ°å‰ç«¯
- **CORS è¨­å®š**ï¼šé™åˆ¶å…è¨±çš„ä¾†æº
- **è³‡æ–™éš±ç§**ï¼šä¸å„²å­˜é€å­—ç¨¿åˆ°å¾Œç«¯ï¼Œåƒ…æš«å­˜å‰ç«¯

---

### 7.4 é–‹ç™¼è¦ç¯„

#### 7.4.1 TDD æµç¨‹
1. å…ˆå¯«æ¸¬è©¦ï¼ˆREDï¼‰
2. å¯¦ä½œä»£ç¢¼ï¼ˆGREENï¼‰
3. é‡æ§‹å„ªåŒ–ï¼ˆREFACTORï¼‰

#### 7.4.2 æª”æ¡ˆå¤§å°é™åˆ¶
- API Router: < 300 è¡Œ
- Service: < 400 è¡Œ
- å‰ç«¯ HTML: < 800 è¡Œ

#### 7.4.3 æ¸¬è©¦è¦æ±‚
- âœ… 100% API æ¸¬è©¦é€šé
- âœ… éŒ¯èª¤è™•ç†æ¸¬è©¦
- âœ… Edge case æ¸¬è©¦

#### 7.4.4 ç¨‹å¼ç¢¼å“è³ª
- âœ… Ruff linting é€šé
- âœ… é¡å‹æç¤ºå®Œæ•´
- âœ… æ–‡æª”å­—ä¸²å®Œæ•´

---

## 8. æˆåŠŸæ¨™æº–

### 8.1 å±•ç¤ºéšæ®µæˆåŠŸæ¨™æº–

#### åŸºæœ¬åŠŸèƒ½
- âœ… è«®è©¢å¸«å¯ä»¥é–‹å§‹éŒ„éŸ³
- âœ… å³æ™‚é¡¯ç¤ºé€å­—ç¨¿ï¼ˆå€åˆ†èº«ä»½ï¼‰
- âœ… æ¯åˆ†é˜è‡ªå‹•åˆ†æ
- âœ… å¡ç‰‡æµé †æš¢é¡¯ç¤º
- âœ… æ­·å²è¨˜éŒ„å¯æŸ¥çœ‹

#### ä½¿ç”¨è€…é«”é©—
- âœ… UI æ¸…çˆ½å°ˆæ¥­
- âœ… æ“ä½œç›´è¦ºç°¡å–®
- âœ… éŒ¯èª¤æç¤ºå‹å–„
- âœ… éŸ¿æ‡‰å¼è¨­è¨ˆæ­£å¸¸

#### å±•ç¤ºæ•ˆæœ
- âœ… è€é—†èƒ½ç†è§£åŠŸèƒ½
- âœ… å±•ç¤ºæµæš¢ä¸å¡é “
- âœ… AI å»ºè­°æœ‰åƒ¹å€¼

---

### 8.2 æŠ€è¡“æ¨™æº–

#### æ¸¬è©¦é€šé
- âœ… æ‰€æœ‰ integration tests é€šé
- âœ… API å›æ‡‰æ ¼å¼æ­£ç¢º
- âœ… éŒ¯èª¤è™•ç†æ­£å¸¸

#### ç¨‹å¼ç¢¼å“è³ª
- âœ… Ruff linting é€šé
- âœ… ç„¡ console éŒ¯èª¤
- âœ… ç„¡ TypeScript éŒ¯èª¤ï¼ˆå¦‚ä½¿ç”¨ï¼‰

#### æ•ˆèƒ½é”æ¨™
- âœ… API å›æ‡‰ < 3s
- âœ… STT å»¶é² < 500ms
- âœ… å‰ç«¯æ¸²æŸ“æµæš¢

---

## 9. é¢¨éšªèˆ‡é™åˆ¶

### 9.1 é¢¨éšªåˆ†æ

| é¢¨éšª | å½±éŸ¿ | æ©Ÿç‡ | ç·©è§£æªæ–½ |
|------|------|------|----------|
| AssemblyAI API Key éœ€è‡ªè¡Œç”³è«‹ | é«˜ | 100% | æä¾›æ¸…æ¥šç”³è«‹æŒ‡å¼• |
| éº¥å…‹é¢¨æ¬Šé™è¢«æ‹’çµ• | é«˜ | 30% | æç¤ºç”¨æˆ¶æˆæ¬Šï¼Œæä¾›å¼•å° |
| ç¶²è·¯å»¶é²å½±éŸ¿é«”é©— | ä¸­ | 40% | é¡¯ç¤º loading ç‹€æ…‹ï¼Œè¨­å®š timeout |
| Gemini API å¯èƒ½å¤±æ•— | ä¸­ | 10% | é™ç´šå›æ‡‰ï¼ˆåƒ…æ‘˜è¦ï¼‰ï¼Œé‡è©¦æ©Ÿåˆ¶ |
| Speaker Diarization ä¸æº– | ä½ | 20% | å…è¨±æ‰‹å‹•ä¿®æ­£ï¼ˆPhase 2ï¼‰ |

### 9.2 é™åˆ¶èªªæ˜

#### åŠŸèƒ½é™åˆ¶
1. **ä¸æ”¯æ´é›¢ç·šä½¿ç”¨**
   - éœ€è¦ç¶²è·¯é€£ç·š
   - ä¾è³´å¤–éƒ¨ API

2. **ä¸å„²å­˜æ­·å²åˆ° DB**
   - åƒ…å‰ç«¯ localStorage
   - æ¸…é™¤å¿«å–å³æ¶ˆå¤±

3. **ä¸ç¶å®šæ¡ˆä¸»/æ¡ˆä¾‹è³‡æ–™**
   - ç¨ç«‹åŠŸèƒ½
   - ç„¡æ³•é—œè¯ç¾æœ‰è³‡æ–™

4. **åƒ…ä¾›å±•ç¤ºï¼Œéæ­£å¼ç’°å¢ƒ**
   - Prototype éšæ®µ
   - æœªç¶“å¤§è¦æ¨¡æ¸¬è©¦

#### æŠ€è¡“é™åˆ¶
1. **AssemblyAI å…è²»é¡åº¦**
   - $50 = 17,000 åˆ†é˜
   - è¶…ééœ€ä»˜è²»

2. **ç€è¦½å™¨ç›¸å®¹æ€§**
   - éœ€æ”¯æ´ WebSocket
   - éœ€æ”¯æ´ MediaRecorder API
   - å»ºè­°ä½¿ç”¨ Chrome/Edge

3. **èªè¨€æ”¯æ´**
   - ç›®å‰åƒ…ä¸­æ–‡ + è‹±æ–‡
   - å…¶ä»–èªè¨€éœ€æ¸¬è©¦

---

## 10. æœªä¾†æ“´å……

### 10.1 Phase 2ï¼ˆçŸ­æœŸï¼‰

#### ç¶å®šç¾æœ‰åŠŸèƒ½
- ğŸ”® é—œè¯ Session/Case
- ğŸ”® å„²å­˜åˆ†æè¨˜éŒ„åˆ° DB
- ğŸ”® é¡¯ç¤ºæ­·å²æœƒè«‡åˆ†æ

#### å¤šèªè¨€æ”¯æ´
- ğŸ”® è‹±æ–‡ã€æ—¥æ–‡ã€éŸ“æ–‡
- ğŸ”® èªè¨€è‡ªå‹•åµæ¸¬

#### èªéŸ³å›æ‡‰ï¼ˆTTSï¼‰
- ğŸ”® AI å»ºè­°èªéŸ³æ’­æ”¾
- ğŸ”® è«®è©¢å¸«å¯é¸æ“‡æ’­æ”¾å»ºè­°

---

### 10.2 Phase 3ï¼ˆä¸­æœŸï¼‰

#### æƒ…ç·’åˆ†æ
- ğŸ”® åµæ¸¬æƒ…ç·’è®ŠåŒ–
- ğŸ”® è¦–è¦ºåŒ–æƒ…ç·’æ›²ç·š
- ğŸ”® æƒ…ç·’è­¦ç¤º

#### é—œéµè©æé†’
- ğŸ”® è‡ªè¨‚é—œéµè©ï¼ˆå¦‚ã€Œè‡ªæ®ºã€ã€Œå®¶æš´ã€ï¼‰
- ğŸ”® å³æ™‚å½ˆå‡ºæé†’
- ğŸ”® é—œéµè©çµ±è¨ˆ

#### æœƒè«‡å“è³ªè©•ä¼°
- ğŸ”® è«®è©¢æŠ€è¡“ä½¿ç”¨åˆ†æ
- ğŸ”® èªªè©±æ™‚é–“æ¯”ä¾‹
- ğŸ”® æå•é¡å‹åˆ†æ

---

### 10.3 Phase 4ï¼ˆé•·æœŸï¼‰

#### AI å³æ™‚å»ºè­°ï¼ˆ< 5sï¼‰
- ğŸ”® å³æ™‚å›æ‡‰å»ºè­°ï¼ˆä¸ç­‰ 60 ç§’ï¼‰
- ğŸ”® æ ¹æ“šå°è©±è„ˆçµ¡èª¿æ•´
- ğŸ”® å­¸ç¿’è«®è©¢å¸«é¢¨æ ¼

#### è«®è©¢å“è³ªè©•ä¼°
- ğŸ”® æœƒè«‡å¾Œç”Ÿæˆå®Œæ•´è©•ä¼°å ±å‘Š
- ğŸ”® æŠ€è¡“ä½¿ç”¨è©•åˆ†
- ğŸ”® æ”¹é€²å»ºè­°

#### ç£å°å ±å‘Šç”Ÿæˆ
- ğŸ”® è‡ªå‹•ç”Ÿæˆç£å°å ±å‘Š
- ğŸ”® é‡é»ç‰‡æ®µæ‘˜éŒ„
- ğŸ”® æˆé•·è»Œè·¡è¿½è¹¤

---

## 11. é–‹ç™¼æ™‚ç¨‹

### 11.1 Phase 1: å¾Œç«¯ APIï¼ˆ4 å°æ™‚ï¼‰

#### æ¸¬è©¦éšæ®µï¼ˆ1 å°æ™‚ï¼‰
- [ ] å»ºç«‹æ¸¬è©¦æª”æ¡ˆ `tests/integration/test_realtime_api.py`
- [ ] å¯«æ¸¬è©¦ï¼šåˆ†æ APIï¼ˆhappy pathï¼‰
- [ ] å¯«æ¸¬è©¦ï¼šéŒ¯èª¤è™•ç†ï¼ˆç„¡æ•ˆè¼¸å…¥ã€API å¤±æ•—ï¼‰
- [ ] è·‘æ¸¬è©¦ç¢ºèª RED

#### å¯¦ä½œéšæ®µï¼ˆ2 å°æ™‚ï¼‰
- [ ] å»ºç«‹ Schemas (`app/schemas/realtime.py`)
- [ ] å»ºç«‹ Service (`app/services/realtime_analysis_service.py`)
- [ ] å»ºç«‹ Router (`app/api/v1/realtime.py`)
- [ ] Prompt è¨­è¨ˆèˆ‡èª¿æ•´
- [ ] è·‘æ¸¬è©¦ç¢ºèª GREEN

#### æ•´åˆéšæ®µï¼ˆ1 å°æ™‚ï¼‰
- [ ] æ•´åˆåˆ° main router
- [ ] æ¸¬è©¦å®Œæ•´æµç¨‹
- [ ] Ruff linting
- [ ] Commit & Push

---

### 11.2 Phase 2: å‰ç«¯é é¢ï¼ˆ4 å°æ™‚ï¼‰

#### åŸºç¤ UIï¼ˆ1 å°æ™‚ï¼‰
- [ ] å»ºç«‹ `realtime_counseling.html`
- [ ] TailwindCSS ä½ˆå±€
- [ ] åŸºç¤çµ„ä»¶ï¼ˆæŒ‰éˆ•ã€å¡ç‰‡ã€é€å­—ç¨¿ï¼‰

#### AssemblyAI æ•´åˆï¼ˆ2 å°æ™‚ï¼‰
- [ ] éº¥å…‹é¢¨æ¬Šé™è«‹æ±‚
- [ ] WebSocket é€£æ¥
- [ ] å³æ™‚é€å­—ç¨¿é¡¯ç¤º
- [ ] Speaker Diarization

#### å¡ç‰‡æµå¯¦ä½œï¼ˆ1 å°æ™‚ï¼‰
- [ ] æ¯åˆ†é˜è§¸ç™¼åˆ†æ
- [ ] å‹•æ…‹å¡ç‰‡ç”Ÿæˆ
- [ ] localStorage å„²å­˜
- [ ] Markdown åŒ¯å‡º

---

### 11.3 Phase 3: æ¸¬è©¦èˆ‡å„ªåŒ–ï¼ˆ2 å°æ™‚ï¼‰

#### å®Œæ•´æ¸¬è©¦ï¼ˆ1 å°æ™‚ï¼‰
- [ ] å®Œæ•´æµç¨‹æ¸¬è©¦ï¼ˆéŒ„éŸ³ â†’ åˆ†æ â†’ å¡ç‰‡ï¼‰
- [ ] éŒ¯èª¤è™•ç†æ¸¬è©¦ï¼ˆæ–·ç·šã€API å¤±æ•—ï¼‰
- [ ] è·¨ç€è¦½å™¨æ¸¬è©¦ï¼ˆChromeã€Safariï¼‰

#### UI/UX èª¿æ•´ï¼ˆ1 å°æ™‚ï¼‰
- [ ] éŸ¿æ‡‰å¼èª¿æ•´
- [ ] å‹•ç•«å„ªåŒ–
- [ ] éŒ¯èª¤æç¤ºå„ªåŒ–
- [ ] è¼‰å…¥ç‹€æ…‹å„ªåŒ–

---

### 11.4 ç¸½æ™‚ç¨‹

**ç¸½è¨ˆ**: ç´„ 10 å°æ™‚ï¼ˆ2 å¤©å…§å®Œæˆï¼‰

| éšæ®µ | æ™‚é–“ | ç”¢å‡º |
|------|------|------|
| Phase 1 | 4 å°æ™‚ | å¾Œç«¯ API + æ¸¬è©¦ |
| Phase 2 | 4 å°æ™‚ | å‰ç«¯å®Œæ•´é é¢ |
| Phase 3 | 2 å°æ™‚ | æ¸¬è©¦èˆ‡å„ªåŒ– |
| **ç¸½è¨ˆ** | **10 å°æ™‚** | **å¯å±•ç¤º Prototype** |

---

## 12. åƒè€ƒè³‡æ–™

### 12.1 æŠ€è¡“æ–‡æª”
- [AssemblyAI Realtime API](https://www.assemblyai.com/docs/api-reference/realtime)
- [AssemblyAI Speaker Diarization](https://www.assemblyai.com/docs/speech-to-text/speaker-diarization)
- [Gemini API Documentation](https://ai.google.dev/gemini-api/docs)
- [Web Audio API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API)

### 12.2 ç¾æœ‰ç¨‹å¼ç¢¼åƒè€ƒ
- `app/static/console.html` - UI é¢¨æ ¼åƒè€ƒ
- `app/api/v1/sessions.py` - API çµæ§‹åƒè€ƒ
- `app/services/gemini_service.py` - Gemini æ•´åˆåƒè€ƒ

### 12.3 è«®è©¢ç†è«–åƒè€ƒ
- Carl Rogers - Person-Centered Therapyï¼ˆåŒç†å›æ‡‰ï¼‰
- Motivational Interviewingï¼ˆå‹•æ©Ÿå¼æ™¤è«‡ï¼‰
- Solution-Focused Brief Therapyï¼ˆç„¦é»è§£æ±ºçŸ­æœŸæ²»ç™‚ï¼‰

---

## 13. é™„éŒ„

### 13.1 Prompt å®Œæ•´ç¯„ä¾‹

```
ä½ æ˜¯ä¸€ä½è³‡æ·±è«®è©¢ç£å°ï¼Œæ­£åœ¨è§€å¯Ÿä¸€å ´è«®è©¢æœƒè«‡ã€‚

**ç•¶å‰æ™‚æ®µ**: 1:00-2:00
**å°è©±é€å­—ç¨¿**:

Speaker A (è«®è©¢å¸«): ä½ å‰›å‰›æåˆ°å·¥ä½œè®“ä½ æ„Ÿåˆ°å¾ˆç„¦æ…®ï¼Œèƒ½å¤šèªªä¸€äº›å—ï¼Ÿ
Speaker B (æ¡ˆä¸»): å—¯...æˆ‘è¦ºå¾—è‡ªå·±å¥½åƒåšä»€éº¼éƒ½ä¸å°ï¼Œä¸»ç®¡ç¸½æ˜¯åœ¨ç›¯è‘—æˆ‘ã€‚
Speaker A: è½èµ·ä¾†ä½ æ„Ÿå—åˆ°å¾ˆå¤§çš„å£“åŠ›ã€‚
Speaker B: å°ï¼Œæˆ‘æœ‰æ™‚å€™æœƒæƒ³ï¼Œæ´»è‘—åˆ°åº•æœ‰ä»€éº¼æ„ç¾©...
Speaker A: ä½ èªªã€Œæ´»è‘—æ²’æ„ç¾©ã€ï¼Œé€™æ˜¯æœ€è¿‘æ‰æœ‰çš„æƒ³æ³•å—ï¼Ÿ

è«‹æä¾›ä»¥ä¸‹åˆ†æï¼š

1. **å°è©±æ­¸ç´**ï¼ˆ1-2 å¥ï¼‰
   - æœ¬åˆ†é˜çš„æ ¸å¿ƒè­°é¡Œæˆ–æƒ…ç·’

2. **æé†’äº‹é …**ï¼ˆ3-5 é»ï¼‰
   - è‡ªæ®º/è‡ªå‚·é¢¨éšªè©•ä¼°
   - å€«ç†è­°é¡Œï¼ˆä¿å¯†ã€é›™é‡é—œä¿‚ï¼‰
   - è«®è©¢æŠ€è¡“ç›²é»ï¼ˆéåº¦è©®é‡‹ã€æ‰“æ–·ï¼‰

3. **å»ºè­°å›æ‡‰**ï¼ˆ2-3 é»ï¼‰
   - åŒç†å›æ‡‰å»ºè­°
   - æ¢ç´¢æ€§å•å¥
   - æŠ€è¡“ä»‹å…¥å»ºè­°

**å›æ‡‰æ ¼å¼**ï¼ˆJSONï¼‰:
{
  "summary": "æ¡ˆä¸»è¡¨é”å·¥ä½œç„¦æ…®ï¼Œæåˆ°ã€Œæ´»è‘—æ²’æ„ç¾©ã€ï¼Œè«®è©¢å¸«é–‹å§‹è©•ä¼°è‡ªæ®ºé¢¨éšª",
  "alerts": [
    "âš ï¸ æ¡ˆä¸»æåˆ°ã€Œæ´»è‘—æ²’æ„ç¾©ã€ï¼Œéœ€ç«‹å³è©•ä¼°è‡ªæ®ºé¢¨éšªï¼ˆæ„åœ–ã€è¨ˆç•«ã€æ‰‹æ®µï¼‰",
    "âš ï¸ æ³¨æ„æ¡ˆä¸»æƒ…ç·’ç‹€æ…‹ï¼Œæ˜¯å¦æœ‰æ†‚é¬±ç—‡ç‹€",
    "âœ… è«®è©¢å¸«ä½¿ç”¨åæ˜ æƒ…æ„ŸæŠ€å·§é©ç•¶"
  ],
  "suggestions": [
    "ğŸ’¡ å»ºè­°ç›´æ¥è©•ä¼°ï¼šã€Œç•¶ä½ èªªæ´»è‘—æ²’æ„ç¾©ï¼Œæ˜¯å¦æ›¾æƒ³éçµæŸç”Ÿå‘½ï¼Ÿã€",
    "ğŸ’¡ æ¢ç´¢å·¥ä½œå£“åŠ›ä¾†æºï¼šã€Œä¸»ç®¡ç›¯è‘—ä½ çš„æ„Ÿè¦ºï¼Œèƒ½å…·é«”èªªèªªæ˜¯ä»€éº¼æ¨£çš„æƒ…æ³å—ï¼Ÿã€",
    "ğŸ’¡ è©•ä¼°æ”¯æŒç³»çµ±ï¼šã€Œåœ¨é€™æ®µå›°é›£çš„æ™‚æœŸï¼Œæœ‰èª°æ˜¯ä½ å¯ä»¥æ±‚åŠ©çš„å°è±¡ï¼Ÿã€"
  ]
}
```

### 13.2 AssemblyAI WebSocket ç¯„ä¾‹

```javascript
const assemblyai = require('assemblyai');

const client = assemblyai.RealtimeTranscriber({
  token: 'YOUR_API_KEY',
  sampleRate: 16000,
  speakerLabels: true  // å•Ÿç”¨ Speaker Diarization
});

client.on('transcript', (transcript) => {
  if (transcript.message_type === 'FinalTranscript') {
    console.log('Speaker:', transcript.speaker);
    console.log('Text:', transcript.text);
  }
});

client.on('error', (error) => {
  console.error('Error:', error);
});

// é–‹å§‹éŒ„éŸ³
navigator.mediaDevices.getUserMedia({ audio: true })
  .then(stream => {
    const mediaRecorder = new MediaRecorder(stream);
    mediaRecorder.ondataavailable = (event) => {
      client.sendAudio(event.data);
    };
    mediaRecorder.start(100); // æ¯ 100ms ç™¼é€ä¸€æ¬¡
  });
```

---

## ç‰ˆæœ¬æ­·å²

| ç‰ˆæœ¬ | æ—¥æœŸ | è®Šæ›´èªªæ˜ | ä½œè€… |
|------|------|----------|------|
| v1.0 | 2025-12-06 | åˆç‰ˆå»ºç«‹ï¼ˆæŠ€è¡“é¸å‹ï¼šAssemblyAIï¼‰ | Claude |
| v1.1 | 2025-12-06 | æ”¹ç”¨ ElevenLabs Scribe v2 + æ‰‹å‹•èªªè©±è€…åˆ‡æ› | Claude |
| v1.2 | 2025-12-06 | Phase 1: Backend API å®Œæˆï¼ˆTDD æ–¹æ³•ï¼Œ11 testsï¼‰ | Claude |
| v2.0 | 2025-12-06 | Phase 2: å•†ç”¨ç´š UI å®Œæˆï¼ˆMobile RWD + Demo æ¨¡å¼ï¼‰ | Claude |

---

## æ–‡æª”ç‹€æ…‹

**ç•¶å‰ç‹€æ…‹**: âœ… Phase 2 Frontend Completedï¼ˆå‰ç«¯å®Œæˆï¼Œç­‰å¾… ElevenLabs API Keyï¼‰

**å¯©æ ¸æµç¨‹**:
- [x] Draftï¼ˆè‰ç¨¿ï¼‰
- [x] Reviewï¼ˆå¯©æ ¸ä¸­ï¼‰
- [x] Approvedï¼ˆå·²æ ¸å‡†ï¼‰
- [x] Developmentï¼ˆé–‹ç™¼ä¸­ï¼‰
- [x] Frontend Completedï¼ˆå‰ç«¯å·²å®Œæˆï¼‰
- [ ] Full Integrationï¼ˆå®Œæ•´æ•´åˆ - éœ€ API Keyï¼‰

---

**END OF DOCUMENT**
