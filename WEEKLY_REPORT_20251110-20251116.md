# 週報 - 2025/11/10 - 2025/11/16

## 📊 本週完成項目

### 1. Client & Case Management API 完整實作 👥⭐⭐⭐⭐⭐

**核心功能**：
完整的客戶與個案管理系統，支援 CRUD 操作。

#### Clients API (客戶管理)
```
GET    /api/v1/clients          → 列出客戶（支援分頁）
POST   /api/v1/clients          → 建立客戶
GET    /api/v1/clients/{id}     → 查看客戶
PATCH  /api/v1/clients/{id}     → 更新客戶
DELETE /api/v1/clients/{id}     → 刪除客戶（軟刪除）
```

#### Cases API (個案管理)
```
GET    /api/v1/cases            → 列出個案（可按 client_id 過濾）
POST   /api/v1/cases            → 建立個案
GET    /api/v1/cases/{id}       → 查看個案
PATCH  /api/v1/cases/{id}       → 更新個案
DELETE /api/v1/cases/{id}       → 刪除個案（軟刪除）
```

**自動編號功能**：
- 客戶編號：`C0001`, `C0002`, `C0003`...
- 個案編號：`CASE0001`, `CASE0002`, `CASE0003`...
- ✅ 自動遞增，無需手動輸入

**對案主的價值**：
- 📋 完整的客戶資料管理
- 📋 個案追蹤與狀態管理
- 📋 支援動態欄位（每個租戶可自訂）

**詳細文檔**：
- `API_CLIENT_CASE_MANAGEMENT.md` - 78 頁完整 API 文件

---

### 2. Session Recordings 分段錄音功能 🎤⭐⭐⭐⭐⭐

**問題背景**：
諮商師在會談過程中可能多次暫停錄音，產生多個音訊檔案。

**舊版做法**（不便）：
- iOS App 需自己拼接音訊
- 或手動合併逐字稿

**新版功能**：
支援上傳多段錄音逐字稿，後端自動聚合！

#### 使用方式（兩種模式）

**模式 1：上傳分段錄音逐字稿**（推薦）
```json
{
  "case_id": "uuid",
  "session_date": "2024-11-15",
  "recordings": [
    {
      "segment_number": 1,
      "start_time": "2024-11-15 10:00:00",
      "end_time": "2024-11-15 10:15:00",
      "duration_seconds": 900,
      "transcript_text": "第一段逐字稿內容..."
    },
    {
      "segment_number": 2,
      "start_time": "2024-11-15 10:20:00",
      "end_time": "2024-11-15 10:35:00",
      "duration_seconds": 900,
      "transcript_text": "第二段逐字稿內容..."
    }
  ]
}
```

**模式 2：直接上傳完整逐字稿**（傳統方式）
```json
{
  "case_id": "uuid",
  "session_date": "2024-11-15",
  "transcript": "完整的逐字稿內容..."
}
```

**自動聚合邏輯**：
- 後端自動將多段 `transcript_text` 合併成完整 `transcript`
- 保留原始分段資訊（可顯示錄音時間軸）

**對 iOS 開發者的價值**：
- ✅ 前端無需處理音訊拼接
- ✅ 支援錄音時間軸顯示
- ✅ 彈性支援兩種輸入模式

---

### 3. 諮商師反思系統 ✍️⭐⭐⭐⭐

**功能說明**：
諮商師可以在會談後記錄專業反思。

**API 端點**：
```
POST   /api/v1/sessions/{id}/reflection
PATCH  /api/v1/sessions/{id}/reflection
GET    /api/v1/sessions/{id}/reflection
```

**資料格式**（彈性 JSON）：
```json
{
  "overall_feeling": "本次會談案主情緒較為穩定...",
  "key_moments": [
    "案主提到與主管的衝突...",
    "談及童年經驗時情緒激動"
  ],
  "next_session_plan": "下次會談著重於情緒調節技巧",
  "supervisor_notes": "建議加強同理心回應"
}
```

**對案主的價值**：
- ✍️ 諮商師可記錄專業觀察
- ✍️ 支援督導回饋
- ✍️ 反思內容自動整合進報告

---

### 4. 會談時間軸 API 📅⭐⭐⭐

**功能說明**：
取得個案的完整會談歷程，適合在個案詳情頁顯示。

**API 端點**：
```
GET /api/v1/sessions/timeline?client_id={uuid}
```

**Response 範例**：
```json
{
  "total": 5,
  "items": [
    {
      "session_number": 1,
      "session_date": "2024-10-15",
      "start_time": "10:00",
      "end_time": "11:00",
      "duration_minutes": 60,
      "summary": "案主談及工作壓力...",
      "has_report": true,
      "report_id": "uuid"
    },
    {
      "session_number": 2,
      "session_date": "2024-10-22",
      ...
    }
  ]
}
```

**對 iOS 開發者的價值**：
- 📅 快速實作會談歷程頁面
- 📅 顯示是否已生成報告
- 📅 支援點擊跳轉到報告詳情

---

### 5. 生日與年齡自動計算 🎂

**功能說明**：
- 客戶資料只需儲存 `birth_date`
- API 回應時自動計算 `age`（西元年）

**好處**：
- ✅ 年齡永遠正確（不需手動更新）
- ✅ 資料庫只存生日，減少冗余

---

## 📈 系統狀態

### 部署環境
- **Staging URL**: https://career-app-api-staging-kxaznpplqq-uc.a.run.app
- **狀態**: ✅ 正常運作
- **新功能**: Client/Case Management + Session Recordings

### 資料庫狀態
- ✅ 所有 Migration 執行成功
- ✅ RLS 政策運作正常
- ✅ 軟刪除功能測試通過

---

## 🎯 下週計畫

1. **iOS API 文檔全面更新** - 反映所有新 API
2. **Swagger 文檔驗證** - 確保與程式碼完全一致
3. **文檔整理** - 刪除過時文件，整合重要資訊

---

**週報日期**: 2025-11-16
**系統版本**: v0.1.0
**主要里程碑**: 🎉 Client & Case Management 完成
