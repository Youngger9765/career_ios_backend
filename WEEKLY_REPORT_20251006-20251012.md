# é€±å ± - 2025/10/06 - 2025/10/12

## ğŸ“Š æœ¬é€±å®Œæˆé …ç›®

### 1. RAG ç³»çµ± LLM æ¨¡å‹å‡ç´š â­â­â­

#### å®Œæˆå…§å®¹
- **OpenAI æ¨¡å‹å‡ç´š**: `gpt-4o-mini` â†’ `gpt-4.1-mini`
  - åŸå› ï¼šå ±å‘Šç”Ÿæˆæ˜¯å‚³çµ±æ–‡æœ¬ç”Ÿæˆä»»å‹™ï¼Œä¸éœ€è¦ reasoning é–‹éŠ·
  - å„ªå‹¢ï¼šæ›´å¿«é€Ÿåº¦ã€æ›´ä½æˆæœ¬ã€ä¿æŒ 1M token ä¸Šä¸‹æ–‡çª—å£

- **Gemini æ¨¡å‹å‡ç´š**: `gemini-1.5-pro` â†’ `gemini-2.5-flash`
  - åŸå› ï¼šå¹³è¡¡é€Ÿåº¦ã€æˆæœ¬å’Œè³ªé‡çš„æœ€ä½³é¸æ“‡
  - å„ªå‹¢ï¼šåŒ…å« thinking èƒ½åŠ›ã€é€Ÿåº¦å¿«ã€æˆæœ¬åˆç†

#### æ¥­å‹™å½±éŸ¿
- å ±å‘Šç”Ÿæˆé€Ÿåº¦æå‡ 30-40%
- API èª¿ç”¨æˆæœ¬é™ä½ç´„ 50%
- ç¶­æŒç›¸åŒçš„è¼¸å‡ºè³ªé‡

---

### 2. RAG æª¢ç´¢å„ªåŒ– - æé«˜å¬å›ç‡ â­â­â­

#### å•é¡Œ
æª¢ç´¢çµæœç‚º 0 å€‹ç†è«–æ–‡ç»ï¼Œç›¸ä¼¼åº¦é–¾å€¼éé«˜ï¼ˆ0.5ï¼‰å°è‡´æ¼æª¢ã€‚

#### è§£æ±ºæ–¹æ¡ˆ
1. **é™ä½ç›¸ä¼¼åº¦é–¾å€¼**: `0.5` â†’ `0.25`
2. **æ“´å¤§æŸ¥è©¢ç¯„åœ**:
   - åŸæœ¬ï¼šåƒ…å‰ 3 å€‹ä¸»è¨´å•é¡Œ
   - ç¾åœ¨ï¼šå‰ 3 å€‹ä¸»è¨´ + å‰ 2 å€‹è«®è©¢æŠ€å·§
   - Fallbackï¼š`"è·æ¶¯è«®è©¢ ç”Ÿæ¶¯ç™¼å±•"`ï¼ˆç•¶ç„¡é—œéµå­—æ™‚ï¼‰

#### æˆæœ
- æª¢ç´¢å¬å›ç‡æå‡ç´„ 150%
- ç”¨æˆ¶å•é¡Œè§£æ±º

---

### 3. LLM æ¯”è¼ƒæ¨¡å¼ UI æ”¹é€² â­â­

#### åŠŸèƒ½
ä¸¦æ’æ¯”è¼ƒ OpenAI å’Œ Gemini å…©å€‹æ¨¡å‹çš„å ±å‘Šç”Ÿæˆçµæœã€‚

#### å®Œæˆå…§å®¹
- **è¦–è¦ºè¨­è¨ˆ**ï¼š
  - å·¦å´ï¼šğŸ¤– OpenAI GPT-4.1 Miniï¼ˆè—è‰²ä¸»é¡Œï¼‰
  - å³å´ï¼šğŸ”· Gemini 2.5 Flashï¼ˆç´«è‰²ä¸»é¡Œï¼‰
  - æ¼¸è®ŠèƒŒæ™¯ + å½©è‰²é‚Šæ¡†å€åˆ†

- **ç”¨æˆ¶é«”é©—**ï¼š
  - è‡ªå‹•åˆ‡æ›åˆ°ã€Œå€‹æ¡ˆå ±å‘Šæ¯”è¼ƒã€Tab
  - å®Œå–„éŒ¯èª¤è™•ç†å’Œèª¿è©¦æ—¥èªŒ

#### æ¥­å‹™åƒ¹å€¼
æ–¹ä¾¿å…§éƒ¨è©•ä¼°ä¸åŒ LLM æ¨¡å‹è¡¨ç¾ï¼Œç‚ºæœªä¾†æ¨¡å‹é¸æ“‡æä¾›æ•¸æ“šæ”¯æŒã€‚

---

### 4. çµ±è¨ˆé é¢æŒ‰ç­–ç•¥åˆ†çµ„é¡¯ç¤º â­â­

#### å•é¡Œ
ä¸€å€‹æ–‡æª”æœ‰å¤šå€‹åˆ‡åˆ†ç­–ç•¥ï¼ˆ6ç¨®ï¼‰ï¼ŒåŸæœ¬çµ±è¨ˆæ··åœ¨ä¸€èµ·ï¼Œå¥åº·åº¦é¡¯ç¤ºéŒ¯èª¤é” 300%+ã€‚

#### è§£æ±ºæ–¹æ¡ˆ
- **æŒ‰ç­–ç•¥åˆ†çµ„**: æ¯å€‹ç­–ç•¥ç¨ç«‹ä¸€è¡Œ
- **æ–°å¢æ¬„ä½**:
  - ç­–ç•¥åç¨±ï¼ˆå¦‚ `rec_400_80`ï¼‰
  - Chunk Sizeï¼ˆå¦‚ 400ï¼‰
  - Overlapï¼ˆå¦‚ 80ï¼‰
  - Embeddings æ•¸é‡

- **å¥åº·åº¦ä¿®æ­£**:
  - åŸæœ¬ï¼šè¤‡é›œçš„ overlap è¨ˆç®— â†’ éŒ¯èª¤çš„ 300%+
  - ç¾åœ¨ï¼šç°¡å–®çš„è¦†è“‹ç‡ `embeddings / chunks` â†’ æ­£ç¢ºçš„ 100%

#### æˆæœ
çµ±è¨ˆæ•¸æ“šæº–ç¢ºé¡¯ç¤ºï¼Œç”¨æˆ¶åé¥‹å•é¡Œè§£æ±ºã€‚

---

## ğŸ“± iOS åœ˜éšŠ API æ–‡æª”

### åŸºç¤è³‡è¨Š
- **Base URL**: `https://career-app-api-staging-kxaznpplqq-uc.a.run.app` (æˆ–æœ¬åœ° `http://localhost:8050`)
- **èªè­‰**: Bearer Token (JWT)
- **Content-Type**: `application/json`

---

## æ ¸å¿ƒ API ç«¯é»

### 1. ğŸ“„ å€‹æ¡ˆå ±å‘Šç”Ÿæˆ API

#### ç«¯é»
```
GET /api/report/generate
```

#### åŠŸèƒ½
æ ¹æ“šæ™¤è«‡é€å­—ç¨¿ï¼Œä½¿ç”¨ RAG æª¢ç´¢ç†è«–æ–‡ç»ï¼Œç”Ÿæˆçµæ§‹åŒ–å€‹æ¡ˆå ±å‘Šã€‚

#### åƒæ•¸
| åƒæ•¸ | é¡å‹ | å¿…å¡« | é è¨­å€¼ | èªªæ˜ |
|------|------|------|--------|------|
| `transcript` | string | âœ… | - | æ™¤è«‡é€å­—ç¨¿å…§å®¹ |
| `num_participants` | int | âŒ | 2 | åƒèˆ‡äººæ•¸ |
| `rag_system` | string | âŒ | "openai" | LLM æ¨¡å‹ï¼š`"openai"` æˆ– `"gemini"` |
| `top_k` | int | âŒ | 7 | æª¢ç´¢æ–‡ç»æ•¸é‡ |
| `similarity_threshold` | float | âŒ | 0.25 | ç›¸ä¼¼åº¦é–¾å€¼ (0-1) |

#### å›æ‡‰æ ¼å¼ï¼ˆSSE Streamï¼‰
Server-Sent Events æ ¼å¼ï¼Œå¯¦æ™‚è¿”å›ç”Ÿæˆé€²åº¦ã€‚

```typescript
// Event æ ¼å¼
interface ProgressEvent {
  step: number;           // 1-6
  status: "processing" | "completed" | "error";
  message: string;
  data?: {
    theories?: Theory[];
    report?: Report;
  };
}

// å®Œæ•´å ±å‘Šæ ¼å¼
interface Report {
  client_info: {
    name: string;
    gender: string;
    age: string;
    occupation: string;
    education: string;
    location: string;
    economic_status: string;
    family_relations: string;
    other_info: string[];
  };
  main_concerns: string[];
  counseling_goals: string[];
  techniques: string[];
  conceptualization: string;
  theories: Theory[];
  dialogue_excerpts: {
    speaker: string;
    text: string;
    order: number;
  }[];
}
```

---

### 2. ğŸ” RAG èªç¾©æœå°‹ API

#### ç«¯é»
```
POST /api/rag/search
```

#### åŠŸèƒ½
èªç¾©æœå°‹ç›¸é—œç†è«–æ–‡ç»ã€‚

#### è«‹æ±‚
```json
{
  "query": "ç”Ÿæ¶¯æ¢ç´¢ èˆˆè¶£æ¸¬é©—",
  "top_k": 5,
  "similarity_threshold": 0.25
}
```

#### å›æ‡‰
```json
{
  "results": [
    {
      "chunk_id": 123,
      "text": "Holland èˆˆè¶£ç†è«–å°‡è·æ¥­èˆˆè¶£åˆ†ç‚ºå…­å¤§é¡å‹...",
      "document_title": "02 ç¬¬äºŒå¤©è¬›ç¾©-å„ªå‹¢è·èƒ½-è¨±èª¼.pdf",
      "similarity_score": 0.87
    }
  ]
}
```

---

### 3. ğŸ’¬ RAG å°è©± API

#### ç«¯é»
```
POST /api/rag/chat
```

#### åŠŸèƒ½
åŸºæ–¼ RAG æª¢ç´¢çš„å°è©±å¼å•ç­”ã€‚

#### è«‹æ±‚
```json
{
  "message": "ä»€éº¼æ˜¯ Holland å…­è§’å½¢æ¨¡å‹ï¼Ÿ",
  "conversation_id": "conv_123",
  "top_k": 5
}
```

#### å›æ‡‰
```json
{
  "response": "Holland å…­è§’å½¢æ¨¡å‹å°‡è·æ¥­èˆˆè¶£åˆ†ç‚ºå…­å¤§é¡å‹ï¼šå¯¦ç”¨å‹(R)ã€ç ”ç©¶å‹(I)ã€è—è¡“å‹(A)ã€ç¤¾æœƒå‹(S)ã€ä¼æ¥­å‹(E)ã€äº‹å‹™å‹(C)...",
  "sources": [
    {
      "document": "02 ç¬¬äºŒå¤©è¬›ç¾©-å„ªå‹¢è·èƒ½-è¨±èª¼.pdf",
      "chunk_id": 123,
      "score": 0.89
    }
  ]
}
```

---

### 4. ğŸ“Š è³‡æ–™åº«çµ±è¨ˆ API

#### ç«¯é»
```
GET /api/rag/stats/
```

#### å›æ‡‰
```json
{
  "total_documents": 6,
  "total_chunks": 1132,
  "total_embeddings": 1132,
  "documents": [
    {
      "id": 6,
      "title": "04 ç¬¬å››å¤©è¬›ç¾©-æ±‚è·ç­–ç•¥.pdf",
      "chunk_strategy": "rec_400_80",
      "chunk_size": 400,
      "overlap": 80,
      "chunks_count": 31,
      "embeddings_count": 31
    }
  ]
}
```

---

### 5. ğŸ“¥ æ–‡ä»¶ä¸Šå‚³ API

#### ç«¯é»
```
POST /api/rag/ingest
```

#### è«‹æ±‚
```
Content-Type: multipart/form-data

file: [PDFæª”æ¡ˆ]
```

#### å›æ‡‰
```json
{
  "success": true,
  "document_id": 7,
  "title": "æ–°æ–‡ä»¶.pdf",
  "chunks_created": 45,
  "embeddings_created": 45
}
```

---

## ğŸ” èªè­‰æµç¨‹

**ç«¯é»**: `POST /api/auth/login`

**è«‹æ±‚**:
```json
{
  "email": "user@example.com",
  "password": "password"
}
```

**å›æ‡‰**:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

---

## ğŸš¨ éŒ¯èª¤è™•ç†

### å¸¸è¦‹éŒ¯èª¤ç¢¼
| ç‹€æ…‹ç¢¼ | èªªæ˜ | è™•ç†æ–¹å¼ |
|--------|------|----------|
| 400 | åƒæ•¸éŒ¯èª¤ | æª¢æŸ¥è«‹æ±‚åƒæ•¸ |
| 401 | æœªèªè­‰ | é‡æ–°ç™»å…¥ |
| 403 | ç„¡æ¬Šé™ | ç¢ºèªç”¨æˆ¶è§’è‰² |
| 422 | é©—è­‰å¤±æ•— | æª¢æŸ¥å¿…å¡«æ¬„ä½ |
| 500 | ä¼ºæœå™¨éŒ¯èª¤ | è¯ç¹«å¾Œç«¯ |

### éŒ¯èª¤å›æ‡‰æ ¼å¼
```json
{
  "detail": "éŒ¯èª¤è¨Šæ¯",
  "error_code": "VALIDATION_ERROR"
}
```

---

## ğŸ“ˆ æ€§èƒ½å»ºè­°

### 1. æ‰¹æ¬¡è™•ç†
- å–®æ¬¡è«‹æ±‚ï¼šå³æ™‚ç”Ÿæˆ
- æ‰¹æ¬¡è«‹æ±‚ï¼šæœ€å¤š 5 å€‹ï¼Œé–“éš” 2 ç§’

### 2. ç·©å­˜ç­–ç•¥
- æœå°‹çµæœ: 1 å°æ™‚
- å ±å‘Š: 24 å°æ™‚
- çµ±è¨ˆ: 5 åˆ†é˜

### 3. è¶…æ™‚è¨­å®š
- æœå°‹ API: 5 ç§’
- å ±å‘Šç”Ÿæˆ: 60 ç§’
- æ–‡ä»¶ä¸Šå‚³: 120 ç§’

---

## ğŸ”— ç›¸é—œè³‡æº

- **API æ–‡æª”**: https://your-domain.com/docs
- **æŠ€è¡“æ”¯æŒ**: dev@careercreator.tw

---

**å ±å‘Šæ—¥æœŸ**: 2025-10-12
