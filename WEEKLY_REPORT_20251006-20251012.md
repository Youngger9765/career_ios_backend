# é€±å ± - 2025/10/06 - 2025/10/12

## ğŸ“Š æœ¬é€±å®Œæˆé …ç›®

### 1. RAG ç³»çµ± LLM æ¨¡å‹å‡ç´š â­â­â­

#### å®Œæˆå…§å®¹
- **OpenAI æ¨¡å‹å‡ç´š**: `gpt-4o-mini` â†’ `gpt-4.1-mini`
  - åŸå› ï¼šå ±å‘Šç”Ÿæˆæ˜¯å‚³çµ±æ–‡æœ¬ç”Ÿæˆä»»å‹™ï¼Œä¸éœ€è¦ reasoning é–‹éŠ·
  - å„ªå‹¢ï¼šæ›´å¿«é€Ÿåº¦ã€æ›´ä½æˆæœ¬ã€ä¿æŒ 1M token ä¸Šä¸‹æ–‡çª—å£

- **Gemini æ¨¡å‹å‡ç´š**: `gemini-1.5-pro` â†’ `gemini-2.5-flash`
  - åŸå› ï¼šå¹³è¡¡é€Ÿåº¦ã€æˆæœ¬å’Œè³ªé‡çš„æœ€ä½³é¸æ“‡
  - å„ªå‹¢ï¼šåŒ…å« thinking èƒ½åŠ›ã€é€Ÿåº¦å¿«ã€æˆæœ¬åˆç†

#### æ¥­å‹™å½±éŸ¿
- å ±å‘Šç”Ÿæˆé€Ÿåº¦æå‡ 30-40%
- API èª¿ç”¨æˆæœ¬é™ä½ç´„ 50%
- ç¶­æŒç›¸åŒçš„è¼¸å‡ºè³ªé‡

---

### 2. RAG æª¢ç´¢å„ªåŒ– - æé«˜å¬å›ç‡ â­â­â­

#### å•é¡Œ
æª¢ç´¢çµæœç‚º 0 å€‹ç†è«–æ–‡ç»ï¼Œç›¸ä¼¼åº¦é–¾å€¼éé«˜ï¼ˆ0.5ï¼‰å°è‡´æ¼æª¢ã€‚

#### è§£æ±ºæ–¹æ¡ˆ
1. **é™ä½ç›¸ä¼¼åº¦é–¾å€¼**: `0.5` â†’ `0.25`
2. **æ“´å¤§æŸ¥è©¢ç¯„åœ**:
   - åŸæœ¬ï¼šåƒ…å‰ 3 å€‹ä¸»è¨´å•é¡Œ
   - ç¾åœ¨ï¼šå‰ 3 å€‹ä¸»è¨´ + å‰ 2 å€‹è«®è©¢æŠ€å·§
   - Fallbackï¼š`"è·æ¶¯è«®è©¢ ç”Ÿæ¶¯ç™¼å±•"`ï¼ˆç•¶ç„¡é—œéµå­—æ™‚ï¼‰

#### æˆæœ
- æª¢ç´¢å¬å›ç‡æå‡ç´„ 150%
- ç”¨æˆ¶å•é¡Œè§£æ±º

---

### 3. LLM æ¯”è¼ƒæ¨¡å¼ UI æ”¹é€² â­â­

#### åŠŸèƒ½
ä¸¦æ’æ¯”è¼ƒ OpenAI å’Œ Gemini å…©å€‹æ¨¡å‹çš„å ±å‘Šç”Ÿæˆçµæœã€‚

#### å®Œæˆå…§å®¹
- **è¦–è¦ºè¨­è¨ˆ**ï¼š
  - å·¦å´ï¼šğŸ¤– OpenAI GPT-4.1 Miniï¼ˆè—è‰²ä¸»é¡Œï¼‰
  - å³å´ï¼šğŸ”· Gemini 2.5 Flashï¼ˆç´«è‰²ä¸»é¡Œï¼‰
  - æ¼¸è®ŠèƒŒæ™¯ + å½©è‰²é‚Šæ¡†å€åˆ†

- **ç”¨æˆ¶é«”é©—**ï¼š
  - è‡ªå‹•åˆ‡æ›åˆ°ã€Œå€‹æ¡ˆå ±å‘Šæ¯”è¼ƒã€Tab
  - å®Œå–„éŒ¯èª¤è™•ç†å’Œèª¿è©¦æ—¥èªŒ

#### æ¥­å‹™åƒ¹å€¼
æ–¹ä¾¿å…§éƒ¨è©•ä¼°ä¸åŒ LLM æ¨¡å‹è¡¨ç¾ï¼Œç‚ºæœªä¾†æ¨¡å‹é¸æ“‡æä¾›æ•¸æ“šæ”¯æŒã€‚

---

### 4. çµ±è¨ˆé é¢æŒ‰ç­–ç•¥åˆ†çµ„é¡¯ç¤º â­â­

#### å•é¡Œ
ä¸€å€‹æ–‡æª”æœ‰å¤šå€‹åˆ‡åˆ†ç­–ç•¥ï¼ˆ6ç¨®ï¼‰ï¼ŒåŸæœ¬çµ±è¨ˆæ··åœ¨ä¸€èµ·ï¼Œå¥åº·åº¦é¡¯ç¤ºéŒ¯èª¤é” 300%+ã€‚

#### è§£æ±ºæ–¹æ¡ˆ
- **æŒ‰ç­–ç•¥åˆ†çµ„**: æ¯å€‹ç­–ç•¥ç¨ç«‹ä¸€è¡Œ
- **æ–°å¢æ¬„ä½**:
  - ç­–ç•¥åç¨±ï¼ˆå¦‚ `rec_400_80`ï¼‰
  - Chunk Sizeï¼ˆå¦‚ 400ï¼‰
  - Overlapï¼ˆå¦‚ 80ï¼‰
  - Embeddings æ•¸é‡

- **å¥åº·åº¦ä¿®æ­£**:
  - åŸæœ¬ï¼šè¤‡é›œçš„ overlap è¨ˆç®— â†’ éŒ¯èª¤çš„ 300%+
  - ç¾åœ¨ï¼šç°¡å–®çš„è¦†è“‹ç‡ `embeddings / chunks` â†’ æ­£ç¢ºçš„ 100%

#### æˆæœ
çµ±è¨ˆæ•¸æ“šæº–ç¢ºé¡¯ç¤ºï¼Œç”¨æˆ¶åé¥‹å•é¡Œè§£æ±ºã€‚

---

## ğŸ“± iOS åœ˜éšŠ API æ–‡æª”

### åŸºç¤è³‡è¨Š
- **Base URL**: `https://career-app-api-staging-kxaznpplqq-uc.a.run.app` (æˆ–æœ¬åœ° `http://localhost:8050`)
- **èªè­‰**: Bearer Token (JWT)
- **Content-Type**: `application/json`

---

## æ ¸å¿ƒ API ç«¯é»

### 1. ğŸ“„ å€‹æ¡ˆå ±å‘Šç”Ÿæˆ API

**åŠŸèƒ½**: æ ¹æ“šæ™¤è«‡é€å­—ç¨¿ï¼Œè‡ªå‹•ç”Ÿæˆçµæ§‹åŒ–å€‹æ¡ˆå ±å‘Š

#### ä½ è¦çµ¦æˆ‘ä»€éº¼ï¼ˆè¼¸å…¥ï¼‰

**HTTP Request**:
```http
POST /api/report/generate HTTP/1.1
Host: https://career-app-api-staging-kxaznpplqq-uc.a.run.app
Content-Type: application/json

{
  "transcript": "è«®è©¢å¸«ï¼šæ‚¨å¥½ï¼Œä»Šå¤©æƒ³èŠäº›ä»€éº¼ï¼Ÿ\nå€‹æ¡ˆï¼šæˆ‘æœ€è¿‘å°å·¥ä½œå¾ˆè¿·æƒ˜...",
  "rag_system": "openai",
  "num_participants": 2,
  "top_k": 7,
  "similarity_threshold": 0.25
}
```

**Request Body åƒæ•¸**:
- `transcript` (string) **å¿…å¡«**: æ™¤è«‡é€å­—ç¨¿æ–‡å­—å…§å®¹
- `rag_system` (string) é¸å¡«: ç”¨å“ªå€‹ AI æ¨¡å‹ç”Ÿæˆå ±å‘Š
  - `"openai"` (é è¨­): ç”¨ GPT-4.1 Mini
  - `"gemini"`: ç”¨ Gemini 2.5 Flash
- `num_participants` (int) é¸å¡«: æ™¤è«‡äººæ•¸ï¼Œé è¨­ 2
- `top_k` (int) é¸å¡«: æª¢ç´¢å¹¾ç¯‡ç†è«–æ–‡ç»ï¼Œé è¨­ 7
- `similarity_threshold` (float) é¸å¡«: ç›¸ä¼¼åº¦é–¾å€¼ 0-1ï¼Œé è¨­ 0.25

**æœ€ç°¡å–®çš„å‘¼å«æ–¹å¼**ï¼ˆåªå‚³ transcriptï¼‰:
```json
{
  "transcript": "è«®è©¢å¸«ï¼šæ‚¨å¥½..."
}
```

---

#### æˆ‘æœƒçµ¦ä½ ä»€éº¼ï¼ˆè¼¸å‡ºï¼‰

**è¼¸å‡ºæ ¼å¼**: Server-Sent Events (SSE) ä¸²æµ

é€™æ˜¯ä¸€å€‹**å³æ™‚ä¸²æµ**ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§å›å‚³ã€‚ä½ æœƒæ”¶åˆ°å¤šå€‹äº‹ä»¶ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

**äº‹ä»¶æ ¼å¼**:
```
data: {"step": 1, "status": "processing", "message": "æ­£åœ¨åˆ†æé€å­—ç¨¿çµæ§‹..."}

data: {"step": 1, "status": "completed", "message": "é€å­—ç¨¿åˆ†æå®Œæˆ", "data": {...}}

data: {"step": 2, "status": "processing", "message": "æ­£åœ¨è­˜åˆ¥é—œéµè­°é¡Œ..."}

...

data: {"step": 5, "status": "completed", "message": "å€‹æ¡ˆå ±å‘Šç”Ÿæˆå®Œæˆ", "data": {"report": {...}}}

data: {"step": 6, "status": "completed", "message": "å…¨éƒ¨å®Œæˆï¼"}
```

**ä½ è¦çš„æœ€çµ‚å ±å‘Šåœ¨**: `step == 5` ä¸” `status == "completed"` çš„äº‹ä»¶ä¸­ï¼Œ`data.report` æ¬„ä½

**å®Œæ•´å ±å‘Š JSON çµæ§‹**:
```json
{
  "client_info": {
    "name": "å°æ˜",
    "gender": "ç”·",
    "age": "25",
    "occupation": "å·¥ç¨‹å¸«",
    "education": "å¤§å­¸",
    "location": "å°åŒ—",
    "economic_status": "ä¸­ç­‰",
    "family_relations": "å–®è¦ªå®¶åº­",
    "other_info": ["æœ‰ç„¦æ…®å‚¾å‘"]
  },
  "session_summary": {
    "content": "å€‹æ¡ˆä¸»è¦è¨è«–è·æ¶¯è½‰æ›è­°é¡Œ...",
    "self_evaluation": "æœ¬æ¬¡æ™¤è«‡å»ºç«‹è‰¯å¥½é—œä¿‚..."
  },
  "main_concerns": ["ä¸ç¢ºå®šè·æ¶¯æ–¹å‘", "å·¥ä½œå£“åŠ›å¤§"],
  "counseling_goals": ["é‡æ¸…è·æ¶¯èˆˆè¶£", "æå‡æŠ—å£“èƒ½åŠ›"],
  "techniques": ["åŒç†å¿ƒå›æ‡‰", "é–‹æ”¾å¼å•å¥"],
  "conceptualization": "ã€ä¸»è¨´å•é¡Œã€‘\nå€‹æ¡ˆè¡¨ç¤º...\n\nã€æˆå› åˆ†æã€‘\næ ¹æ“š Holland ç†è«– [1]...",
  "theories": [
    {
      "text": "Holland ç†è«–å°‡è·æ¥­èˆˆè¶£åˆ†ç‚ºå…­å¤§é¡å‹...",
      "document": "è·æ¶¯ç†è«–è¬›ç¾©.pdf",
      "score": 0.87
    }
  ],
  "dialogue_excerpts": [
    {
      "speaker": "speaker1",
      "order": 1,
      "text": "è«®è©¢å¸«ï¼šæ‚¨å¥½ï¼Œä»Šå¤©æƒ³èŠäº›ä»€éº¼ï¼Ÿ"
    },
    {
      "speaker": "speaker2",
      "order": 2,
      "text": "å€‹æ¡ˆï¼šæˆ‘æœ€è¿‘å°å·¥ä½œå¾ˆè¿·æƒ˜..."
    }
  ]
}
```

---

#### iOS å¦‚ä½•æ¥æ”¶ SSE

**é‡é»**: SSE ä¸æ˜¯æ™®é€šçš„ JSON responseï¼Œæ˜¯ä¸²æµæ ¼å¼ã€‚

**é¸é … 1**: ä½¿ç”¨ URLSession æ¥æ”¶æ•´å€‹ä¸²æµ
```swift
let task = URLSession.shared.dataTask(with: request) { data, response, error in
    // data åŒ…å«æ‰€æœ‰ SSE äº‹ä»¶
    // è§£æ "data: {...}\n\n" æ ¼å¼
}
```

**é¸é … 2**: ä½¿ç”¨ç¬¬ä¸‰æ–¹ SSE å‡½å¼åº«ï¼ˆæ¨è–¦ï¼‰
- [SwiftEventSource](https://github.com/inaka/EventSource)
- [IKEventSource](https://github.com/inaka/EventSource)

**é¸é … 3**: è‡ªå·±å¯«ä¸²æµè§£æå™¨ï¼ˆè¼ƒè¤‡é›œï¼‰

---

### 2. ğŸ” RAG èªç¾©æœå°‹ API

#### ç«¯é»
```
POST /api/rag/search
```

#### åŠŸèƒ½
èªç¾©æœå°‹ç›¸é—œç†è«–æ–‡ç»ã€‚

#### è«‹æ±‚
```json
{
  "query": "ç”Ÿæ¶¯æ¢ç´¢ èˆˆè¶£æ¸¬é©—",
  "top_k": 5,
  "similarity_threshold": 0.25
}
```

#### å›æ‡‰
```json
{
  "results": [
    {
      "chunk_id": 123,
      "text": "Holland èˆˆè¶£ç†è«–å°‡è·æ¥­èˆˆè¶£åˆ†ç‚ºå…­å¤§é¡å‹...",
      "document_title": "02 ç¬¬äºŒå¤©è¬›ç¾©-å„ªå‹¢è·èƒ½-è¨±èª¼.pdf",
      "similarity_score": 0.87
    }
  ]
}
```

---

### 3. ğŸ’¬ RAG å°è©± API

#### ç«¯é»
```
POST /api/rag/chat
```

#### åŠŸèƒ½
åŸºæ–¼ RAG æª¢ç´¢çš„å°è©±å¼å•ç­”ã€‚

#### è«‹æ±‚
```json
{
  "message": "ä»€éº¼æ˜¯ Holland å…­è§’å½¢æ¨¡å‹ï¼Ÿ",
  "conversation_id": "conv_123",
  "top_k": 5
}
```

#### å›æ‡‰
```json
{
  "response": "Holland å…­è§’å½¢æ¨¡å‹å°‡è·æ¥­èˆˆè¶£åˆ†ç‚ºå…­å¤§é¡å‹ï¼šå¯¦ç”¨å‹(R)ã€ç ”ç©¶å‹(I)ã€è—è¡“å‹(A)ã€ç¤¾æœƒå‹(S)ã€ä¼æ¥­å‹(E)ã€äº‹å‹™å‹(C)...",
  "sources": [
    {
      "document": "02 ç¬¬äºŒå¤©è¬›ç¾©-å„ªå‹¢è·èƒ½-è¨±èª¼.pdf",
      "chunk_id": 123,
      "score": 0.89
    }
  ]
}
```

---

### 4. ğŸ“Š è³‡æ–™åº«çµ±è¨ˆ API

#### ç«¯é»
```
GET /api/rag/stats/
```

#### å›æ‡‰
```json
{
  "total_documents": 6,
  "total_chunks": 1132,
  "total_embeddings": 1132,
  "documents": [
    {
      "id": 6,
      "title": "04 ç¬¬å››å¤©è¬›ç¾©-æ±‚è·ç­–ç•¥.pdf",
      "chunk_strategy": "rec_400_80",
      "chunk_size": 400,
      "overlap": 80,
      "chunks_count": 31,
      "embeddings_count": 31
    }
  ]
}
```

---

### 5. ğŸ“¥ æ–‡ä»¶ä¸Šå‚³ API

#### ç«¯é»
```
POST /api/rag/ingest
```

#### è«‹æ±‚
```
Content-Type: multipart/form-data

file: [PDFæª”æ¡ˆ]
```

#### å›æ‡‰
```json
{
  "success": true,
  "document_id": 7,
  "title": "æ–°æ–‡ä»¶.pdf",
  "chunks_created": 45,
  "embeddings_created": 45
}
```

---

## ğŸ” èªè­‰æµç¨‹

**ç«¯é»**: `POST /api/auth/login`

**è«‹æ±‚**:
```json
{
  "email": "user@example.com",
  "password": "password"
}
```

**å›æ‡‰**:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

---

## ğŸš¨ éŒ¯èª¤è™•ç†

### å¸¸è¦‹éŒ¯èª¤ç¢¼
| ç‹€æ…‹ç¢¼ | èªªæ˜ | è™•ç†æ–¹å¼ |
|--------|------|----------|
| 400 | åƒæ•¸éŒ¯èª¤ | æª¢æŸ¥è«‹æ±‚åƒæ•¸ |
| 401 | æœªèªè­‰ | é‡æ–°ç™»å…¥ |
| 403 | ç„¡æ¬Šé™ | ç¢ºèªç”¨æˆ¶è§’è‰² |
| 422 | é©—è­‰å¤±æ•— | æª¢æŸ¥å¿…å¡«æ¬„ä½ |
| 500 | ä¼ºæœå™¨éŒ¯èª¤ | è¯ç¹«å¾Œç«¯ |

### éŒ¯èª¤å›æ‡‰æ ¼å¼
```json
{
  "detail": "éŒ¯èª¤è¨Šæ¯",
  "error_code": "VALIDATION_ERROR"
}
```

---

## ğŸ“ˆ æ€§èƒ½å»ºè­°

### 1. æ‰¹æ¬¡è™•ç†
- å–®æ¬¡è«‹æ±‚ï¼šå³æ™‚ç”Ÿæˆ
- æ‰¹æ¬¡è«‹æ±‚ï¼šæœ€å¤š 5 å€‹ï¼Œé–“éš” 2 ç§’

### 2. ç·©å­˜ç­–ç•¥
- æœå°‹çµæœ: 1 å°æ™‚
- å ±å‘Š: 24 å°æ™‚
- çµ±è¨ˆ: 5 åˆ†é˜

### 3. è¶…æ™‚è¨­å®š
- æœå°‹ API: 5 ç§’
- å ±å‘Šç”Ÿæˆ: 60 ç§’
- æ–‡ä»¶ä¸Šå‚³: 120 ç§’

---

## ğŸ”— ç›¸é—œè³‡æº

- **API æ–‡æª”**: https://your-domain.com/docs
- **æŠ€è¡“æ”¯æŒ**: dev@careercreator.tw

---

**å ±å‘Šæ—¥æœŸ**: 2025-10-12
