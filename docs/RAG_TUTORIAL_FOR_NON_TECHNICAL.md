# RAG ç³»çµ±å®Œæ•´æ•™å­¸æŒ‡å— - å¾é›¶åˆ°æœ‰å»ºç«‹æ™ºèƒ½å•ç­”ç³»çµ±

**ç›®æ¨™è®€è€…**ï¼šç”¢å“ç¶“ç†ã€éæŠ€è¡“èƒŒæ™¯äººå“¡ã€æƒ³äº†è§£ RAG çš„åˆå­¸è€…

**é è¨ˆå­¸ç¿’æ™‚é–“**ï¼š1 å°æ™‚

**å­¸å®Œä½ å°‡æœƒ**ï¼š
- ç†è§£ RAG æ˜¯ä»€éº¼ã€ç‚ºä»€éº¼éœ€è¦å®ƒ
- å­¸æœƒå¦‚ä½•ä¸Šå‚³æ–‡ä»¶ä¸¦å»ºç«‹çŸ¥è­˜åº«
- èƒ½å¤ æ¸¬è©¦å’Œä½¿ç”¨æ™ºèƒ½å•ç­”ç³»çµ±
- äº†è§£å¦‚ä½•æ•´åˆåˆ°ä½ çš„ç”¢å“ä¸­

---

## ğŸ“š ç›®éŒ„

### [ç¬¬ 1 éƒ¨åˆ†ï¼šRAG åŸºç¤æ¦‚å¿µï¼ˆ15 åˆ†é˜ï¼‰](#ç¬¬-1-éƒ¨åˆ†rag-åŸºç¤æ¦‚å¿µ)
- [1.1 ä»€éº¼æ˜¯ RAGï¼Ÿ](#11-ä»€éº¼æ˜¯-rag)
- [1.2 ç‚ºä»€éº¼éœ€è¦ RAGï¼Ÿ](#12-ç‚ºä»€éº¼éœ€è¦-rag)
- [1.3 RAG å¦‚ä½•é‹ä½œï¼Ÿ](#13-rag-å¦‚ä½•é‹ä½œ)
- [1.4 å¯¦éš›æ‡‰ç”¨æ¡ˆä¾‹](#14-å¯¦éš›æ‡‰ç”¨æ¡ˆä¾‹)

### [ç¬¬ 2 éƒ¨åˆ†ï¼šOpenAI Embedding åŸç†ï¼ˆ15 åˆ†é˜ï¼‰](#ç¬¬-2-éƒ¨åˆ†openai-embedding-åŸç†)
- [2.1 ä»€éº¼æ˜¯ Embeddingï¼Ÿ](#21-ä»€éº¼æ˜¯-embedding)
- [2.2 ç‚ºä»€éº¼éœ€è¦ Embeddingï¼Ÿ](#22-ç‚ºä»€éº¼éœ€è¦-embedding)
- [2.3 Embedding å¦‚ä½•å¹«åŠ©æœå°‹ï¼Ÿ](#23-embedding-å¦‚ä½•å¹«åŠ©æœå°‹)
- [2.4 æˆæœ¬èˆ‡é¸æ“‡](#24-æˆæœ¬èˆ‡é¸æ“‡)

### [ç¬¬ 3 éƒ¨åˆ†ï¼šSupabase è³‡æ–™åº«è¨­å®šï¼ˆ15 åˆ†é˜ï¼‰](#ç¬¬-3-éƒ¨åˆ†supabase-è³‡æ–™åº«è¨­å®š)
- [3.1 ç‚ºä»€éº¼é¸æ“‡ Supabaseï¼Ÿ](#31-ç‚ºä»€éº¼é¸æ“‡-supabase)
- [3.2 è³‡æ–™å¦‚ä½•å„²å­˜ï¼Ÿ](#32-è³‡æ–™å¦‚ä½•å„²å­˜)
- [3.3 è¨­å®š Supabase å°ˆæ¡ˆ](#33-è¨­å®š-supabase-å°ˆæ¡ˆ)
- [3.4 è¨­å®šç’°å¢ƒè®Šæ•¸ï¼ˆ.env æª”æ¡ˆï¼‰](#34-è¨­å®šç’°å¢ƒè®Šæ•¸env-æª”æ¡ˆ)
- [3.5 ç†è§£è³‡æ–™è¡¨çµæ§‹](#35-ç†è§£è³‡æ–™è¡¨çµæ§‹)

### [ç¬¬ 4 éƒ¨åˆ†ï¼šå¯¦éš›æ“ä½œ - å»ºç«‹ä½ çš„ RAG ç³»çµ±ï¼ˆ15 åˆ†é˜ï¼‰](#ç¬¬-4-éƒ¨åˆ†å¯¦éš›æ“ä½œå»ºç«‹ä½ çš„-rag-ç³»çµ±)
- [4.1 ä¸Šå‚³æ–‡ä»¶åˆ°çŸ¥è­˜åº«](#41-ä¸Šå‚³æ–‡ä»¶åˆ°çŸ¥è­˜åº«)
- [4.2 æ¸¬è©¦æœå°‹åŠŸèƒ½](#42-æ¸¬è©¦æœå°‹åŠŸèƒ½)
- [4.3 æ¸¬è©¦æ™ºèƒ½å•ç­”](#43-æ¸¬è©¦æ™ºèƒ½å•ç­”)
- [4.4 æ•´åˆåˆ°ä½ çš„æ‡‰ç”¨](#44-æ•´åˆåˆ°ä½ çš„æ‡‰ç”¨)

### [ç¬¬ 5 éƒ¨åˆ†ï¼šå»ºç«‹å®Œæ•´çš„å‰å¾Œç«¯ç³»çµ±ï¼ˆé€²éšï¼‰](#ç¬¬-5-éƒ¨åˆ†å»ºç«‹å®Œæ•´çš„å‰å¾Œç«¯ç³»çµ±)
- ğŸ“Œ å¦‚æœä½ æƒ³è¦å®Œæ•´çš„æ–‡ä»¶ç®¡ç†ä»‹é¢ï¼ˆä¸Šå‚³ã€CRUDã€æœå°‹æ¸¬è©¦ï¼‰
- ğŸ‘‰ è«‹åƒè€ƒï¼š[RAG å‰å¾Œç«¯å®Œæ•´å¯¦ä½œæ•™å­¸](./RAG_FRONTEND_BACKEND_TUTORIAL.md)

### [é™„éŒ„](#é™„éŒ„)
- [å¸¸è¦‹å•é¡Œ FAQ](#å¸¸è¦‹å•é¡Œ-faq)
- [åè©å°ç…§è¡¨](#åè©å°ç…§è¡¨)
- [å»¶ä¼¸å­¸ç¿’è³‡æº](#å»¶ä¼¸å­¸ç¿’è³‡æº)

---

## ç¬¬ 1 éƒ¨åˆ†ï¼šRAG åŸºç¤æ¦‚å¿µ

### 1.1 ä»€éº¼æ˜¯ RAGï¼Ÿ

**RAG = Retrieval-Augmented Generation**ï¼ˆæª¢ç´¢å¢å¼·ç”Ÿæˆï¼‰

**æœ€ç°¡å–®çš„è§£é‡‹**ï¼š
æƒ³åƒä½ åœ¨è€ƒè©¦æ™‚å¯ä»¥ã€Œç¿»æ›¸æ‰¾ç­”æ¡ˆã€ï¼Œè€Œä¸æ˜¯åªé èƒŒèª¦è¨˜æ†¶ã€‚

- **å‚³çµ± AIï¼ˆChatGPTï¼‰**ï¼šåƒæ˜¯é–‰å·è€ƒè©¦ï¼Œåªèƒ½å›ç­”ã€Œè¨“ç·´æ™‚å­¸åˆ°çš„çŸ¥è­˜ã€ï¼ˆ2021 å¹´ä¹‹å‰çš„è³‡æ–™ï¼‰
- **RAG ç³»çµ±**ï¼šåƒæ˜¯é–‹å·è€ƒè©¦ï¼Œå¯ä»¥å…ˆã€Œç¿»æ›¸æ‰¾ç›¸é—œå…§å®¹ã€ï¼Œå†æ ¹æ“šæ‰¾åˆ°çš„å…§å®¹å›ç­”å•é¡Œ

**å¯¦éš›ç¯„ä¾‹**ï¼š

âŒ **æ²’æœ‰ RAG**
```
ä½¿ç”¨è€…ï¼šã€Œæˆ‘å€‘å…¬å¸çš„è«‹å‡æ”¿ç­–æ˜¯ä»€éº¼ï¼Ÿã€
AIï¼šã€Œæˆ‘ä¸çŸ¥é“ä½ å€‘å…¬å¸çš„å…·é«”æ”¿ç­–...ã€
```

âœ… **æœ‰ RAG**
```
ä½¿ç”¨è€…ï¼šã€Œæˆ‘å€‘å…¬å¸çš„è«‹å‡æ”¿ç­–æ˜¯ä»€éº¼ï¼Ÿã€

ç³»çµ±å…§éƒ¨æµç¨‹ï¼š
1. å…ˆå»ã€Œå“¡å·¥æ‰‹å†Šã€è£¡æœå°‹ç›¸é—œæ®µè½
2. æ‰¾åˆ°ï¼šã€Œå¹´å‡ 7 å¤©ã€ç—…å‡ 14 å¤©ã€ç‰¹ä¼‘ä¾å¹´è³‡è¨ˆç®—...ã€
3. æ ¹æ“šæ‰¾åˆ°çš„å…§å®¹ç”Ÿæˆå›ç­”

AIï¼šã€Œæ ¹æ“šå“¡å·¥æ‰‹å†Šï¼Œå¹´å‡ 7 å¤©ã€ç—…å‡ 14 å¤©ï¼Œç‰¹ä¼‘ä¾å¹´è³‡è¨ˆç®—...ã€
```

---

### 1.2 ç‚ºä»€éº¼éœ€è¦ RAGï¼Ÿ

**å•é¡Œ 1ï¼šAI çš„çŸ¥è­˜æœ‰æ™‚æ•ˆæ€§**
- ChatGPT çš„è¨“ç·´è³‡æ–™æˆªè‡³ 2021 å¹´
- ç„¡æ³•å›ç­”ã€Œ2024 å¹´æœ€æ–°ç”¢å“åŠŸèƒ½ã€ã€Œæ˜¨å¤©çš„æœƒè­°è¨˜éŒ„ã€

**å•é¡Œ 2ï¼šAI ä¸çŸ¥é“ä½ çš„ç§æœ‰è³‡æ–™**
- ç„¡æ³•å›ç­”ã€Œæˆ‘å€‘å…¬å¸çš„å…§éƒ¨è¦ç¯„ã€
- ç„¡æ³•å›ç­”ã€Œå®¢æˆ¶çš„ç”¢å“æ–‡ä»¶ã€

**å•é¡Œ 3ï¼šAI å¯èƒ½ç”¢ç”Ÿå¹»è¦ºï¼ˆHallucinationï¼‰**
- ç•¶ AI ä¸ç¢ºå®šæ™‚ï¼Œå¯èƒ½æœƒã€Œç·¨é€ ã€è½èµ·ä¾†åˆç†çš„ç­”æ¡ˆ
- ä¾‹å¦‚ï¼šç·¨é€ ä¸å­˜åœ¨çš„æ”¿ç­–æ¢æ–‡

**RAG çš„è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. âœ… **å³æ™‚æ€§**ï¼šéš¨æ™‚å¯ä»¥ä¸Šå‚³æœ€æ–°æ–‡ä»¶
2. âœ… **ç§æœ‰çŸ¥è­˜**ï¼šä½¿ç”¨ä½ è‡ªå·±çš„è³‡æ–™åº«
3. âœ… **å¯é©—è­‰**ï¼šå›ç­”æœƒé™„ä¸Šä¾†æºæ–‡ä»¶ï¼Œå¯ä»¥æª¢æŸ¥
4. âœ… **é™ä½å¹»è¦º**ï¼šAI åªæ ¹æ“šã€Œæ‰¾åˆ°çš„å…§å®¹ã€å›ç­”ï¼Œä¸èƒ½äº‚ç·¨

---

### 1.3 RAG å¦‚ä½•é‹ä½œï¼Ÿ

**å®Œæ•´æµç¨‹åœ–è§£**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬ä¸€éšæ®µï¼šå»ºç«‹çŸ¥è­˜åº«ï¼ˆåªéœ€åšä¸€æ¬¡ï¼‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“„ ä¸Šå‚³æ–‡ä»¶ï¼ˆPDFã€Wordã€ç¶²é ï¼‰
    â†“
ğŸ“ æå–æ–‡å­—å…§å®¹
    â†“
âœ‚ï¸ åˆ‡æˆå°æ®µè½ï¼ˆChunkingï¼‰
    ä¾‹ï¼šæ¯ 400 å­—ä¸€æ®µï¼Œæ®µè½é–“é‡ç–Š 80 å­—
    â†“
ğŸ§® è½‰æ›æˆæ•¸å­—å‘é‡ï¼ˆEmbeddingï¼‰
    ä¾‹ï¼š"è«‹å‡æ”¿ç­–" â†’ [0.23, -0.45, 0.67, ..., 0.12]ï¼ˆ1536 å€‹æ•¸å­—ï¼‰
    â†“
ğŸ’¾ å„²å­˜åˆ°å‘é‡è³‡æ–™åº«ï¼ˆSupabase + pgvectorï¼‰


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬äºŒéšæ®µï¼šå›ç­”å•é¡Œï¼ˆæ¯æ¬¡æå•æ™‚ï¼‰                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ—£ï¸ ä½¿ç”¨è€…æå•ï¼šã€Œè«‹å‡æ”¿ç­–æ˜¯ä»€éº¼ï¼Ÿã€
    â†“
ğŸ§® å•é¡Œè½‰æ›æˆå‘é‡
    "è«‹å‡æ”¿ç­–æ˜¯ä»€éº¼ï¼Ÿ" â†’ [0.21, -0.43, 0.69, ..., 0.15]
    â†“
ğŸ” å‘é‡ç›¸ä¼¼åº¦æœå°‹ï¼ˆåœ¨çŸ¥è­˜åº«è£¡æ‰¾æœ€ç›¸é—œçš„æ®µè½ï¼‰
    è¨ˆç®—å•é¡Œå‘é‡ vs. æ‰€æœ‰æ®µè½å‘é‡çš„ã€Œè·é›¢ã€
    æ‰¾å‡ºæœ€ç›¸ä¼¼çš„ Top 5 æ®µè½
    â†“
ğŸ“š å–å¾—ç›¸é—œæ®µè½ï¼š
    1. ã€Œå¹´å‡ 7 å¤©ã€ç—…å‡ 14 å¤©...ã€ï¼ˆç›¸ä¼¼åº¦ 0.92ï¼‰
    2. ã€Œç‰¹ä¼‘å‡è¨ˆç®—æ–¹å¼...ã€ï¼ˆç›¸ä¼¼åº¦ 0.85ï¼‰
    3. ...
    â†“
ğŸ¤– GPT-4 ç”Ÿæˆå›ç­”
    ç³»çµ±æç¤ºï¼šã€Œæ ¹æ“šä»¥ä¸‹æ–‡ä»¶å›ç­”å•é¡Œï¼Œä¸è¦ç·¨é€ å…§å®¹...ã€
    ç›¸é—œæ–‡ä»¶ï¼š[æ®µè½ 1ã€æ®µè½ 2ã€...]
    ä½¿ç”¨è€…å•é¡Œï¼šã€Œè«‹å‡æ”¿ç­–æ˜¯ä»€éº¼ï¼Ÿã€
    â†“
âœ… å›å‚³ç­”æ¡ˆ + ä¾†æºå¼•ç”¨
```

**é—œéµæ­¥é©Ÿè§£é‡‹**ï¼š

1. **Chunkingï¼ˆæ–‡å­—åˆ‡ç‰‡ï¼‰**
   - ç‚ºä»€éº¼è¦åˆ‡ï¼Ÿæ•´ä»½æ–‡ä»¶å¤ªé•·ï¼ŒAI ç„¡æ³•ä¸€æ¬¡è™•ç†
   - æ€éº¼åˆ‡ï¼Ÿæ¯ 400 å­—åˆ‡ä¸€æ®µï¼Œæ®µè½é–“é‡ç–Š 80 å­—ï¼ˆé¿å…é‡è¦å¥å­è¢«åˆ‡æ–·ï¼‰

2. **Embeddingï¼ˆå‘é‡åŒ–ï¼‰**
   - æŠŠæ–‡å­—è½‰æˆæ•¸å­—é™£åˆ—ï¼Œè®“é›»è…¦å¯ä»¥ã€Œè¨ˆç®—ç›¸ä¼¼åº¦ã€
   - ä¾‹å¦‚ï¼šã€Œè²“ã€å’Œã€Œç‹—ã€çš„å‘é‡è·é›¢å¾ˆè¿‘ï¼Œã€Œè²“ã€å’Œã€Œæ±½è»Šã€çš„å‘é‡è·é›¢å¾ˆé 

3. **Vector Searchï¼ˆå‘é‡æœå°‹ï¼‰**
   - è¨ˆç®—å•é¡Œå‘é‡å’Œæ‰€æœ‰æ®µè½å‘é‡çš„ã€Œè·é›¢ã€
   - è·é›¢è¶Šè¿‘ = èªæ„è¶Šç›¸ä¼¼
   - æ‰¾å‡ºæœ€ç›¸é—œçš„ Top K æ®µè½

4. **GPT-4 ç”Ÿæˆ**
   - æ ¹æ“šæ‰¾åˆ°çš„æ®µè½ï¼Œç”Ÿæˆè‡ªç„¶èªè¨€å›ç­”
   - é™„ä¸Šå¼•ç”¨ä¾†æºï¼ˆå“ªä»½æ–‡ä»¶ã€ç¬¬å¹¾é ï¼‰

---

### 1.4 å¯¦éš›æ‡‰ç”¨æ¡ˆä¾‹

**æ¡ˆä¾‹ 1ï¼šå®¢æœçŸ¥è­˜åº«**
```
çŸ¥è­˜ä¾†æºï¼šç”¢å“èªªæ˜æ›¸ 10 ä»½ã€FAQ æ–‡ä»¶ 5 ä»½
ä½¿ç”¨è€…å•ï¼šã€Œå¦‚ä½•é‡è¨­å¯†ç¢¼ï¼Ÿã€
ç³»çµ±å›ç­”ï¼šæ ¹æ“šã€Šä½¿ç”¨æ‰‹å†Š v2.3ã€‹ç¬¬ 12 é ï¼Œé‡è¨­å¯†ç¢¼æ­¥é©Ÿç‚º...
```

**æ¡ˆä¾‹ 2ï¼šä¼æ¥­å…§éƒ¨æ–‡ä»¶å•ç­”ï¼ˆæœ¬å°ˆæ¡ˆï¼‰**
```
çŸ¥è­˜ä¾†æºï¼šGoogle Docs æ–‡ä»¶ 10-20 ä»½
ä½¿ç”¨è€…å•ï¼šã€Œç”¢å“ A çš„å®šåƒ¹ç­–ç•¥æ˜¯ä»€éº¼ï¼Ÿã€
ç³»çµ±å›ç­”ï¼šæ ¹æ“šã€Šç”¢å“ç­–ç•¥æ–‡ä»¶ã€‹ï¼Œå®šåƒ¹æ¡ç”¨éšæ¢¯å¼æ”¶è²»...
```

**æ¡ˆä¾‹ 3ï¼šè·æ¶¯è«®è©¢åŠ©æ‰‹ï¼ˆæœ¬å°ˆæ¡ˆå¯¦éš›æ¡ˆä¾‹ï¼‰**
```
çŸ¥è­˜ä¾†æºï¼šå¿ƒç†è«®è©¢ç†è«–æ–‡ç»ã€è·æ¶¯ç™¼å±•ç†è«–
è«®å•†å¸«ä¸Šå‚³æœƒè«‡é€å­—ç¨¿
ç³»çµ±è‡ªå‹•ç”Ÿæˆå ±å‘Šï¼Œä¸¦å¼•ç”¨ç›¸é—œç†è«–ï¼š
ã€Œæ ¹æ“š Super ç”Ÿæ¶¯ç™¼å±•ç†è«– [1]ï¼Œæ¡ˆä¸»è™•æ–¼æ¢ç´¢æœŸ...ã€
```

---

## ç¬¬ 2 éƒ¨åˆ†ï¼šOpenAI Embedding åŸç†

### 2.1 ä»€éº¼æ˜¯ Embeddingï¼Ÿ

**Embedding = æŠŠæ–‡å­—è½‰æ›æˆæ•¸å­—å‘é‡ï¼ˆä¸€ä¸²æ•¸å­—ï¼‰**

**ç”Ÿæ´»åŒ–æ¯”å–»**ï¼š
æƒ³åƒä½ è¦åœ¨åœ°åœ–ä¸Šæ¨™è¨˜ã€Œå’–å•¡åº—çš„ä½ç½®ã€
- æ–‡å­—æè¿°ï¼šã€Œä¿¡ç¾©å€å¸‚æ”¿åºœç«™é™„è¿‘ã€âŒ é›»è…¦ç„¡æ³•è¨ˆç®—è·é›¢
- åº§æ¨™ä½ç½®ï¼š(25.0330, 121.5654) âœ… å¯ä»¥è¨ˆç®—è·é›¢

Embedding å°±æ˜¯æŠŠæ–‡å­—è½‰æˆã€Œèªæ„åº§æ¨™ã€ï¼š
- ã€Œè²“ã€ â†’ [0.2, 0.5, -0.3, 0.1, ...]ï¼ˆ1536 å€‹æ•¸å­—ï¼‰
- ã€Œç‹—ã€ â†’ [0.3, 0.6, -0.2, 0.2, ...]
- ã€Œæ±½è»Šã€â†’ [-0.5, -0.1, 0.8, -0.4, ...]

**é‡è¦ç‰¹æ€§**ï¼š
- èªæ„ç›¸è¿‘çš„è©ï¼Œå‘é‡è·é›¢ä¹Ÿè¿‘
- ã€Œè²“ã€å’Œã€Œç‹—ã€çš„è·é›¢ < ã€Œè²“ã€å’Œã€Œæ±½è»Šã€çš„è·é›¢

---

### 2.2 ç‚ºä»€éº¼éœ€è¦ Embeddingï¼Ÿ

**å•é¡Œï¼šå‚³çµ±é—œéµå­—æœå°‹çš„é™åˆ¶**

âŒ **é—œéµå­—æœå°‹**
```
ä½¿ç”¨è€…æœå°‹ï¼šã€Œå¦‚ä½•é›¢è·ã€
è³‡æ–™åº«æ–‡ä»¶ï¼šã€Œè¾­è·æµç¨‹èªªæ˜ã€

çµæœï¼šæ‰¾ä¸åˆ°ï¼ï¼ˆå› ç‚ºã€Œé›¢è·ã€â‰ ã€Œè¾­è·ã€ï¼‰
```

âœ… **èªæ„æœå°‹ï¼ˆEmbeddingï¼‰**
```
ä½¿ç”¨è€…æœå°‹ï¼šã€Œå¦‚ä½•é›¢è·ã€ â†’ å‘é‡ A
è³‡æ–™åº«æ–‡ä»¶ï¼šã€Œè¾­è·æµç¨‹èªªæ˜ã€ â†’ å‘é‡ B

è¨ˆç®—ç›¸ä¼¼åº¦ï¼šè·é›¢å¾ˆè¿‘ï¼
çµæœï¼šæ‰¾åˆ°äº†ï¼ï¼ˆAI çŸ¥é“ã€Œé›¢è·ã€=ã€Œè¾­è·ã€ï¼‰
```

**æ›´å¤šç¯„ä¾‹**ï¼š

| ä½¿ç”¨è€…å•é¡Œ | é—œéµå­—æœå°‹ | èªæ„æœå°‹ï¼ˆEmbeddingï¼‰ |
|----------|----------|-------------------|
| ã€Œå¹´å‡æ€éº¼è«‹ï¼Ÿã€ | âŒ æ‰¾ä¸åˆ°ï¼ˆæ²’æœ‰ã€Œå¹´å‡ã€é—œéµå­—ï¼‰ | âœ… æ‰¾åˆ°ã€Œç‰¹ä¼‘å‡ç”³è«‹æµç¨‹ã€ |
| ã€Œé€€è²»æ”¿ç­–ã€ | âŒ æ‰¾ä¸åˆ°ï¼ˆæ–‡ä»¶å¯«ã€Œé€€æ¬¾è¦å‰‡ã€ï¼‰ | âœ… æ‰¾åˆ°ã€Œé€€æ¬¾è¦å‰‡ã€ |
| ã€ŒHow to reset password?ã€ | âŒ æ‰¾ä¸åˆ°ï¼ˆä¸­æ–‡è³‡æ–™åº«ï¼‰ | âœ… æ‰¾åˆ°ã€Œå¦‚ä½•é‡è¨­å¯†ç¢¼ã€ï¼ˆè·¨èªè¨€ï¼‰ |

---

### 2.3 Embedding å¦‚ä½•å¹«åŠ©æœå°‹ï¼Ÿ

**å®Œæ•´æµç¨‹ç¯„ä¾‹**ï¼š

**æ­¥é©Ÿ 1ï¼šå»ºç«‹çŸ¥è­˜åº« Embedding**
```python
æ–‡ä»¶æ®µè½ 1ï¼šã€Œå“¡å·¥å¹´å‡ç‚º 7 å¤©ï¼Œç—…å‡ç‚º 14 å¤©ã€
â†’ OpenAI API è½‰æ›
â†’ Embedding 1: [0.23, -0.45, 0.67, ..., 0.12]ï¼ˆ1536 ç¶­å‘é‡ï¼‰

æ–‡ä»¶æ®µè½ 2ï¼šã€Œç‰¹ä¼‘å‡ä¾å¹´è³‡è¨ˆç®—ï¼Œç¬¬ä¸€å¹´ 3 å¤©ã€
â†’ OpenAI API è½‰æ›
â†’ Embedding 2: [0.25, -0.42, 0.70, ..., 0.15]

æ–‡ä»¶æ®µè½ 3ï¼šã€Œç”¢å“é€€æ¬¾æ”¿ç­–ï¼š7 å¤©å…§å¯å…¨é¡é€€è²»ã€
â†’ OpenAI API è½‰æ›
â†’ Embedding 3: [-0.10, 0.30, -0.50, ..., 0.80]
```

**æ­¥é©Ÿ 2ï¼šä½¿ç”¨è€…æå•**
```python
å•é¡Œï¼šã€Œè«‹å‡è¦å®šæ˜¯ä»€éº¼ï¼Ÿã€
â†’ OpenAI API è½‰æ›
â†’ Query Embedding: [0.24, -0.44, 0.68, ..., 0.13]
```

**æ­¥é©Ÿ 3ï¼šè¨ˆç®—ç›¸ä¼¼åº¦ï¼ˆå‘é‡è·é›¢ï¼‰**
```python
Query vs. Embedding 1: è·é›¢ 0.08 âœ… å¾ˆç›¸ä¼¼ï¼
Query vs. Embedding 2: è·é›¢ 0.12 âœ… ç›¸ä¼¼
Query vs. Embedding 3: è·é›¢ 0.95 âŒ ä¸ç›¸é—œ
```

**æ­¥é©Ÿ 4ï¼šè¿”å›æœ€ç›¸é—œçš„æ®µè½**
```python
Top 1: ã€Œå“¡å·¥å¹´å‡ç‚º 7 å¤©ï¼Œç—…å‡ç‚º 14 å¤©ã€ï¼ˆç›¸ä¼¼åº¦ 0.92ï¼‰
Top 2: ã€Œç‰¹ä¼‘å‡ä¾å¹´è³‡è¨ˆç®—...ã€ï¼ˆç›¸ä¼¼åº¦ 0.88ï¼‰
```

---

### 2.4 æˆæœ¬èˆ‡é¸æ“‡

**OpenAI Embedding æ¨¡å‹é¸æ“‡**

| æ¨¡å‹ | ç¶­åº¦ | æˆæœ¬ | é©ç”¨å ´æ™¯ |
|-----|------|-----|---------|
| `text-embedding-3-small` | 1536 | $0.02 / ç™¾è¬ tokens | âœ… **æ¨è–¦**ï¼šCP å€¼æœ€é«˜ |
| `text-embedding-3-large` | 3072 | $0.13 / ç™¾è¬ tokens | å¤§å‹å°ˆæ¡ˆã€éœ€è¦æ¥µé«˜ç²¾ç¢ºåº¦ |
| `text-embedding-ada-002`ï¼ˆèˆŠç‰ˆï¼‰ | 1536 | $0.10 / ç™¾è¬ tokens | å·²è¢« small å–ä»£ |

**æˆæœ¬ä¼°ç®—ç¯„ä¾‹**ï¼š
```
å‡è¨­ï¼šä¸Šå‚³ 20 ä»½æ–‡ä»¶ï¼Œæ¯ä»½ 5000 å­—
ç¸½å­—æ•¸ï¼š20 Ã— 5000 = 100,000 å­—
Token æ•¸ï¼šç´„ 150,000 tokensï¼ˆä¸­æ–‡ 1 å­— â‰ˆ 1.5 tokensï¼‰

ä½¿ç”¨ text-embedding-3-smallï¼š
æˆæœ¬ = 0.15M tokens Ã— $0.02 = $0.003ï¼ˆç´„ 0.1 å°å¹£ï¼‰

æ¯æœˆ 1000 æ¬¡æŸ¥è©¢ï¼ˆæ¯æ¬¡ 100 å­—ï¼‰ï¼š
æˆæœ¬ = 0.15M tokens Ã— $0.02 = $0.003ï¼ˆç´„ 0.1 å°å¹£ï¼‰

ç¸½è¨ˆï¼šç´„ 0.2 å°å¹£/æœˆ
```

**çµè«–**ï¼šæˆæœ¬éå¸¸ä½å»‰ï¼Œä¸ç”¨æ“”å¿ƒï¼

---

## ç¬¬ 3 éƒ¨åˆ†ï¼šSupabase è³‡æ–™åº«è¨­å®š

### 3.1 ç‚ºä»€éº¼é¸æ“‡ Supabaseï¼Ÿ

**Supabase = é–‹æºçš„ Firebase æ›¿ä»£å“ï¼ˆåŸºæ–¼ PostgreSQLï¼‰**

**ç‚ºä»€éº¼é¸å®ƒï¼Ÿ**
1. âœ… **å…§å»ºå‘é‡æœå°‹**ï¼ˆpgvector extensionï¼‰- å°ˆç‚º RAG è¨­è¨ˆ
2. âœ… **å…è²»é¡åº¦**ï¼š500 MB è³‡æ–™åº« + 1 GB æª”æ¡ˆå„²å­˜
3. âœ… **ç°¡å–®æ˜“ç”¨**ï¼šç¶²é ä»‹é¢ç®¡ç†ï¼Œä¸éœ€è¦å¯« SQL
4. âœ… **è‡ªå‹•å‚™ä»½**ï¼šè³‡æ–™ä¸æœƒéºå¤±
5. âœ… **å³æ™‚æ“´å±•**ï¼šæµé‡è®Šå¤§æ™‚å¯ä»¥ä¸€éµå‡ç´š

**å…¶ä»–é¸æ“‡æ¯”è¼ƒ**ï¼š

| æ–¹æ¡ˆ | å„ªé» | ç¼ºé» | é©ç”¨ |
|-----|------|-----|------|
| **Supabase + pgvector** | å…è²»ã€æ˜“ç”¨ã€å‘é‡æœå°‹åŸç”Ÿæ”¯æ´ | å…è²»ç‰ˆæœ‰è³‡æ–™é‡é™åˆ¶ | âœ… æ¨è–¦æ–°æ‰‹ |
| Pinecone | å°ˆç‚ºå‘é‡æœå°‹è¨­è¨ˆã€æ•ˆèƒ½æ¥µä½³ | ä»˜è²»ï¼ˆ$70/æœˆèµ·ï¼‰ | å¤§å‹å°ˆæ¡ˆ |
| Weaviate | é–‹æºã€åŠŸèƒ½å¼·å¤§ | éœ€è¦è‡ªå·±æ¶è¨­ä¼ºæœå™¨ | æŠ€è¡“åœ˜éšŠ |
| è‡ªå»º PostgreSQL | å®Œå…¨æ§åˆ¶ã€ç„¡é™åˆ¶ | éœ€è¦ç¶­è­·ã€è¨­å®šè¤‡é›œ | é€²éšä½¿ç”¨è€… |

---

### 3.2 è³‡æ–™å¦‚ä½•å„²å­˜ï¼Ÿ

**è³‡æ–™åº«çµæ§‹ï¼ˆER Diagramï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   datasources   â”‚ è³‡æ–™ä¾†æºï¼ˆæ–‡ä»¶çš„ä¾†æºï¼‰
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id              â”‚ ç·¨è™Ÿ
â”‚ type            â”‚ é¡å‹ï¼ˆpdfã€urlã€textï¼‰
â”‚ source_uri      â”‚ æª”æ¡ˆè·¯å¾‘æˆ–ç¶²å€
â”‚ created_at      â”‚ å»ºç«‹æ™‚é–“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1 å°å¤š
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   documents     â”‚ æ–‡ä»¶ï¼ˆæ¯ä»½ PDFã€ç¶²é ï¼‰
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id              â”‚ ç·¨è™Ÿ
â”‚ datasource_id   â”‚ ä¾†æºç·¨è™Ÿï¼ˆå¤–éµï¼‰
â”‚ title           â”‚ æ–‡ä»¶æ¨™é¡Œ
â”‚ bytes           â”‚ æª”æ¡ˆå¤§å°
â”‚ pages           â”‚ é æ•¸
â”‚ text_length     â”‚ æ–‡å­—é•·åº¦
â”‚ created_at      â”‚ å»ºç«‹æ™‚é–“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1 å°å¤š
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     chunks      â”‚ æ–‡å­—ç‰‡æ®µï¼ˆåˆ‡å¥½çš„æ®µè½ï¼‰
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id              â”‚ ç·¨è™Ÿ
â”‚ doc_id          â”‚ æ–‡ä»¶ç·¨è™Ÿï¼ˆå¤–éµï¼‰
â”‚ ordinal         â”‚ é †åºï¼ˆç¬¬å¹¾æ®µï¼‰
â”‚ text            â”‚ æ®µè½æ–‡å­—å…§å®¹
â”‚ chunk_strategy  â”‚ åˆ‡ç‰‡ç­–ç•¥ï¼ˆsentenceã€fixedã€semanticï¼‰
â”‚ created_at      â”‚ å»ºç«‹æ™‚é–“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1 å° 1
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   embeddings    â”‚ å‘é‡ï¼ˆæ•¸å­—é™£åˆ—ï¼‰
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id              â”‚ ç·¨è™Ÿ
â”‚ chunk_id        â”‚ æ®µè½ç·¨è™Ÿï¼ˆå¤–éµï¼‰
â”‚ embedding       â”‚ å‘é‡ï¼ˆ1536 ç¶­é™£åˆ—ï¼‰â­
â”‚ created_at      â”‚ å»ºç«‹æ™‚é–“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¯¦éš›è³‡æ–™ç¯„ä¾‹**ï¼š

**documents è¡¨**
| id | title | pages | text_length |
|----|-------|-------|-------------|
| 1 | å“¡å·¥æ‰‹å†Š.pdf | 50 | 25000 |
| 2 | ç”¢å“èªªæ˜.pdf | 30 | 15000 |

**chunks è¡¨**
| id | doc_id | ordinal | text |
|----|--------|---------|------|
| 1 | 1 | 0 | ã€Œå“¡å·¥å¹´å‡ç‚º 7 å¤©ï¼Œç—…å‡ç‚º 14 å¤©...ã€ |
| 2 | 1 | 1 | ã€Œç‰¹ä¼‘å‡ä¾å¹´è³‡è¨ˆç®—ï¼Œç¬¬ä¸€å¹´ 3 å¤©...ã€ |
| 3 | 2 | 0 | ã€Œç”¢å“åŠŸèƒ½åŒ…å«ï¼šç”¨æˆ¶ç®¡ç†ã€æ¬Šé™è¨­å®š...ã€ |

**embeddings è¡¨**
| id | chunk_id | embedding |
|----|----------|-----------|
| 1 | 1 | [0.23, -0.45, 0.67, ..., 0.12] |
| 2 | 2 | [0.25, -0.42, 0.70, ..., 0.15] |
| 3 | 3 | [-0.10, 0.30, -0.50, ..., 0.80] |

---

### 3.3 è¨­å®š Supabase å°ˆæ¡ˆ

**æ­¥é©Ÿ 1ï¼šå»ºç«‹ Supabase å°ˆæ¡ˆ**

1. å‰å¾€ [https://supabase.com](https://supabase.com)
2. é»æ“Šã€ŒStart your projectã€
3. ä½¿ç”¨ GitHub å¸³è™Ÿç™»å…¥
4. é»æ“Šã€ŒNew Projectã€
5. å¡«å¯«è³‡è¨Šï¼š
   - **Name**: `my-rag-project`
   - **Database Password**: è¨­å®šå¼·å¯†ç¢¼ï¼ˆè¨˜ä¸‹ä¾†ï¼ï¼‰
   - **Region**: é¸æ“‡ã€ŒNortheast Asia (Tokyo)ã€ï¼ˆé›¢å°ç£æœ€è¿‘ï¼‰
   - **Pricing Plan**: Freeï¼ˆå…è²»ç‰ˆå³å¯ï¼‰
6. é»æ“Šã€ŒCreate new projectã€
7. ç­‰å¾… 2-3 åˆ†é˜ï¼Œå°ˆæ¡ˆå»ºç«‹å®Œæˆ

---

**æ­¥é©Ÿ 2ï¼šå•Ÿç”¨ pgvector æ“´å……åŠŸèƒ½**

1. é»æ“Šå·¦å´é¸å–®ã€ŒDatabaseã€â†’ã€ŒExtensionsã€
2. æœå°‹ã€Œvectorã€
3. æ‰¾åˆ°ã€Œvectorã€ï¼Œé»æ“Šã€ŒEnableã€
4. å•Ÿç”¨æˆåŠŸï¼ï¼ˆç¾åœ¨å¯ä»¥å„²å­˜å’Œæœå°‹å‘é‡ï¼‰

---

**æ­¥é©Ÿ 3ï¼šå»ºç«‹è³‡æ–™è¡¨**

1. é»æ“Šå·¦å´é¸å–®ã€ŒSQL Editorã€
2. é»æ“Šã€ŒNew queryã€
3. è¤‡è£½è²¼ä¸Šä»¥ä¸‹ SQLï¼ˆå®Œæ•´å»ºè¡¨èªæ³•ï¼‰ï¼š

```sql
-- 1. å»ºç«‹ datasources è¡¨
CREATE TABLE datasources (
    id SERIAL PRIMARY KEY,
    type VARCHAR(50) NOT NULL,
    source_uri TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- 2. å»ºç«‹ documents è¡¨
CREATE TABLE documents (
    id SERIAL PRIMARY KEY,
    datasource_id INTEGER REFERENCES datasources(id) ON DELETE CASCADE,
    title VARCHAR(500) NOT NULL,
    bytes INTEGER,
    pages INTEGER,
    text_length INTEGER,
    meta_json JSONB DEFAULT '{}',
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- 3. å»ºç«‹ chunks è¡¨
CREATE TABLE chunks (
    id SERIAL PRIMARY KEY,
    doc_id INTEGER REFERENCES documents(id) ON DELETE CASCADE,
    ordinal INTEGER NOT NULL,
    text TEXT NOT NULL,
    chunk_strategy VARCHAR(50) DEFAULT 'sentence',
    meta_json JSONB DEFAULT '{}',
    created_at TIMESTAMP DEFAULT NOW()
);

-- 4. å»ºç«‹ embeddings è¡¨ï¼ˆå«å‘é‡æ¬„ä½ï¼‰
CREATE TABLE embeddings (
    id SERIAL PRIMARY KEY,
    chunk_id INTEGER REFERENCES chunks(id) ON DELETE CASCADE UNIQUE,
    embedding vector(1536),  -- â­ å‘é‡æ¬„ä½ï¼ˆ1536 ç¶­ï¼‰
    created_at TIMESTAMP DEFAULT NOW()
);

-- 5. å»ºç«‹ç´¢å¼•ï¼ˆåŠ é€Ÿå‘é‡æœå°‹ï¼‰
CREATE INDEX idx_embeddings_vector
ON embeddings USING ivfflat (embedding vector_cosine_ops)
WITH (lists = 100);

-- 6. å»ºç«‹å¤–éµç´¢å¼•ï¼ˆåŠ é€ŸæŸ¥è©¢ï¼‰
CREATE INDEX idx_documents_datasource ON documents(datasource_id);
CREATE INDEX idx_chunks_doc ON chunks(doc_id);
CREATE INDEX idx_embeddings_chunk ON embeddings(chunk_id);
```

4. é»æ“Šã€ŒRunã€åŸ·è¡Œ
5. çœ‹åˆ°ã€ŒSuccess. No rows returnedã€ä»£è¡¨æˆåŠŸï¼

---

**æ­¥é©Ÿ 4ï¼šå–å¾—é€£ç·šè³‡è¨Š**

1. é»æ“Šå·¦å´é¸å–®ã€ŒSettingsã€â†’ã€ŒDatabaseã€
2. æ‰¾åˆ°ã€ŒConnection stringã€
3. é¸æ“‡ã€ŒURIã€æ¨¡å¼
4. è¤‡è£½é¡ä¼¼é€™æ¨£çš„é€£ç·šå­—ä¸²ï¼š
   ```
   postgresql://postgres:[YOUR-PASSWORD]@db.xxxxx.supabase.co:5432/postgres
   ```
5. å°‡ `[YOUR-PASSWORD]` æ›¿æ›æˆæ­¥é©Ÿ 1 è¨­å®šçš„å¯†ç¢¼
6. **å„²å­˜èµ·ä¾†**ï¼ˆå¾Œé¢æœƒç”¨åˆ°ï¼‰

---

**æ­¥é©Ÿ 5ï¼šè¨­å®šå„²å­˜ç©ºé–“ï¼ˆStorageï¼‰**

1. é»æ“Šå·¦å´é¸å–®ã€ŒStorageã€
2. é»æ“Šã€ŒCreate a new bucketã€
3. å¡«å¯«ï¼š
   - **Name**: `documents`
   - **Public bucket**: é—œé–‰ï¼ˆä¿æŒç§æœ‰ï¼‰
4. é»æ“Šã€ŒCreate bucketã€
5. å®Œæˆï¼ï¼ˆç”¨ä¾†å„²å­˜ä¸Šå‚³çš„ PDF æª”æ¡ˆï¼‰

---

### 3.4 è¨­å®šç’°å¢ƒè®Šæ•¸ï¼ˆ.env æª”æ¡ˆï¼‰

**ä»€éº¼æ˜¯ç’°å¢ƒè®Šæ•¸ï¼Ÿç‚ºä»€éº¼è¦ç”¨ .env æª”æ¡ˆï¼Ÿ**

**å•é¡Œ**ï¼šç¨‹å¼ç¢¼éœ€è¦ä½¿ç”¨å„ç¨®ã€Œå¯†ç¢¼ã€å’Œã€Œé‡‘é‘°ã€
- è³‡æ–™åº«å¯†ç¢¼
- OpenAI API Key
- Supabase é‡‘é‘°

**âŒ éŒ¯èª¤åšæ³•ï¼šç›´æ¥å¯«åœ¨ç¨‹å¼ç¢¼è£¡**
```python
# âŒ å±éšªï¼åƒè¬ä¸è¦é€™æ¨£åš
DATABASE_URL = "postgresql://admin:password123@db.example.com/mydb"
OPENAI_API_KEY = "sk-proj-abc123..."

# å•é¡Œï¼š
# 1. ä¸Šå‚³åˆ° GitHub æ™‚ï¼Œå…¨ä¸–ç•Œéƒ½çœ‹å¾—åˆ°ä½ çš„å¯†ç¢¼
# 2. é–‹ç™¼/æ¸¬è©¦/æ­£å¼ç’°å¢ƒçš„å¯†ç¢¼ä¸åŒï¼Œæ¯æ¬¡éƒ½è¦æ”¹ç¨‹å¼ç¢¼
# 3. åœ˜éšŠæˆå“¡çš„å¯†ç¢¼å¯èƒ½ä¸åŒ
```

**âœ… æ­£ç¢ºåšæ³•ï¼šä½¿ç”¨ .env æª”æ¡ˆ**
```python
# âœ… å®‰å…¨ï¼å¾ç’°å¢ƒè®Šæ•¸è®€å–
import os
DATABASE_URL = os.getenv("DATABASE_URL")
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")

# å„ªé»ï¼š
# 1. .env æª”æ¡ˆä¸æœƒä¸Šå‚³åˆ° GitHubï¼ˆåœ¨ .gitignore è£¡ï¼‰
# 2. æ¯å€‹ç’°å¢ƒå¯ä»¥æœ‰ä¸åŒçš„ .env
# 3. æ¯å€‹é–‹ç™¼è€…å¯ä»¥ç”¨è‡ªå·±çš„å¯†ç¢¼
```

---

**æ­¥é©Ÿ 1ï¼šå–å¾—æ‰€éœ€çš„é‡‘é‘°å’Œå¯†ç¢¼**

**1.1 å–å¾— Supabase é€£ç·šè³‡è¨Š**

å‰å¾€ä½ çš„ Supabase å°ˆæ¡ˆï¼š

1. é»æ“Šå·¦å´é¸å–®ã€ŒSettingsã€â†’ã€ŒDatabaseã€
2. æ‰¾åˆ°ã€ŒConnection stringã€å€å¡Š
3. é¸æ“‡ã€ŒURIã€æ¨¡å¼
4. è¤‡è£½é€£ç·šå­—ä¸²ï¼Œé¡ä¼¼ï¼š
   ```
   postgresql://postgres.xxxxx:[YOUR-PASSWORD]@aws-0-ap-northeast-1.pooler.supabase.com:5432/postgres
   ```
5. **è¨˜ä¸‹ä¾†**ï¼Œç­‰ç­‰æœƒç”¨åˆ°

---

**1.2 å–å¾— Supabase API Keys**

1. é»æ“Šå·¦å´é¸å–®ã€ŒSettingsã€â†’ã€ŒAPIã€
2. æ‰¾åˆ°ã€ŒProject API keysã€å€å¡Š
3. è¤‡è£½å…©å€‹ Keyï¼š

**Anon Key**ï¼ˆå…¬é–‹é‡‘é‘°ï¼Œå‰ç«¯å¯ç”¨ï¼‰
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6...
```

**Service Role Key**ï¼ˆç§å¯†é‡‘é‘°ï¼Œå¾Œç«¯å°ˆç”¨ï¼‰âš ï¸ åƒè¬ä¸è¦å¤–æ´©
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6...
```

4. **è¤‡è£½ä¸¦å„²å­˜é€™å…©å€‹ Key**

---

**1.3 å–å¾— Supabase URL**

åœ¨åŒä¸€é é¢ã€ŒSettingsã€â†’ã€ŒAPIã€ï¼Œæ‰¾åˆ°ï¼š

**Project URL**
```
https://xxxxx.supabase.co
```

è¤‡è£½å„²å­˜

---

**1.4 å–å¾— OpenAI API Key**

1. å‰å¾€ [https://platform.openai.com/api-keys](https://platform.openai.com/api-keys)
2. é»æ“Šã€ŒCreate new secret keyã€
3. å‘½åï¼š`rag-project-key`
4. é»æ“Šã€ŒCreate secret keyã€
5. **ç«‹å³è¤‡è£½ä¸¦å„²å­˜**ï¼ˆåªæœƒé¡¯ç¤ºä¸€æ¬¡ï¼ï¼‰
   ```
   sk-proj-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   ```
6. å¦‚æœå¿˜è¨˜äº†ï¼Œåªèƒ½åˆªé™¤é‡å»º

---

**æ­¥é©Ÿ 2ï¼šå»ºç«‹ .env æª”æ¡ˆ**

**2.1 åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„å»ºç«‹ .env æª”æ¡ˆ**

**Mac / Linux ä½¿ç”¨è€…**ï¼š
```bash
# é€²å…¥å°ˆæ¡ˆè³‡æ–™å¤¾
cd /path/to/your/project

# å»ºç«‹ .env æª”æ¡ˆ
touch .env

# ç”¨æ–‡å­—ç·¨è¼¯å™¨é–‹å•Ÿ
nano .env
# æˆ–
code .env  # å¦‚æœæœ‰å®‰è£ VS Code
```

**Windows ä½¿ç”¨è€…**ï¼š
```bash
# é€²å…¥å°ˆæ¡ˆè³‡æ–™å¤¾
cd C:\path\to\your\project

# å»ºç«‹ .env æª”æ¡ˆ
echo. > .env

# ç”¨è¨˜äº‹æœ¬é–‹å•Ÿ
notepad .env
```

---

**2.2 å¡«å¯«ç’°å¢ƒè®Šæ•¸**

åœ¨ `.env` æª”æ¡ˆä¸­ï¼Œè²¼ä¸Šä»¥ä¸‹å…§å®¹ä¸¦**æ›¿æ›æˆä½ çš„å¯¦éš›å€¼**ï¼š

```bash
# ============================================
# RAG ç³»çµ±ç’°å¢ƒè®Šæ•¸è¨­å®š
# ============================================
# âš ï¸ æ­¤æª”æ¡ˆåŒ…å«æ•æ„Ÿè³‡è¨Šï¼Œè«‹å‹¿ä¸Šå‚³åˆ° GitHub
# ============================================

# === è³‡æ–™åº«é€£ç·š ===
# æ ¼å¼ï¼špostgresql://ä½¿ç”¨è€…åç¨±:å¯†ç¢¼@ä¸»æ©Ÿä½å€:åŸ è™Ÿ/è³‡æ–™åº«åç¨±
DATABASE_URL=postgresql://postgres.xxxxx:ä½ çš„å¯†ç¢¼@aws-0-ap-northeast-1.pooler.supabase.com:5432/postgres

# Direct connectionï¼ˆç›´æ¥é€£ç·šï¼Œä¸ç¶“é Poolerï¼‰
DATABASE_URL_DIRECT=postgresql://postgres.xxxxx:ä½ çš„å¯†ç¢¼@aws-0-ap-northeast-1.pooler.supabase.com:5432/postgres

# === ç³»çµ±å®‰å…¨é‡‘é‘° ===
# ç”¨æ–¼åŠ å¯† Sessionã€JWT ç­‰ï¼ˆè‡³å°‘ 32 å­—å…ƒï¼‰
# å»ºè­°ç”¢ç”Ÿæ–¹å¼ï¼šopenssl rand -hex 32
SECRET_KEY=è«‹ç”¨äº‚æ•¸ç”¢ç”Ÿè‡³å°‘32å­—å…ƒçš„å¯†é‘°ä¾‹å¦‚a1b2c3d4e5f6...

# === OpenAI API ===
OPENAI_API_KEY=sk-proj-ä½ çš„OpenAIé‡‘é‘°

# === Supabase ===
SUPABASE_URL=https://ä½ çš„å°ˆæ¡ˆID.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...ä½ çš„Anoné‡‘é‘°
SUPABASE_SERVICE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...ä½ çš„Serviceé‡‘é‘°
```

---

**2.3 ç”¢ç”Ÿå®‰å…¨çš„ SECRET_KEY**

**æ–¹æ³• 1ï¼šä½¿ç”¨ OpenSSLï¼ˆMac / Linuxï¼‰**
```bash
openssl rand -hex 32
```
è¼¸å‡ºç¯„ä¾‹ï¼š
```
a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6
```
è¤‡è£½é€™ä¸²ï¼Œè²¼åˆ° `.env` çš„ `SECRET_KEY=` å¾Œé¢

**æ–¹æ³• 2ï¼šä½¿ç”¨ Python**
```bash
python -c "import secrets; print(secrets.token_hex(32))"
```

**æ–¹æ³• 3ï¼šç·šä¸Šç”¢ç”Ÿå™¨**
å‰å¾€ï¼š[https://randomkeygen.com/](https://randomkeygen.com/)
é¸æ“‡ã€ŒFort Knox Passwordsã€ï¼ˆ256-bit é‡‘é‘°ï¼‰

---

**æ­¥é©Ÿ 3ï¼šé©—è­‰ .env æª”æ¡ˆæ ¼å¼**

**âœ… æ­£ç¢ºæ ¼å¼**ï¼š
```bash
DATABASE_URL=postgresql://user:pass@host:5432/db
OPENAI_API_KEY=sk-proj-abc123
```

**âŒ éŒ¯èª¤æ ¼å¼**ï¼š
```bash
# âŒ ä¸è¦æœ‰ç©ºæ ¼
DATABASE_URL = postgresql://...

# âŒ ä¸è¦ç”¨å¼•è™Ÿï¼ˆé™¤éå€¼æœ¬èº«åŒ…å«ç©ºæ ¼ï¼‰
OPENAI_API_KEY="sk-proj-abc123"

# âŒ ä¸è¦æœ‰æ›è¡Œ
DATABASE_URL=postgresql://user:pass
@host:5432/db
```

---

**æ­¥é©Ÿ 4ï¼šç¢ºä¿ .env ä¸æœƒä¸Šå‚³åˆ° GitHub**

**4.1 æª¢æŸ¥ .gitignore æª”æ¡ˆ**

ç¢ºèªå°ˆæ¡ˆæ ¹ç›®éŒ„çš„ `.gitignore` æª”æ¡ˆåŒ…å«ï¼š

```bash
# ç’°å¢ƒè®Šæ•¸ï¼ˆçµ•å°ä¸èƒ½ä¸Šå‚³ï¼ï¼‰
.env
.env.local
.env.*.local

# å‚™ä»½æª”æ¡ˆ
.env.backup
```

**4.2 é©—è­‰ .env æ˜¯å¦è¢«å¿½ç•¥**

```bash
# æŸ¥çœ‹ Git ç‹€æ…‹
git status

# å¦‚æœçœ‹åˆ° .env å‡ºç¾åœ¨æ¸…å–®ä¸­ â†’ âŒ å±éšªï¼
# å¦‚æœæ²’æœ‰çœ‹åˆ° .env â†’ âœ… å®‰å…¨
```

**4.3 å¦‚æœä¸å°å¿ƒå·²ç¶“ commit äº† .env æ€éº¼è¾¦ï¼Ÿ**

```bash
# âš ï¸ ç·Šæ€¥è™•ç†ï¼šå¾ Git æ­·å²ä¸­ç§»é™¤
git rm --cached .env
git commit -m "Remove .env from git history"

# âš ï¸ ç«‹å³æ›´æ›æ‰€æœ‰é‡‘é‘°ï¼
# 1. é‡æ–°ç”¢ç”Ÿ OpenAI API Key
# 2. é‡è¨­ Supabase è³‡æ–™åº«å¯†ç¢¼
# 3. é‡æ–°ç”¢ç”Ÿ Supabase Service Keyï¼ˆåœ¨ Dashboard â†’ Settings â†’ APIï¼‰
```

---

**æ­¥é©Ÿ 5ï¼šæ¸¬è©¦ç’°å¢ƒè®Šæ•¸æ˜¯å¦æ­£ç¢ºè¼‰å…¥**

**5.1 å»ºç«‹æ¸¬è©¦è…³æœ¬**

å»ºç«‹æª”æ¡ˆ `test_env.py`ï¼š

```python
import os
from dotenv import load_dotenv

# è¼‰å…¥ .env æª”æ¡ˆ
load_dotenv()

# æ¸¬è©¦è®€å–
print("=== ç’°å¢ƒè®Šæ•¸æ¸¬è©¦ ===")
print(f"DATABASE_URL: {os.getenv('DATABASE_URL')[:30]}...")  # åªé¡¯ç¤ºå‰ 30 å­—å…ƒ
print(f"OPENAI_API_KEY: {os.getenv('OPENAI_API_KEY')[:20]}...")
print(f"SUPABASE_URL: {os.getenv('SUPABASE_URL')}")
print(f"SECRET_KEY length: {len(os.getenv('SECRET_KEY', ''))}")

# é©—è­‰å¿…è¦è®Šæ•¸å­˜åœ¨
required_vars = [
    "DATABASE_URL",
    "OPENAI_API_KEY",
    "SUPABASE_URL",
    "SUPABASE_SERVICE_KEY",
    "SECRET_KEY"
]

missing_vars = [var for var in required_vars if not os.getenv(var)]

if missing_vars:
    print("\nâŒ ç¼ºå°‘ä»¥ä¸‹ç’°å¢ƒè®Šæ•¸ï¼š")
    for var in missing_vars:
        print(f"  - {var}")
else:
    print("\nâœ… æ‰€æœ‰å¿…è¦çš„ç’°å¢ƒè®Šæ•¸éƒ½å·²è¨­å®šï¼")
```

**5.2 åŸ·è¡Œæ¸¬è©¦**

```bash
python test_env.py
```

**é æœŸè¼¸å‡º**ï¼š
```
=== ç’°å¢ƒè®Šæ•¸æ¸¬è©¦ ===
DATABASE_URL: postgresql://postgres.xxxxx...
OPENAI_API_KEY: sk-proj-abc123...
SUPABASE_URL: https://xxxxx.supabase.co
SECRET_KEY length: 64

âœ… æ‰€æœ‰å¿…è¦çš„ç’°å¢ƒè®Šæ•¸éƒ½å·²è¨­å®šï¼
```

å¦‚æœçœ‹åˆ° `âŒ ç¼ºå°‘ä»¥ä¸‹ç’°å¢ƒè®Šæ•¸`ï¼Œå›åˆ°æ­¥é©Ÿ 2 è£œé½Šã€‚

---

**æ­¥é©Ÿ 6ï¼šä¸åŒç’°å¢ƒçš„ .env ç®¡ç†**

**å¯¦å‹™ä¸Šï¼Œä½ æœƒéœ€è¦å¤šå€‹ç’°å¢ƒ**ï¼š

```
å°ˆæ¡ˆ/
â”œâ”€â”€ .env                  # æœ¬åœ°é–‹ç™¼ï¼ˆä½ è‡ªå·±çš„é›»è…¦ï¼‰
â”œâ”€â”€ .env.example          # ç¯„æœ¬æª”æ¡ˆï¼ˆå¯ä¸Šå‚³ GitHubï¼‰
â”œâ”€â”€ .env.staging          # æ¸¬è©¦ç’°å¢ƒï¼ˆé¸ç”¨ï¼‰
â””â”€â”€ .env.production       # æ­£å¼ç’°å¢ƒï¼ˆä¼ºæœå™¨ä¸Šï¼‰
```

---

**6.1 å»ºç«‹ .env.example ç¯„æœ¬**

**ç›®çš„**ï¼šå‘Šè¨´å…¶ä»–é–‹ç™¼è€…éœ€è¦å“ªäº›ç’°å¢ƒè®Šæ•¸ï¼Œä½†ä¸åŒ…å«å¯¦éš›çš„é‡‘é‘°

å»ºç«‹æª”æ¡ˆ `.env.example`ï¼š

```bash
# === SECRETS ONLY ===
# è«‹è¤‡è£½æ­¤æª”æ¡ˆç‚º .envï¼Œä¸¦å¡«å…¥ä½ çš„å¯¦éš›é‡‘é‘°
# æœ¬æª”æ¡ˆå¯ä»¥ä¸Šå‚³åˆ° GitHubï¼ˆç¯„æœ¬ç”¨ï¼‰

# è³‡æ–™åº«é€£ç·š
DATABASE_URL=postgresql://YOUR_USER:YOUR_PASSWORD@YOUR_HOST:5432/YOUR_DATABASE
DATABASE_URL_DIRECT=postgresql://YOUR_USER:YOUR_PASSWORD@YOUR_HOST:5432/YOUR_DATABASE

# ç³»çµ±å®‰å…¨é‡‘é‘°ï¼ˆä½¿ç”¨ openssl rand -hex 32 ç”¢ç”Ÿï¼‰
SECRET_KEY=your-secret-key-min-32-chars

# OpenAI API Key
OPENAI_API_KEY=sk-proj-xxx

# Supabase
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_KEY=your-service-key
```

é€™å€‹æª”æ¡ˆ**å¯ä»¥å®‰å…¨ä¸Šå‚³åˆ° GitHub**ï¼Œå› ç‚ºéƒ½æ˜¯å‡çš„ç¯„ä¾‹å€¼ã€‚

---

**6.2 æ–°é–‹ç™¼è€…åŠ å…¥å°ˆæ¡ˆçš„æ­¥é©Ÿ**

```bash
# 1. Clone å°ˆæ¡ˆ
git clone https://github.com/your-org/your-project.git
cd your-project

# 2. è¤‡è£½ç¯„æœ¬
cp .env.example .env

# 3. ç·¨è¼¯ .envï¼Œå¡«å…¥è‡ªå·±çš„é‡‘é‘°
nano .env
# æˆ–
code .env

# 4. æ¸¬è©¦
python test_env.py
```

---

**6.3 ä¼ºæœå™¨éƒ¨ç½²æ™‚çš„ç’°å¢ƒè®Šæ•¸è¨­å®š**

**é›²ç«¯å¹³å°ï¼ˆCloud Runã€Herokuã€Vercel ç­‰ï¼‰**ï¼š

ä¸ç”¨ä¸Šå‚³ `.env` æª”æ¡ˆï¼åœ¨å¹³å°çš„ Dashboard è¨­å®šç’°å¢ƒè®Šæ•¸ï¼š

**Google Cloud Run ç¯„ä¾‹**ï¼š
```bash
gcloud run deploy my-service \
  --set-env-vars DATABASE_URL="postgresql://..." \
  --set-env-vars OPENAI_API_KEY="sk-proj-..." \
  --set-env-vars SUPABASE_URL="https://..."
```

**æˆ–åœ¨ Web Console**ï¼š
1. é€²å…¥ Cloud Run â†’ é¸æ“‡æœå‹™
2. é»æ“Šã€ŒEdit & Deploy New Revisionã€
3. å±•é–‹ã€ŒVariables & Secretsã€
4. é»æ“Šã€ŒAdd Variableã€
5. é€ä¸€æ–°å¢ç’°å¢ƒè®Šæ•¸

---

**æ­¥é©Ÿ 7ï¼šå®‰å…¨æœ€ä½³å¯¦è¸**

**âœ… æ‡‰è©²åšçš„**ï¼š
- âœ… ä½¿ç”¨ `.env` æª”æ¡ˆå„²å­˜é‡‘é‘°
- âœ… å°‡ `.env` åŠ å…¥ `.gitignore`
- âœ… æä¾› `.env.example` ç¯„æœ¬
- âœ… å®šæœŸè¼ªæ›é‡‘é‘°ï¼ˆæ¯ 3-6 å€‹æœˆï¼‰
- âœ… ä¸åŒç’°å¢ƒä½¿ç”¨ä¸åŒé‡‘é‘°
- âœ… é™åˆ¶ API Key æ¬Šé™ï¼ˆä¾‹å¦‚è¨­å®šæ¯æœˆé ç®—ä¸Šé™ï¼‰

**âŒ ä¸æ‡‰è©²åšçš„**ï¼š
- âŒ å°‡ `.env` ä¸Šå‚³åˆ° GitHub
- âŒ åœ¨ç¨‹å¼ç¢¼è£¡å¯«æ­»é‡‘é‘°
- âŒ ç”¨ Emailã€Slack å‚³é€é‡‘é‘°ï¼ˆç”¨å¯†ç¢¼ç®¡ç†å™¨ï¼‰
- âŒ å°‡æ­£å¼ç’°å¢ƒçš„é‡‘é‘°ç”¨åœ¨é–‹ç™¼ç’°å¢ƒ
- âŒ å°‡é‡‘é‘°å¯«åœ¨æˆªåœ–ã€æ–‡ä»¶è£¡

---

**æ­¥é©Ÿ 8ï¼šå¸¸è¦‹å•é¡Œæ’è§£**

**Q1ï¼šåŸ·è¡Œç¨‹å¼æ™‚å‡ºç¾ `KeyError: 'DATABASE_URL'`**

Aï¼šç’°å¢ƒè®Šæ•¸æ²’æœ‰æ­£ç¢ºè¼‰å…¥

```python
# ç¢ºèªæœ‰è¼‰å…¥ .env
from dotenv import load_dotenv
load_dotenv()  # â† åŠ ä¸Šé€™è¡Œ

import os
DATABASE_URL = os.getenv("DATABASE_URL")
```

---

**Q2ï¼š.env æª”æ¡ˆåœ¨å“ªè£¡ï¼Ÿ**

Aï¼šå°ˆæ¡ˆæ ¹ç›®éŒ„ï¼ˆèˆ‡ `app/`ã€`docs/` åŒå±¤ï¼‰

```
your-project/
â”œâ”€â”€ app/
â”œâ”€â”€ docs/
â”œâ”€â”€ .env          â† åœ¨é€™è£¡
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

---

**Q3ï¼šå¦‚ä½•ç¢ºèª .env æ²’æœ‰ä¸Šå‚³åˆ° GitHubï¼Ÿ**

```bash
# æ–¹æ³• 1ï¼šæª¢æŸ¥ git status
git status
# å¦‚æœæ²’æœ‰çœ‹åˆ° .env â†’ å®‰å…¨

# æ–¹æ³• 2ï¼šæª¢æŸ¥é ç«¯ repo
git ls-files | grep .env
# å¦‚æœæ²’æœ‰è¼¸å‡º â†’ å®‰å…¨

# æ–¹æ³• 3ï¼šä¸Š GitHub ç¶²é ç¢ºèª
# å°ˆæ¡ˆé é¢ â†’ æª”æ¡ˆåˆ—è¡¨ â†’ ä¸æ‡‰è©²çœ‹åˆ° .env
```

---

**Q4ï¼šåœ˜éšŠæˆå“¡çš„ .env æª”æ¡ˆå…§å®¹æ‡‰è©²ä¸€æ¨£å—ï¼Ÿ**

Aï¼š**ä¸ä¸€å®š**

- **ç›¸åŒ**ï¼šé–‹ç™¼ç’°å¢ƒçš„è³‡æ–™åº«ï¼ˆå…±ç”¨æ¸¬è©¦ DBï¼‰
- **ä¸åŒ**ï¼šOpenAI API Keyï¼ˆæ¯äººè‡ªå·±ç”³è«‹ï¼Œæ–¹ä¾¿è¿½è¹¤ç”¨é‡ï¼‰

ç¯„ä¾‹ï¼š
```bash
# å°æ˜çš„ .env
DATABASE_URL=postgresql://shared-dev-db/...
OPENAI_API_KEY=sk-proj-xiaoming123...

# å°è¯çš„ .env
DATABASE_URL=postgresql://shared-dev-db/...
OPENAI_API_KEY=sk-proj-xiaohua456...
```

---

**Q5ï¼šå¦‚ä½•åœ¨ Docker å®¹å™¨ä¸­ä½¿ç”¨ .envï¼Ÿ**

**æ–¹æ³• 1ï¼šä½¿ç”¨ `--env-file`**
```bash
docker run --env-file .env my-image
```

**æ–¹æ³• 2ï¼šåœ¨ `docker-compose.yml` ä¸­**
```yaml
services:
  app:
    image: my-image
    env_file:
      - .env
```

---

### 3.5 ç†è§£è³‡æ–™è¡¨çµæ§‹

**ç‚ºä»€éº¼éœ€è¦é€™éº¼å¤šè¡¨ï¼Ÿ**

**âŒ éŒ¯èª¤è¨­è¨ˆï¼šå…¨éƒ¨å¡åœ¨ä¸€å¼µè¡¨**
```sql
CREATE TABLE knowledge (
    id SERIAL,
    file_name TEXT,
    full_text TEXT,  -- âŒ æ•´ä»½æ–‡ä»¶ 10000 å­—
    embedding vector(1536)  -- âŒ åªæœ‰ä¸€å€‹å‘é‡ï¼Œç„¡æ³•ç²¾æº–æœå°‹
);
```
å•é¡Œï¼š
- æ•´ä»½æ–‡ä»¶å¤ªé•·ï¼ŒAI ç„¡æ³•è™•ç†
- åªæœ‰ä¸€å€‹å‘é‡ï¼Œæœå°‹ä¸ç²¾æº–

---

**âœ… æ­£ç¢ºè¨­è¨ˆï¼šåˆ†å±¤å„²å­˜**

1. **datasources**ï¼šè¨˜éŒ„æ–‡ä»¶ã€Œä¾†æºã€
   - ä¾‹å¦‚ï¼šã€Œå¾ PDF ä¸Šå‚³ã€ã€Œå¾ç¶²å€çˆ¬å–ã€

2. **documents**ï¼šè¨˜éŒ„ã€Œæ–‡ä»¶æœ¬èº«ã€
   - ä¾‹å¦‚ï¼šå“¡å·¥æ‰‹å†Š.pdfï¼ˆ50 é ï¼Œ25000 å­—ï¼‰

3. **chunks**ï¼šå°‡æ–‡ä»¶ã€Œåˆ‡æˆå°æ®µè½ã€
   - ä¾‹å¦‚ï¼šå“¡å·¥æ‰‹å†Šåˆ‡æˆ 100 æ®µï¼Œæ¯æ®µ 400 å­—

4. **embeddings**ï¼šç‚ºæ¯æ®µè½ç”Ÿæˆã€Œå‘é‡ã€
   - ä¾‹å¦‚ï¼šæ®µè½ 1 â†’ å‘é‡ 1ï¼Œæ®µè½ 2 â†’ å‘é‡ 2

**å¥½è™•**ï¼š
- âœ… æœå°‹æ›´ç²¾æº–ï¼ˆæ®µè½ç´šåˆ¥æœå°‹ï¼‰
- âœ… å¯ä»¥è¿½è¹¤ä¾†æºï¼ˆå“ªä»½æ–‡ä»¶ã€ç¬¬å¹¾æ®µï¼‰
- âœ… ç¯€çœæˆæœ¬ï¼ˆåªé‡æ–°è™•ç†ä¿®æ”¹çš„æ®µè½ï¼‰

---

## ç¬¬ 4 éƒ¨åˆ†ï¼šå¯¦éš›æ“ä½œ - å»ºç«‹ä½ çš„ RAG ç³»çµ±

### 4.1 ä¸Šå‚³æ–‡ä»¶åˆ°çŸ¥è­˜åº«

**æ–¹å¼ 1ï¼šä½¿ç”¨ Swagger UIï¼ˆæœ€ç°¡å–®ï¼‰**

1. é–‹å•Ÿ API æ¸¬è©¦ä»‹é¢ï¼š
   ```
   https://your-api-url.com/docs
   ```

2. æ‰¾åˆ° `POST /api/rag/ingest/files` ç«¯é»

3. é»æ“Šã€ŒTry it outã€

4. å¡«å¯«åƒæ•¸ï¼š
   ```json
   {
     "chunk_size": 400,
     "overlap": 80,
     "split_by_sentence": true
   }
   ```

5. é¸æ“‡æª”æ¡ˆï¼ˆé»æ“Šã€ŒChoose Fileã€ä¸Šå‚³ PDFï¼‰

6. é»æ“Šã€ŒExecuteã€

7. ç­‰å¾…è™•ç†ï¼ˆç´„ 10-30 ç§’ï¼‰

8. çœ‹åˆ° Responseï¼š
   ```json
   {
     "message": "Successfully processed document",
     "document_id": 123,
     "chunks_created": 25,
     "time_taken": "15.3s"
   }
   ```

9. å®Œæˆï¼æ–‡ä»¶å·²ä¸Šå‚³ä¸¦å‘é‡åŒ–

---

**æ–¹å¼ 2ï¼šä½¿ç”¨ cURL æŒ‡ä»¤ï¼ˆé©åˆæ‰¹æ¬¡ä¸Šå‚³ï¼‰**

```bash
curl -X POST "https://your-api-url.com/api/rag/ingest/files" \
  -F "file=@/path/to/your/document.pdf" \
  -F "chunk_size=400" \
  -F "overlap=80" \
  -F "split_by_sentence=true"
```

**æ‰¹æ¬¡ä¸Šå‚³å¤šå€‹æª”æ¡ˆ**ï¼š

```bash
# ä¸Šå‚³è³‡æ–™å¤¾å…§æ‰€æœ‰ PDF
for file in /path/to/documents/*.pdf; do
  curl -X POST "https://your-api-url.com/api/rag/ingest/files" \
    -F "file=@$file" \
    -F "chunk_size=400" \
    -F "overlap=80"
  echo "âœ… Uploaded: $file"
done
```

---

**åƒæ•¸èªªæ˜**ï¼š

| åƒæ•¸ | èªªæ˜ | å»ºè­°å€¼ |
|-----|------|--------|
| `chunk_size` | æ¯æ®µè½å­—æ•¸ | 400ï¼ˆä¸­æ–‡ç´„ 200-250 å­—ï¼‰ |
| `overlap` | æ®µè½é‡ç–Šå­—æ•¸ | 80ï¼ˆé¿å…é‡è¦å¥å­è¢«åˆ‡æ–·ï¼‰ |
| `split_by_sentence` | æ˜¯å¦æŒ‰å¥å­åˆ‡å‰² | trueï¼ˆæ›´è‡ªç„¶ï¼‰ |

---

**æª¢æŸ¥ä¸Šå‚³çµæœ**ï¼š

1. å‰å¾€ Supabase å°ˆæ¡ˆ
2. é»æ“Šã€ŒTable Editorã€
3. æŸ¥çœ‹ `documents` è¡¨ï¼šæ‡‰è©²æœ‰æ–°çš„æ–‡ä»¶
4. æŸ¥çœ‹ `chunks` è¡¨ï¼šæ‡‰è©²æœ‰ 20-50 å€‹æ®µè½
5. æŸ¥çœ‹ `embeddings` è¡¨ï¼šæ‡‰è©²æœ‰å°æ‡‰çš„å‘é‡

---

### 4.2 æ¸¬è©¦æœå°‹åŠŸèƒ½

**æ­¥é©Ÿ 1ï¼šä½¿ç”¨ Swagger UI æ¸¬è©¦**

1. é–‹å•Ÿ `https://your-api-url.com/docs`
2. æ‰¾åˆ° `POST /api/rag/search/` ç«¯é»
3. é»æ“Šã€ŒTry it outã€
4. å¡«å¯«æ¸¬è©¦å•é¡Œï¼š
   ```json
   {
     "query": "è«‹å‡æ”¿ç­–æ˜¯ä»€éº¼ï¼Ÿ",
     "top_k": 5,
     "similarity_threshold": 0.7
   }
   ```
5. é»æ“Šã€ŒExecuteã€
6. æŸ¥çœ‹çµæœï¼š
   ```json
   {
     "query": "è«‹å‡æ”¿ç­–æ˜¯ä»€éº¼ï¼Ÿ",
     "results": [
       {
         "chunk_id": 42,
         "document_title": "å“¡å·¥æ‰‹å†Š.pdf",
         "text": "å“¡å·¥å¹´å‡ç‚º 7 å¤©ï¼Œç—…å‡ç‚º 14 å¤©...",
         "similarity_score": 0.92,
         "ordinal": 3
       },
       {
         "chunk_id": 43,
         "document_title": "å“¡å·¥æ‰‹å†Š.pdf",
         "text": "ç‰¹ä¼‘å‡ä¾å¹´è³‡è¨ˆç®—...",
         "similarity_score": 0.85,
         "ordinal": 4
       }
     ],
     "total_results": 2
   }
   ```

---

**æ­¥é©Ÿ 2ï¼šç†è§£æœå°‹çµæœ**

é‡è¦æ¬„ä½è§£é‡‹ï¼š

| æ¬„ä½ | èªªæ˜ | ç¯„ä¾‹å€¼ |
|-----|------|--------|
| `text` | æ‰¾åˆ°çš„æ®µè½å…§å®¹ | ã€Œå“¡å·¥å¹´å‡ç‚º 7 å¤©...ã€ |
| `similarity_score` | ç›¸ä¼¼åº¦åˆ†æ•¸ï¼ˆ0-1ï¼‰ | 0.92ï¼ˆè¶Šé«˜è¶Šç›¸é—œï¼‰ |
| `document_title` | ä¾†æºæ–‡ä»¶ | ã€Œå“¡å·¥æ‰‹å†Š.pdfã€ |
| `ordinal` | æ®µè½é †åº | 3ï¼ˆç¬¬ 3 æ®µï¼‰ |

---

**æ­¥é©Ÿ 3ï¼šèª¿æ•´æœå°‹åƒæ•¸**

**åƒæ•¸ 1ï¼štop_kï¼ˆå›å‚³æ•¸é‡ï¼‰**
```json
{
  "query": "è«‹å‡æ”¿ç­–",
  "top_k": 3  // åªè¦å‰ 3 å€‹æœ€ç›¸é—œçš„æ®µè½
}
```

**åƒæ•¸ 2ï¼šsimilarity_thresholdï¼ˆç›¸ä¼¼åº¦é–€æª»ï¼‰**
```json
{
  "query": "è«‹å‡æ”¿ç­–",
  "similarity_threshold": 0.8  // åªè¦ç›¸ä¼¼åº¦ > 0.8 çš„çµæœ
}
```

**å»ºè­°è¨­å®š**ï¼š
- **ä¸€èˆ¬æœå°‹**ï¼š`top_k=5`, `threshold=0.7`
- **ç²¾æº–æœå°‹**ï¼š`top_k=3`, `threshold=0.85`
- **å»£æ³›æœå°‹**ï¼š`top_k=10`, `threshold=0.6`

---

### 4.3 æ¸¬è©¦æ™ºèƒ½å•ç­”

**æ­¥é©Ÿ 1ï¼šä½¿ç”¨å®Œæ•´ RAG å•ç­” API**

1. æ‰¾åˆ° `POST /api/rag/chat` ç«¯é»ï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
2. æˆ–ä½¿ç”¨æœ¬å°ˆæ¡ˆçš„å ±å‘Šç”Ÿæˆ APIï¼š`POST /api/report/generate`

**ç¯„ä¾‹ Request**ï¼š
```json
{
  "transcript": "æˆ‘æœ€è¿‘åœ¨è€ƒæ…®è½‰è·ï¼Œä½†ä¸çŸ¥é“è©²å¾€å“ªå€‹æ–¹å‘ç™¼å±•...",
  "num_participants": 2,
  "mode": "enhanced",
  "rag_system": "openai",
  "top_k": 7,
  "similarity_threshold": 0.25
}
```

**ç¯„ä¾‹ Response**ï¼š
```json
{
  "mode": "enhanced",
  "report": {
    "conceptualization": "ã€äº”ã€å¤šå±¤æ¬¡å› ç´ åˆ†æã€‘\næ ¹æ“š Super ç”Ÿæ¶¯ç™¼å±•ç†è«– [1]ï¼Œæ¡ˆä¸»è™•æ–¼æ¢ç´¢æœŸ...",
    "theories": [
      {
        "text": "Super ç”Ÿæ¶¯ç™¼å±•ç†è«–æŒ‡å‡º...",
        "document": "è·æ¶¯è«®è©¢ç†è«–.pdf",
        "score": 0.89
      }
    ]
  }
}
```

**é‡é»**ï¼š
- âœ… ç³»çµ±æœƒè‡ªå‹•æœå°‹ç›¸é—œç†è«–æ–‡ç»
- âœ… å¼•ç”¨ä¾†æºå¯è¿½è¹¤ï¼ˆdocument æ¬„ä½ï¼‰
- âœ… ç›¸ä¼¼åº¦åˆ†æ•¸å¯é©—è­‰ç›¸é—œæ€§ï¼ˆscore æ¬„ä½ï¼‰

---

**æ­¥é©Ÿ 2ï¼šé©—è­‰ RAG æ˜¯å¦æ­£å¸¸é‹ä½œ**

**æ¸¬è©¦ 1ï¼šå•å·²çŸ¥å•é¡Œ**
```json
å•é¡Œï¼šã€ŒSuper ç”Ÿæ¶¯ç™¼å±•ç†è«–æ˜¯ä»€éº¼ï¼Ÿã€
é æœŸï¼šæ‡‰è©²æ‰¾åˆ°ç›¸é—œæ–‡ç»ä¸¦æ­£ç¢ºå›ç­”
```

**æ¸¬è©¦ 2ï¼šå•ä¸å­˜åœ¨çš„å…§å®¹**
```json
å•é¡Œï¼šã€Œæˆ‘å€‘å…¬å¸çš„å¤ªç©ºæ—…éŠæ”¿ç­–æ˜¯ä»€éº¼ï¼Ÿã€
é æœŸï¼šæ‡‰è©²å›ç­”ã€Œæ²’æœ‰æ‰¾åˆ°ç›¸é—œè³‡æ–™ã€ï¼ˆä¸æœƒç·¨é€ ï¼‰
```

**æ¸¬è©¦ 3ï¼šæª¢æŸ¥å¼•ç”¨ä¾†æº**
```json
æª¢æŸ¥å›ç­”ä¸­çš„ [1], [2] å¼•ç”¨ç·¨è™Ÿ
å°ç…§ theories é™£åˆ—ä¸­çš„ document æ¬„ä½
ç¢ºèªä¾†æºæ­£ç¢º
```

---

### 4.4 æ•´åˆåˆ°ä½ çš„æ‡‰ç”¨

**æƒ…å¢ƒ 1ï¼šæ•´åˆåˆ°ç¶²ç«™**

**å‰ç«¯ JavaScript ç¯„ä¾‹**ï¼š
```javascript
async function askQuestion() {
  const question = document.getElementById('question').value;

  const response = await fetch('https://your-api-url.com/api/rag/search/', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      query: question,
      top_k: 5,
      similarity_threshold: 0.7
    })
  });

  const data = await response.json();

  // é¡¯ç¤ºçµæœ
  const resultsDiv = document.getElementById('results');
  data.results.forEach(result => {
    resultsDiv.innerHTML += `
      <div class="result">
        <p><strong>ä¾†æºï¼š</strong>${result.document_title}</p>
        <p><strong>å…§å®¹ï¼š</strong>${result.text}</p>
        <p><strong>ç›¸ä¼¼åº¦ï¼š</strong>${(result.similarity_score * 100).toFixed(1)}%</p>
      </div>
    `;
  });
}
```

---

**æƒ…å¢ƒ 2ï¼šæ•´åˆåˆ° iOS App**

**Swift ç¯„ä¾‹**ï¼š
```swift
struct SearchRequest: Codable {
    let query: String
    let topK: Int
    let similarityThreshold: Double

    enum CodingKeys: String, CodingKey {
        case query
        case topK = "top_k"
        case similarityThreshold = "similarity_threshold"
    }
}

struct SearchResult: Codable {
    let chunkId: Int
    let documentTitle: String
    let text: String
    let similarityScore: Double

    enum CodingKeys: String, CodingKey {
        case chunkId = "chunk_id"
        case documentTitle = "document_title"
        case text
        case similarityScore = "similarity_score"
    }
}

func searchRAG(query: String) async throws -> [SearchResult] {
    let url = URL(string: "https://your-api-url.com/api/rag/search/")!
    var request = URLRequest(url: url)
    request.httpMethod = "POST"
    request.setValue("application/json", forHTTPHeaderField: "Content-Type")

    let requestBody = SearchRequest(
        query: query,
        topK: 5,
        similarityThreshold: 0.7
    )

    let encoder = JSONEncoder()
    request.httpBody = try encoder.encode(requestBody)

    let (data, _) = try await URLSession.shared.data(for: request)
    let decoder = JSONDecoder()
    decoder.keyDecodingStrategy = .convertFromSnakeCase

    let response = try decoder.decode([String: [SearchResult]].self, from: data)
    return response["results"] ?? []
}
```

---

**æƒ…å¢ƒ 3ï¼šæ•´åˆåˆ° Chatbot**

**åŸºæœ¬æµç¨‹**ï¼š
```python
# 1. ä½¿ç”¨è€…æå•
user_question = "å¦‚ä½•ç”³è«‹ç‰¹ä¼‘å‡ï¼Ÿ"

# 2. æœå°‹ç›¸é—œæ®µè½
search_results = rag_search(
    query=user_question,
    top_k=3,
    threshold=0.75
)

# 3. çµ„åˆ Prompt
context = "\n\n".join([r["text"] for r in search_results])
prompt = f"""
æ ¹æ“šä»¥ä¸‹è³‡æ–™å›ç­”å•é¡Œï¼š

{context}

å•é¡Œï¼š{user_question}

è«‹æ ¹æ“šä¸Šè¿°è³‡æ–™å›ç­”ï¼Œä¸è¦ç·¨é€ ä¸å­˜åœ¨çš„è³‡è¨Šã€‚
"""

# 4. å‘¼å« GPT-4
answer = openai.chat.completions.create(
    model="gpt-4",
    messages=[{"role": "user", "content": prompt}]
)

# 5. å›å‚³ç­”æ¡ˆ + ä¾†æº
return {
    "answer": answer.choices[0].message.content,
    "sources": [r["document_title"] for r in search_results]
}
```

---

## ç¬¬ 5 éƒ¨åˆ†ï¼šå»ºç«‹å®Œæ•´çš„å‰å¾Œç«¯ç³»çµ±ï¼ˆ2-3 å°æ™‚ï¼‰

**ç›®æ¨™**ï¼šå»ºç«‹ä¸€å€‹å®Œæ•´çš„ RAG æ–‡ä»¶ç®¡ç†ç³»çµ±ï¼ŒåŒ…å«ï¼š
1. ğŸ“¤ ä¸Šå‚³æ–‡ä»¶ä»‹é¢
2. ğŸ“Š æŸ¥çœ‹æ–‡ä»¶è³‡è¨Š
3. âœ‚ï¸ CRUD æ–‡ä»¶ Chunks ç®¡ç†
4. ğŸ” æœå°‹æ¸¬è©¦ä»‹é¢

**ç‚ºä»€éº¼éœ€è¦å‰å¾Œç«¯ç³»çµ±ï¼Ÿ**

åœ¨å‰é¢çš„ç« ç¯€ä¸­ï¼Œæˆ‘å€‘å­¸æœƒäº† RAG çš„æ¦‚å¿µã€OpenAI Embeddingã€Supabase è³‡æ–™åº«è¨­å®šï¼Œä»¥åŠå¦‚ä½•ç”¨æŒ‡ä»¤å»ºç«‹æœå°‹åŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œé€™äº›éƒ½æ˜¯é€šéæŒ‡ä»¤è¡Œï¼ˆTerminalï¼‰ä¾†æ“ä½œçš„ã€‚

æƒ³åƒä¸€ä¸‹ï¼šå¦‚æœä½ çš„åŒäº‹æˆ–å®¢æˆ¶æƒ³è¦ä¸Šå‚³æ–‡ä»¶ã€æŸ¥çœ‹æ–‡ä»¶è³‡è¨Šã€æˆ–æ˜¯æ¸¬è©¦æœå°‹åŠŸèƒ½ï¼Œä½ ç¸½ä¸èƒ½è¦æ±‚ä»–å€‘æ‰“é–‹ Terminal è¼¸å…¥æŒ‡ä»¤å§ï¼Ÿé€™å°±æ˜¯ç‚ºä»€éº¼æˆ‘å€‘éœ€è¦ä¸€å€‹**ä½¿ç”¨è€…ä»‹é¢ï¼ˆUIï¼‰**ã€‚

**å‰å¾Œç«¯ç³»çµ±çš„è§’è‰²åˆ†å·¥**ï¼š

- **å¾Œç«¯ï¼ˆBackendï¼‰**ï¼šè™•ç†æ¥­å‹™é‚è¼¯çš„ã€Œå¤§å»šã€
  - æ¥æ”¶å‰ç«¯çš„è«‹æ±‚ï¼ˆä¸Šå‚³æ–‡ä»¶ã€æœå°‹ç­‰ï¼‰
  - è™•ç† PDF æ–‡å­—æå–
  - èª¿ç”¨ OpenAI API ç”Ÿæˆ embeddings
  - æ“ä½œ Supabase è³‡æ–™åº«
  - å›å‚³è™•ç†çµæœçµ¦å‰ç«¯

- **å‰ç«¯ï¼ˆFrontendï¼‰**ï¼šä½¿ç”¨è€…äº’å‹•çš„ã€Œæœå‹™ç”Ÿã€
  - æä¾›æ¼‚äº®çš„ä»‹é¢è®“ä½¿ç”¨è€…æ“ä½œ
  - æ‹–æ‹‰ä¸Šå‚³æª”æ¡ˆ
  - é¡¯ç¤ºæ–‡ä»¶åˆ—è¡¨
  - ç·¨è¼¯ Chunks
  - é¡¯ç¤ºæœå°‹çµæœ

**é€™ä¸€ç« ç¯€ä½ æœƒå­¸åˆ°**ï¼š

1. å¦‚ä½•ç”¨ FastAPI å»ºç«‹ REST APIï¼ˆå¾Œç«¯ï¼‰
2. å¦‚ä½•å»ºç«‹ HTML/CSS/JavaScript å‰ç«¯ä»‹é¢
3. å¦‚ä½•è®“å‰å¾Œç«¯æºé€šï¼ˆAJAX requestsï¼‰
4. å¦‚ä½•éƒ¨ç½²åˆ°é›²ç«¯ï¼ˆGoogle Cloud Runï¼‰

**é è¨ˆå®Œæˆæ™‚é–“**ï¼š2-3 å°æ™‚

---

### 5.1 å¾Œç«¯ API å¯¦ä½œï¼ˆ45 åˆ†é˜ï¼‰

#### 5.1.1 å°ˆæ¡ˆæ¶æ§‹è¨­è¨ˆ

**å®Œæ•´æ¶æ§‹åœ–**ï¼š

```
your-rag-project/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                  # FastAPI ä¸»ç¨‹å¼
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ config.py            # ç’°å¢ƒè®Šæ•¸è¨­å®š
â”‚   â”‚   â””â”€â”€ database.py          # è³‡æ–™åº«é€£ç·š
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ document.py          # SQLAlchemy æ¨¡å‹
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ openai_service.py    # OpenAI API
â”‚   â”‚   â”œâ”€â”€ pdf_service.py       # PDF è™•ç†
â”‚   â”‚   â”œâ”€â”€ chunking.py          # æ–‡å­—åˆ‡ç‰‡
â”‚   â”‚   â””â”€â”€ storage.py           # Supabase Storage
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ rag_ingest.py        # æ–‡ä»¶ä¸Šå‚³ API
â”‚       â”œâ”€â”€ rag_stats.py         # æ–‡ä»¶çµ±è¨ˆ API
â”‚       â”œâ”€â”€ rag_chunks.py        # Chunks CRUD API
â”‚       â””â”€â”€ rag_search.py        # æœå°‹ API
â”œâ”€â”€ static/
â”‚   â””â”€â”€ index.html               # å‰ç«¯ä»‹é¢
â”œâ”€â”€ .env                         # ç’°å¢ƒè®Šæ•¸ï¼ˆä¸ä¸Šå‚³ï¼‰
â”œâ”€â”€ .env.example                 # ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
â”œâ”€â”€ requirements.txt             # Python å¥—ä»¶
â””â”€â”€ README.md
```

**èªªæ˜**ï¼š

- `app/core/`: æ ¸å¿ƒè¨­å®šï¼ˆè³‡æ–™åº«é€£ç·šã€ç’°å¢ƒè®Šæ•¸ï¼‰
- `app/models/`: è³‡æ–™åº«æ¨¡å‹ï¼ˆå°æ‡‰ documents, chunks, embeddings è¡¨æ ¼ï¼‰
- `app/services/`: æ¥­å‹™é‚è¼¯ï¼ˆOpenAIã€PDF è™•ç†ã€æ–‡å­—åˆ‡ç‰‡ï¼‰
- `app/api/`: API ç«¯é»ï¼ˆè™•ç† HTTP è«‹æ±‚ï¼‰
- `static/`: å‰ç«¯ HTML æª”æ¡ˆ

---

#### 5.1.2 å»ºç«‹ FastAPI å°ˆæ¡ˆ

**æ­¥é©Ÿ 1ï¼šåˆå§‹åŒ–å°ˆæ¡ˆ**

```bash
# å»ºç«‹å°ˆæ¡ˆè³‡æ–™å¤¾
mkdir rag-system
cd rag-system

# å»ºç«‹è™›æ“¬ç’°å¢ƒ
python -m venv venv

# å•Ÿå‹•è™›æ“¬ç’°å¢ƒ
source venv/bin/activate  # Mac/Linux
# æˆ–
venv\Scripts\activate  # Windows

# å®‰è£å¥—ä»¶
pip install fastapi uvicorn sqlalchemy psycopg2-binary python-dotenv openai supabase pypdf
```

---

**æ­¥é©Ÿ 2ï¼šå»ºç«‹ requirements.txt**

```txt
fastapi==0.104.1
uvicorn[standard]==0.24.0
sqlalchemy==2.0.23
psycopg2-binary==2.9.9
python-dotenv==1.0.0
openai==1.3.5
supabase==2.0.3
pypdf==3.17.1
pydantic==2.5.0
pydantic-settings==2.1.0
pgvector==0.2.3
```

---

**æ­¥é©Ÿ 3ï¼šå»ºç«‹å°ˆæ¡ˆçµæ§‹**

```bash
# å»ºç«‹è³‡æ–™å¤¾
mkdir -p app/core app/models app/services app/api static

# å»ºç«‹æª”æ¡ˆ
touch app/__init__.py
touch app/main.py
touch app/core/__init__.py
touch app/core/config.py
touch app/core/database.py
touch app/models/__init__.py
touch app/models/document.py
touch app/services/__init__.py
touch app/api/__init__.py
touch .env
touch .env.example
```

---

#### 5.1.3 å¯¦ä½œæ ¸å¿ƒæ¨¡çµ„

**app/core/config.py**ï¼ˆç’°å¢ƒè®Šæ•¸è¨­å®šï¼‰

```python
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    # Database
    DATABASE_URL: str

    # OpenAI
    OPENAI_API_KEY: str
    OPENAI_EMBEDDING_MODEL: str = "text-embedding-3-small"

    # Supabase
    SUPABASE_URL: str
    SUPABASE_SERVICE_KEY: str

    class Config:
        env_file = ".env"

settings = Settings()
```

**èªªæ˜**ï¼šé€™å€‹æª”æ¡ˆæœƒè‡ªå‹•å¾ `.env` è®€å–ç’°å¢ƒè®Šæ•¸ã€‚

---

**app/core/database.py**ï¼ˆè³‡æ–™åº«é€£ç·šï¼‰

```python
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker, declarative_base
from app.core.config import settings

# å»ºç«‹è³‡æ–™åº«å¼•æ“
engine = create_engine(settings.DATABASE_URL)

# Session factory
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

# Base class for models
Base = declarative_base()

def get_db():
    """Dependency for database session"""
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
```

**èªªæ˜**ï¼š`get_db()` æ˜¯ä¸€å€‹ Dependencyï¼ŒFastAPI æœƒåœ¨æ¯æ¬¡è«‹æ±‚æ™‚è‡ªå‹•æ³¨å…¥è³‡æ–™åº« sessionã€‚

---

**app/models/document.py**ï¼ˆè³‡æ–™åº«æ¨¡å‹ï¼‰

```python
from sqlalchemy import Column, Integer, String, Text, DateTime, ForeignKey, JSONB
from sqlalchemy.sql import func
from pgvector.sqlalchemy import Vector
from app.core.database import Base

class Datasource(Base):
    __tablename__ = "datasources"

    id = Column(Integer, primary_key=True, index=True)
    type = Column(String(50), nullable=False)  # "pdf", "url", "text"
    source_uri = Column(Text)
    created_at = Column(DateTime(timezone=True), server_default=func.now())

class Document(Base):
    __tablename__ = "documents"

    id = Column(Integer, primary_key=True, index=True)
    datasource_id = Column(Integer, ForeignKey("datasources.id", ondelete="CASCADE"))
    title = Column(String(500), nullable=False)
    bytes = Column(Integer)
    pages = Column(Integer)
    text_length = Column(Integer)
    content = Column(Text)  # åŸå§‹æ–‡å­—
    meta_json = Column(JSONB, default={})
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), onupdate=func.now())

class Chunk(Base):
    __tablename__ = "chunks"

    id = Column(Integer, primary_key=True, index=True)
    doc_id = Column(Integer, ForeignKey("documents.id", ondelete="CASCADE"))
    ordinal = Column(Integer, nullable=False)  # é †åº
    text = Column(Text, nullable=False)
    chunk_strategy = Column(String(50), default="sentence")
    meta_json = Column(JSONB, default={})
    created_at = Column(DateTime(timezone=True), server_default=func.now())

class Embedding(Base):
    __tablename__ = "embeddings"

    id = Column(Integer, primary_key=True, index=True)
    chunk_id = Column(Integer, ForeignKey("chunks.id", ondelete="CASCADE"), unique=True)
    embedding = Column(Vector(1536))  # OpenAI embedding ç¶­åº¦
    created_at = Column(DateTime(timezone=True), server_default=func.now())
```

**èªªæ˜**ï¼š
- `ondelete="CASCADE"`ï¼šåˆªé™¤ document æ™‚ï¼Œè‡ªå‹•åˆªé™¤é—œè¯çš„ chunks å’Œ embeddings
- `Vector(1536)`ï¼šOpenAI text-embedding-3-small çš„å‘é‡ç¶­åº¦

---

#### 5.1.4 å¯¦ä½œæ–‡ä»¶ä¸Šå‚³ API

**app/api/rag_ingest.py**

```python
import uuid
from fastapi import APIRouter, UploadFile, File, Depends, HTTPException
from sqlalchemy.orm import Session
from pydantic import BaseModel

from app.core.database import get_db
from app.models.document import Datasource, Document, Chunk, Embedding
from app.services.openai_service import OpenAIService
from app.services.pdf_service import PDFService
from app.services.chunking import ChunkingService
from app.services.storage import StorageService

router = APIRouter(prefix="/api/rag/ingest", tags=["rag-ingest"])

class IngestResponse(BaseModel):
    datasource_id: int
    document_id: int
    chunks_created: int
    embeddings_created: int
    message: str

@router.post("/files", response_model=IngestResponse)
async def ingest_file(
    file: UploadFile = File(...),
    chunk_size: int = 400,
    overlap: int = 80,
    db: Session = Depends(get_db)
):
    """ä¸Šå‚³ä¸¦è™•ç† PDF æ–‡ä»¶"""

    # é©—è­‰æª”æ¡ˆé¡å‹
    if not file.filename.endswith(".pdf"):
        raise HTTPException(status_code=400, detail="åªæ”¯æ´ PDF æª”æ¡ˆ")

    # è®€å–æª”æ¡ˆå…§å®¹
    file_content = await file.read()

    # 1. ä¸Šå‚³åˆ° Supabase Storage
    storage = StorageService()
    safe_filename = f"{uuid.uuid4()}.pdf"
    storage_url = await storage.upload_file(
        file_content,
        f"documents/{safe_filename}",
        content_type="application/pdf"
    )

    # 2. æå– PDF æ–‡å­—
    pdf_service = PDFService()
    text = pdf_service.extract_text(file_content)
    metadata = pdf_service.extract_metadata(file_content)

    # ç§»é™¤ PostgreSQL ç„¡æ³•å„²å­˜çš„ NUL å­—å…ƒ
    text = text.replace("\x00", "")

    # 3. å»ºç«‹è³‡æ–™åº«è¨˜éŒ„
    datasource = Datasource(type="pdf", source_uri=storage_url)
    db.add(datasource)
    db.flush()

    document = Document(
        datasource_id=datasource.id,
        title=file.filename,
        bytes=len(file_content),
        pages=metadata.get("pages", 0),
        content=text,
        text_length=len(text),
        meta_json=metadata
    )
    db.add(document)
    db.flush()

    # 4. æ–‡å­—åˆ‡ç‰‡
    chunking = ChunkingService(chunk_size=chunk_size, overlap=overlap)
    chunks = chunking.split_text(text, split_by_sentence=True)

    # 5. ç”Ÿæˆ embeddings
    openai = OpenAIService()

    for idx, chunk_text in enumerate(chunks):
        chunk_text = chunk_text.replace("\x00", "")

        # å»ºç«‹ chunk è¨˜éŒ„
        chunk = Chunk(
            doc_id=document.id,
            ordinal=idx,
            text=chunk_text,
            chunk_strategy=f"rec_{chunk_size}_{overlap}"
        )
        db.add(chunk)
        db.flush()

        # ç”Ÿæˆ embedding
        embedding_vector = await openai.create_embedding(chunk_text)
        embedding = Embedding(chunk_id=chunk.id, embedding=embedding_vector)
        db.add(embedding)

    db.commit()

    return IngestResponse(
        datasource_id=datasource.id,
        document_id=document.id,
        chunks_created=len(chunks),
        embeddings_created=len(chunks),
        message=f"æˆåŠŸè™•ç† {file.filename}"
    )
```

**æµç¨‹èªªæ˜**ï¼š

1. **é©—è­‰æª”æ¡ˆ**ï¼šç¢ºèªæ˜¯ PDF æª”æ¡ˆ
2. **ä¸Šå‚³åˆ° Supabase Storage**ï¼šå„²å­˜åŸå§‹æª”æ¡ˆ
3. **æå– PDF æ–‡å­—**ï¼šä½¿ç”¨ PyPDF æå–æ–‡å­—å…§å®¹
4. **å»ºç«‹è³‡æ–™åº«è¨˜éŒ„**ï¼šdatasource â†’ document
5. **æ–‡å­—åˆ‡ç‰‡**ï¼šå°‡é•·æ–‡æœ¬åˆ‡æˆ 400 å­—çš„ chunks
6. **ç”Ÿæˆ embeddings**ï¼šèª¿ç”¨ OpenAI API ç”Ÿæˆå‘é‡

---

#### 5.1.5 å¯¦ä½œæ–‡ä»¶çµ±è¨ˆ API

**app/api/rag_stats.py**

```python
from typing import List
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy import text
from sqlalchemy.orm import Session
from pydantic import BaseModel

from app.core.database import get_db

router = APIRouter(prefix="/api/rag/stats", tags=["rag-stats"])

class DocumentStats(BaseModel):
    id: int
    title: str
    pages: int
    bytes: int
    chunks_count: int
    embeddings_count: int
    text_length: int
    created_at: str

class DatabaseStats(BaseModel):
    total_documents: int
    total_chunks: int
    total_embeddings: int
    total_bytes: int
    documents: List[DocumentStats]

@router.get("/", response_model=DatabaseStats)
def get_stats(db: Session = Depends(get_db)):
    """å–å¾—è³‡æ–™åº«çµ±è¨ˆè³‡æ–™"""

    # ç¸½è¨ˆ
    total_docs = db.execute(text("SELECT COUNT(*) FROM documents")).scalar()
    total_chunks = db.execute(text("SELECT COUNT(*) FROM chunks")).scalar()
    total_embeddings = db.execute(text("SELECT COUNT(*) FROM embeddings")).scalar()
    total_bytes = db.execute(text("SELECT COALESCE(SUM(bytes), 0) FROM documents")).scalar()

    # æ–‡ä»¶è©³æƒ…
    query = text("""
        SELECT
            d.id, d.title, d.pages, d.bytes, d.text_length, d.created_at,
            COUNT(c.id) as chunks_count,
            COUNT(e.id) as embeddings_count
        FROM documents d
        LEFT JOIN chunks c ON d.id = c.doc_id
        LEFT JOIN embeddings e ON c.id = e.chunk_id
        GROUP BY d.id
        ORDER BY d.created_at DESC
    """)

    result = db.execute(query)
    rows = result.fetchall()

    documents = [
        DocumentStats(
            id=row.id,
            title=row.title,
            pages=row.pages or 0,
            bytes=row.bytes or 0,
            chunks_count=row.chunks_count or 0,
            embeddings_count=row.embeddings_count or 0,
            text_length=row.text_length or 0,
            created_at=str(row.created_at)
        )
        for row in rows
    ]

    return DatabaseStats(
        total_documents=total_docs or 0,
        total_chunks=total_chunks or 0,
        total_embeddings=total_embeddings or 0,
        total_bytes=total_bytes or 0,
        documents=documents
    )

@router.delete("/documents/{doc_id}")
def delete_document(doc_id: int, db: Session = Depends(get_db)):
    """åˆªé™¤æ–‡ä»¶ï¼ˆcascade åˆªé™¤ chunks å’Œ embeddingsï¼‰"""

    # æª¢æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    doc = db.execute(
        text("SELECT id FROM documents WHERE id = :id"),
        {"id": doc_id}
    ).first()

    if not doc:
        raise HTTPException(status_code=404, detail="æ–‡ä»¶ä¸å­˜åœ¨")

    # Cascade åˆªé™¤ï¼ˆFK constraint æœƒè‡ªå‹•è™•ç†ï¼‰
    db.execute(
        text("DELETE FROM documents WHERE id = :id"),
        {"id": doc_id}
    )
    db.commit()

    return {"success": True, "message": f"æˆåŠŸåˆªé™¤æ–‡ä»¶ {doc_id}"}
```

**åŠŸèƒ½**ï¼š
- `GET /api/rag/stats/`ï¼šå–å¾—è³‡æ–™åº«çµ±è¨ˆï¼ˆç¸½æ–‡ä»¶æ•¸ã€chunks æ•¸ã€embeddings æ•¸ã€ç¸½å¤§å°ï¼‰
- `DELETE /api/rag/stats/documents/{doc_id}`ï¼šåˆªé™¤æ–‡ä»¶ï¼ˆè‡ªå‹•åˆªé™¤é—œè¯çš„ chunks å’Œ embeddingsï¼‰

---

#### 5.1.6 å¯¦ä½œ Chunks CRUD API

**app/api/rag_chunks.py**

```python
from typing import List
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy import text
from sqlalchemy.orm import Session
from pydantic import BaseModel

from app.core.database import get_db
from app.services.openai_service import OpenAIService

router = APIRouter(prefix="/api/rag/chunks", tags=["rag-chunks"])

class ChunkDetail(BaseModel):
    id: int
    ordinal: int
    text: str
    text_length: int
    document_title: str

class ChunkUpdate(BaseModel):
    text: str

@router.get("/{doc_id}", response_model=List[ChunkDetail])
def get_chunks(doc_id: int, db: Session = Depends(get_db)):
    """å–å¾—æ–‡ä»¶çš„æ‰€æœ‰ chunks"""

    query = text("""
        SELECT
            c.id, c.ordinal, c.text,
            LENGTH(c.text) as text_length,
            d.title as document_title
        FROM chunks c
        JOIN documents d ON c.doc_id = d.id
        WHERE c.doc_id = :doc_id
        ORDER BY c.ordinal
    """)

    result = db.execute(query, {"doc_id": doc_id})
    rows = result.fetchall()

    return [
        ChunkDetail(
            id=row.id,
            ordinal=row.ordinal,
            text=row.text,
            text_length=row.text_length,
            document_title=row.document_title
        )
        for row in rows
    ]

@router.put("/{chunk_id}")
async def update_chunk(
    chunk_id: int,
    data: ChunkUpdate,
    db: Session = Depends(get_db)
):
    """æ›´æ–° chunk æ–‡å­—ï¼ˆæœƒé‡æ–°ç”Ÿæˆ embeddingï¼‰"""

    # æª¢æŸ¥ chunk æ˜¯å¦å­˜åœ¨
    chunk = db.execute(
        text("SELECT id FROM chunks WHERE id = :id"),
        {"id": chunk_id}
    ).first()

    if not chunk:
        raise HTTPException(status_code=404, detail="Chunk ä¸å­˜åœ¨")

    # æ›´æ–°æ–‡å­—
    db.execute(
        text("UPDATE chunks SET text = :text WHERE id = :id"),
        {"text": data.text, "id": chunk_id}
    )

    # é‡æ–°ç”Ÿæˆ embedding
    openai = OpenAIService()
    new_embedding = await openai.create_embedding(data.text)

    db.execute(
        text("UPDATE embeddings SET embedding = :embedding WHERE chunk_id = :chunk_id"),
        {"embedding": new_embedding, "chunk_id": chunk_id}
    )

    db.commit()

    return {"success": True, "message": "Chunk æ›´æ–°æˆåŠŸ"}

@router.delete("/{chunk_id}")
def delete_chunk(chunk_id: int, db: Session = Depends(get_db)):
    """åˆªé™¤ chunkï¼ˆæœƒè‡ªå‹•åˆªé™¤ embeddingï¼‰"""

    db.execute(
        text("DELETE FROM chunks WHERE id = :id"),
        {"id": chunk_id}
    )
    db.commit()

    return {"success": True, "message": "Chunk åˆªé™¤æˆåŠŸ"}

@router.post("/")
async def create_chunk(
    doc_id: int,
    text: str,
    ordinal: int,
    db: Session = Depends(get_db)
):
    """æ–°å¢ chunk"""

    # å»ºç«‹ chunk
    result = db.execute(
        text("""
            INSERT INTO chunks (doc_id, ordinal, text, chunk_strategy)
            VALUES (:doc_id, :ordinal, :text, 'manual')
            RETURNING id
        """),
        {"doc_id": doc_id, "ordinal": ordinal, "text": text}
    )
    chunk_id = result.scalar()

    # ç”Ÿæˆ embedding
    openai = OpenAIService()
    embedding_vector = await openai.create_embedding(text)

    db.execute(
        text("INSERT INTO embeddings (chunk_id, embedding) VALUES (:chunk_id, :embedding)"),
        {"chunk_id": chunk_id, "embedding": embedding_vector}
    )

    db.commit()

    return {"success": True, "chunk_id": chunk_id, "message": "Chunk å»ºç«‹æˆåŠŸ"}
```

**åŠŸèƒ½**ï¼š
- `GET /api/rag/chunks/{doc_id}`ï¼šå–å¾—æ–‡ä»¶çš„æ‰€æœ‰ chunks
- `PUT /api/rag/chunks/{chunk_id}`ï¼šæ›´æ–° chunkï¼ˆæœƒé‡æ–°ç”Ÿæˆ embeddingï¼‰
- `DELETE /api/rag/chunks/{chunk_id}`ï¼šåˆªé™¤ chunk
- `POST /api/rag/chunks/`ï¼šæ–°å¢ chunk

**é‡é»**ï¼šæ›´æ–° chunk æ–‡å­—æ™‚ï¼Œå¿…é ˆé‡æ–°èª¿ç”¨ OpenAI API ç”Ÿæˆæ–°çš„ embeddingã€‚

---

#### 5.1.7 å¯¦ä½œæœå°‹ API

**app/api/rag_search.py**

```python
from typing import List
from fastapi import APIRouter, Depends
from sqlalchemy import text
from sqlalchemy.orm import Session
from pydantic import BaseModel

from app.core.database import get_db
from app.services.openai_service import OpenAIService

router = APIRouter(prefix="/api/rag/search", tags=["rag-search"])

class SearchRequest(BaseModel):
    query: str
    top_k: int = 5
    similarity_threshold: float = 0.7

class SearchResult(BaseModel):
    chunk_id: int
    document_title: str
    text: str
    similarity_score: float
    ordinal: int

@router.post("/", response_model=List[SearchResult])
async def search(request: SearchRequest, db: Session = Depends(get_db)):
    """å‘é‡ç›¸ä¼¼åº¦æœå°‹"""

    # ç”Ÿæˆ query embedding
    openai = OpenAIService()
    query_embedding = await openai.create_embedding(request.query)
    embedding_str = "[" + ",".join(map(str, query_embedding)) + "]"

    # å‘é‡æœå°‹
    query_sql = text("""
        SELECT
            c.id as chunk_id,
            c.ordinal,
            c.text,
            d.title as document_title,
            1 - (e.embedding <=> CAST(:query_embedding AS vector)) as similarity_score
        FROM chunks c
        JOIN embeddings e ON c.id = e.chunk_id
        JOIN documents d ON c.doc_id = d.id
        WHERE 1 - (e.embedding <=> CAST(:query_embedding AS vector)) >= :threshold
        ORDER BY e.embedding <=> CAST(:query_embedding AS vector)
        LIMIT :top_k
    """)

    result = db.execute(query_sql, {
        "query_embedding": embedding_str,
        "threshold": request.similarity_threshold,
        "top_k": request.top_k
    })

    rows = result.fetchall()

    return [
        SearchResult(
            chunk_id=row.chunk_id,
            document_title=row.document_title,
            text=row.text,
            similarity_score=float(row.similarity_score),
            ordinal=row.ordinal
        )
        for row in rows
    ]
```

**èªªæ˜**ï¼š
- `<=>` æ˜¯ pgvector çš„é¤˜å¼¦è·é›¢é‹ç®—å­
- `1 - (embedding <=> query_embedding)` è½‰æ›æˆç›¸ä¼¼åº¦ï¼ˆè¶Šæ¥è¿‘ 1 è¶Šç›¸ä¼¼ï¼‰
- `ORDER BY ... LIMIT :top_k` å–å¾—å‰ K å€‹æœ€ç›¸ä¼¼çš„çµæœ

---

#### 5.1.8 ä¸»ç¨‹å¼

**app/main.py**

```python
from fastapi import FastAPI
from fastapi.staticfiles import StaticFiles
from fastapi.middleware.cors import CORSMiddleware

from app.api import rag_ingest, rag_stats, rag_chunks, rag_search

app = FastAPI(title="RAG æ–‡ä»¶ç®¡ç†ç³»çµ±", version="1.0.0")

# CORSï¼ˆå…è¨±å‰ç«¯å­˜å–ï¼‰
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# è¨»å†Š API è·¯ç”±
app.include_router(rag_ingest.router)
app.include_router(rag_stats.router)
app.include_router(rag_chunks.router)
app.include_router(rag_search.router)

# éœæ…‹æª”æ¡ˆï¼ˆå‰ç«¯ä»‹é¢ï¼‰
app.mount("/static", StaticFiles(directory="static"), name="static")

@app.get("/")
def root():
    return {"message": "RAG æ–‡ä»¶ç®¡ç†ç³»çµ± API"}

@app.get("/health")
def health():
    return {"status": "ok"}
```

**èªªæ˜**ï¼š
- `CORSMiddleware`ï¼šå…è¨±å‰ç«¯è·¨åŸŸè«‹æ±‚
- `app.include_router()`ï¼šè¨»å†Š API è·¯ç”±
- `app.mount("/static", ...)`ï¼šæä¾›éœæ…‹æª”æ¡ˆæœå‹™

---

### 5.2 å‰ç«¯ä»‹é¢å¯¦ä½œï¼ˆ60 åˆ†é˜ï¼‰

å‰ç«¯ä½¿ç”¨ç´” HTML + CSS + JavaScriptï¼ˆä¸éœ€è¦ React/Vueï¼‰ï¼Œé©åˆå¿«é€Ÿå»ºç«‹åŸå‹ã€‚

**static/index.html**ï¼ˆå®Œæ•´å‰ç«¯ä»‹é¢ï¼ŒåŒ…å« 4 å€‹åŠŸèƒ½é ç±¤ï¼‰

ç”±æ–¼å®Œæ•´çš„ HTML æª”æ¡ˆè¼ƒé•·ï¼ˆç´„ 700 è¡Œï¼‰ï¼Œé€™è£¡æˆ‘å°‡åˆ†æ®µè§£é‡‹é—œéµéƒ¨åˆ†ã€‚

#### 5.2.1 HTML çµæ§‹

```html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG æ–‡ä»¶ç®¡ç†ç³»çµ±</title>
    <style>
        /* CSS æ¨£å¼ï¼ˆè¦‹ä¸‹æ–¹ï¼‰ */
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ“š RAG æ–‡ä»¶ç®¡ç†ç³»çµ±</h1>
            <p>ä¸Šå‚³æ–‡ä»¶ã€ç®¡ç† Chunksã€æ¸¬è©¦æœå°‹</p>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab('upload')">ğŸ“¤ ä¸Šå‚³æ–‡ä»¶</button>
                <button class="tab" onclick="switchTab('documents')">ğŸ“Š æ–‡ä»¶åˆ—è¡¨</button>
                <button class="tab" onclick="switchTab('chunks')">âœ‚ï¸ Chunks ç®¡ç†</button>
                <button class="tab" onclick="switchTab('search')">ğŸ” æœå°‹æ¸¬è©¦</button>
            </div>
        </div>

        <!-- Tab 1: ä¸Šå‚³æ–‡ä»¶ -->
        <div id="tab-upload" class="tab-content active">
            <!-- ä¸Šå‚³ä»‹é¢ -->
        </div>

        <!-- Tab 2: æ–‡ä»¶åˆ—è¡¨ -->
        <div id="tab-documents" class="tab-content">
            <!-- çµ±è¨ˆå¡ç‰‡ + æ–‡ä»¶è¡¨æ ¼ -->
        </div>

        <!-- Tab 3: Chunks ç®¡ç† -->
        <div id="tab-chunks" class="tab-content">
            <!-- Chunks åˆ—è¡¨ + ç·¨è¼¯åŠŸèƒ½ -->
        </div>

        <!-- Tab 4: æœå°‹æ¸¬è©¦ -->
        <div id="tab-search" class="tab-content">
            <!-- æœå°‹æ¡† + çµæœé¡¯ç¤º -->
        </div>
    </div>

    <!-- Edit Chunk Modal -->
    <div id="editModal" class="modal">
        <!-- ç·¨è¼¯ Chunk çš„å½ˆå‡ºè¦–çª— -->
    </div>

    <script>
        /* JavaScript ç¨‹å¼ï¼ˆè¦‹ä¸‹æ–¹ï¼‰ */
    </script>
</body>
</html>
```

**çµæ§‹èªªæ˜**ï¼š

- **4 å€‹ Tab**ï¼šä¸Šå‚³æ–‡ä»¶ã€æ–‡ä»¶åˆ—è¡¨ã€Chunks ç®¡ç†ã€æœå°‹æ¸¬è©¦
- **Modal**ï¼šç”¨æ–¼ç·¨è¼¯ Chunk çš„å½ˆå‡ºè¦–çª—
- **CSS**ï¼šå…§åµŒåœ¨ `<style>` æ¨™ç±¤ä¸­
- **JavaScript**ï¼šå…§åµŒåœ¨ `<script>` æ¨™ç±¤ä¸­

å®Œæ•´çš„ `static/index.html` æª”æ¡ˆå…§å®¹è«‹åƒè€ƒå°ˆæ¡ˆä¸­çš„ `docs/RAG_FRONTEND_BACKEND_TUTORIAL.md` ç¬¬ 2 éƒ¨åˆ†ï¼ˆlines 708-1372ï¼‰ï¼Œæˆ–ç›´æ¥ä½¿ç”¨ä»¥ä¸‹å®Œæ•´ç‰ˆæœ¬ã€‚

---

#### 5.2.2 é—œéµ JavaScript åŠŸèƒ½

**1. Tab åˆ‡æ›**

```javascript
function switchTab(tabName) {
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

    event.target.classList.add('active');
    document.getElementById(`tab-${tabName}`).classList.add('active');

    if (tabName === 'documents') loadDocuments();
    if (tabName === 'chunks') loadDocumentList();
}
```

**2. æª”æ¡ˆä¸Šå‚³ï¼ˆæ‹–æ‹‰åŠŸèƒ½ï¼‰**

```javascript
const uploadZone = document.getElementById('uploadZone');

uploadZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadZone.classList.add('dragover');
});

uploadZone.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadZone.classList.remove('dragover');
    const files = e.dataTransfer.files;
    if (files.length > 0) {
        document.getElementById('fileInput').files = files;
        handleFileSelect({target: {files}});
    }
});
```

**3. èª¿ç”¨å¾Œç«¯ API ä¸Šå‚³æª”æ¡ˆ**

```javascript
async function uploadFile() {
    if (!selectedFile) {
        alert('è«‹å…ˆé¸æ“‡æª”æ¡ˆ');
        return;
    }

    const formData = new FormData();
    formData.append('file', selectedFile);
    formData.append('chunk_size', document.getElementById('chunkSize').value);
    formData.append('overlap', document.getElementById('overlap').value);

    const status = document.getElementById('uploadStatus');
    status.innerHTML = '<div class="loading">â³ è™•ç†ä¸­...</div>';

    try {
        const response = await fetch(`${API_BASE}/api/rag/ingest/files`, {
            method: 'POST',
            body: formData
        });

        const data = await response.json();

        if (response.ok) {
            status.innerHTML = `
                <div class="result-card">
                    <h3>âœ… ä¸Šå‚³æˆåŠŸï¼</h3>
                    <p>æ–‡ä»¶ ID: ${data.document_id}</p>
                    <p>å»ºç«‹ ${data.chunks_created} å€‹ chunks</p>
                    <p>å»ºç«‹ ${data.embeddings_created} å€‹ embeddings</p>
                </div>
            `;
            selectedFile = null;
            document.getElementById('fileInput').value = '';
            document.getElementById('uploadZone').innerHTML = '<p>ğŸ“„ é»æ“Šæˆ–æ‹–æ›³ PDF æª”æ¡ˆåˆ°é€™è£¡</p>';
        } else {
            status.innerHTML = `<div class="result-card" style="border-left-color: #dc3545;">âŒ éŒ¯èª¤: ${data.detail}</div>`;
        }
    } catch (error) {
        status.innerHTML = `<div class="result-card" style="border-left-color: #dc3545;">âŒ ç¶²è·¯éŒ¯èª¤: ${error.message}</div>`;
    }
}
```

**4. è¼‰å…¥æ–‡ä»¶åˆ—è¡¨**

```javascript
async function loadDocuments() {
    const tbody = document.getElementById('documentsTableBody');
    const statsGrid = document.getElementById('statsGrid');
    tbody.innerHTML = '<tr><td colspan="7" class="loading">è¼‰å…¥ä¸­...</td></tr>';

    try {
        const response = await fetch(`${API_BASE}/api/rag/stats/`);
        const data = await response.json();

        // çµ±è¨ˆå¡ç‰‡
        statsGrid.innerHTML = `
            <div class="stat-card">
                <div class="stat-value">${data.total_documents}</div>
                <div class="stat-label">æ–‡ä»¶ç¸½æ•¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${data.total_chunks}</div>
                <div class="stat-label">Chunks ç¸½æ•¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${data.total_embeddings}</div>
                <div class="stat-label">Embeddings ç¸½æ•¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${(data.total_bytes / 1024 / 1024).toFixed(2)} MB</div>
                <div class="stat-label">ç¸½å¤§å°</div>
            </div>
        `;

        // æ–‡ä»¶è¡¨æ ¼
        tbody.innerHTML = data.documents.map(doc => `
            <tr>
                <td>${doc.id}</td>
                <td>${doc.title}</td>
                <td>${doc.pages}</td>
                <td>${(doc.bytes / 1024).toFixed(2)} KB</td>
                <td>${doc.chunks_count}</td>
                <td>${new Date(doc.created_at).toLocaleString('zh-TW')}</td>
                <td>
                    <button class="btn" onclick="viewChunks(${doc.id})">æª¢è¦– Chunks</button>
                    <button class="btn btn-danger" onclick="deleteDocument(${doc.id})">åˆªé™¤</button>
                </td>
            </tr>
        `).join('');

    } catch (error) {
        tbody.innerHTML = '<tr><td colspan="7" class="loading">è¼‰å…¥å¤±æ•—</td></tr>';
    }
}
```

**5. ç·¨è¼¯ Chunk**

```javascript
function editChunk(chunkId, text) {
    currentChunkId = chunkId;
    document.getElementById('chunkEditor').value = text;
    document.getElementById('editModal').classList.add('active');
}

async function saveChunk() {
    const newText = document.getElementById('chunkEditor').value;

    try {
        const response = await fetch(`${API_BASE}/api/rag/chunks/${currentChunkId}`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({text: newText})
        });

        if (response.ok) {
            alert('å„²å­˜æˆåŠŸ');
            closeModal();
            loadChunks();
        }
    } catch (error) {
        alert('å„²å­˜å¤±æ•—: ' + error.message);
    }
}
```

**6. åŸ·è¡Œæœå°‹**

```javascript
async function performSearch() {
    const query = document.getElementById('searchQuery').value;
    const topK = parseInt(document.getElementById('topK').value);
    const threshold = parseFloat(document.getElementById('threshold').value);
    const resultsDiv = document.getElementById('searchResults');

    if (!query) {
        alert('è«‹è¼¸å…¥æœå°‹å•é¡Œ');
        return;
    }

    resultsDiv.innerHTML = '<div class="loading">æœå°‹ä¸­...</div>';

    try {
        const response = await fetch(`${API_BASE}/api/rag/search/`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                query: query,
                top_k: topK,
                similarity_threshold: threshold
            })
        });

        const results = await response.json();

        if (results.length === 0) {
            resultsDiv.innerHTML = '<div class="loading">ğŸ˜” æ²’æœ‰æ‰¾åˆ°ç›¸é—œçµæœï¼Œè©¦è‘—é™ä½ç›¸ä¼¼åº¦é–€æª»</div>';
            return;
        }

        resultsDiv.innerHTML = `
            <h3>æ‰¾åˆ° ${results.length} å€‹çµæœ</h3>
            ${results.map((result, idx) => `
                <div class="result-card">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <div>
                                <strong>çµæœ #${idx + 1}</strong>
                                <span class="result-score">${(result.similarity_score * 100).toFixed(1)}%</span>
                            </div>
                            <p style="color: #666; margin-top: 5px;">ğŸ“„ ${result.document_title} (Chunk #${result.ordinal})</p>
                            <p style="margin-top: 10px; color: #333;">${result.text}</p>
                        </div>
                    </div>
                </div>
            `).join('')}
        `;

    } catch (error) {
        resultsDiv.innerHTML = `<div class="loading">âŒ æœå°‹å¤±æ•—: ${error.message}</div>`;
    }
}
```

---

### 5.3 æœ¬åœ°æ¸¬è©¦ï¼ˆ15 åˆ†é˜ï¼‰

**æ­¥é©Ÿ 1ï¼šç¢ºèªç’°å¢ƒè®Šæ•¸**

ç¢ºä¿ä½ çš„ `.env` æª”æ¡ˆåŒ…å«ä»¥ä¸‹å…§å®¹ï¼ˆå¾ç¬¬ 3 éƒ¨åˆ†è¤‡è£½ï¼‰ï¼š

```bash
DATABASE_URL=postgresql://postgres.xxx:password@aws-0-ap-southeast-1.pooler.supabase.com:5432/postgres
OPENAI_API_KEY=sk-proj-xxx
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_SERVICE_KEY=eyJhbGci...
SECRET_KEY=your-secret-key-min-32-chars
```

---

**æ­¥é©Ÿ 2ï¼šå®‰è£å¥—ä»¶**

```bash
pip install -r requirements.txt
```

---

**æ­¥é©Ÿ 3ï¼šå•Ÿå‹•å¾Œç«¯**

```bash
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

ä½ æ‡‰è©²æœƒçœ‹åˆ°ï¼š

```
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [12345] using WatchFiles
INFO:     Started server process [12346]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

---

**æ­¥é©Ÿ 4ï¼šé–‹å•Ÿå‰ç«¯**

ç€è¦½å™¨å‰å¾€ï¼š`http://localhost:8000/static/index.html`

---

**æ­¥é©Ÿ 5ï¼šæ¸¬è©¦åŠŸèƒ½**

1. **ä¸Šå‚³ PDF æ–‡ä»¶**
   - é»æ“Šã€ŒğŸ“¤ ä¸Šå‚³æ–‡ä»¶ã€é ç±¤
   - æ‹–æ›³ä¸€å€‹ PDF æª”æ¡ˆåˆ°ä¸Šå‚³å€åŸŸ
   - é»æ“Šã€ŒğŸš€ é–‹å§‹ä¸Šå‚³ã€
   - ç­‰å¾…è™•ç†å®Œæˆï¼ˆå¯èƒ½éœ€è¦ 10-30 ç§’ï¼Œå–æ±ºæ–¼æª”æ¡ˆå¤§å°ï¼‰

2. **æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨**
   - é»æ“Šã€ŒğŸ“Š æ–‡ä»¶åˆ—è¡¨ã€é ç±¤
   - æŸ¥çœ‹çµ±è¨ˆå¡ç‰‡ï¼ˆæ–‡ä»¶ç¸½æ•¸ã€Chunks ç¸½æ•¸ã€Embeddings ç¸½æ•¸ã€ç¸½å¤§å°ï¼‰
   - æŸ¥çœ‹æ–‡ä»¶è¡¨æ ¼ï¼ˆæª”åã€é æ•¸ã€å¤§å°ã€Chunks æ•¸é‡ã€ä¸Šå‚³æ™‚é–“ï¼‰

3. **ç®¡ç† Chunks**
   - é»æ“Šã€Œâœ‚ï¸ Chunks ç®¡ç†ã€é ç±¤
   - å¾ä¸‹æ‹‰é¸å–®é¸æ“‡ä¸€å€‹æ–‡ä»¶
   - æŸ¥çœ‹è©²æ–‡ä»¶çš„æ‰€æœ‰ chunks
   - é»æ“Šã€Œç·¨è¼¯ã€æŒ‰éˆ•ï¼Œä¿®æ”¹ chunk æ–‡å­—
   - é»æ“Šã€Œåˆªé™¤ã€æŒ‰éˆ•ï¼Œåˆªé™¤ chunk

4. **æ¸¬è©¦æœå°‹**
   - é»æ“Šã€ŒğŸ” æœå°‹æ¸¬è©¦ã€é ç±¤
   - è¼¸å…¥æœå°‹å•é¡Œï¼ˆä¾‹å¦‚ï¼šã€Œè·æ¥­æ¢ç´¢çš„æ–¹æ³•ã€ï¼‰
   - è¨­å®š Top Kï¼ˆå›å‚³æ•¸é‡ï¼‰å’Œç›¸ä¼¼åº¦é–€æª»
   - é»æ“Šã€ŒğŸ” æœå°‹ã€
   - æŸ¥çœ‹æœå°‹çµæœï¼ˆåŒ…å«ç›¸ä¼¼åº¦åˆ†æ•¸ã€æ–‡ä»¶æ¨™é¡Œã€chunk å…§å®¹ï¼‰

---

### 5.4 éƒ¨ç½²åˆ° Cloud Runï¼ˆ30 åˆ†é˜ï¼‰

**æ­¥é©Ÿ 1ï¼šå»ºç«‹ Dockerfile**

åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„å»ºç«‹ `Dockerfile`ï¼š

```dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8080"]
```

**èªªæ˜**ï¼š
- `FROM python:3.11-slim`ï¼šä½¿ç”¨ç²¾ç°¡ç‰ˆ Python æ˜ åƒæª”
- `WORKDIR /app`ï¼šè¨­å®šå·¥ä½œç›®éŒ„
- `COPY requirements.txt .`ï¼šè¤‡è£½å¥—ä»¶æ¸…å–®
- `RUN pip install ...`ï¼šå®‰è£å¥—ä»¶
- `COPY . .`ï¼šè¤‡è£½æ‰€æœ‰å°ˆæ¡ˆæª”æ¡ˆ
- `CMD ["uvicorn", ...]`ï¼šå•Ÿå‹• FastAPIï¼ˆCloud Run ä½¿ç”¨ port 8080ï¼‰

---

**æ­¥é©Ÿ 2ï¼šéƒ¨ç½²åˆ° Cloud Run**

```bash
# ç™»å…¥ Google Cloud
gcloud auth login

# è¨­å®šå°ˆæ¡ˆ ID
gcloud config set project YOUR_PROJECT_ID

# éƒ¨ç½²
gcloud run deploy rag-system \
  --source . \
  --region asia-east1 \
  --allow-unauthenticated \
  --set-env-vars DATABASE_URL="postgresql://postgres.xxx:password@aws-0-ap-southeast-1.pooler.supabase.com:5432/postgres" \
  --set-env-vars OPENAI_API_KEY="sk-proj-xxx" \
  --set-env-vars SUPABASE_URL="https://xxx.supabase.co" \
  --set-env-vars SUPABASE_SERVICE_KEY="eyJhbGci..." \
  --set-env-vars SECRET_KEY="your-secret-key-min-32-chars"
```

**èªªæ˜**ï¼š
- `--source .`ï¼šä½¿ç”¨ç•¶å‰ç›®éŒ„çš„åŸå§‹ç¢¼ï¼ˆCloud Run æœƒè‡ªå‹•å»ºç«‹ Docker æ˜ åƒæª”ï¼‰
- `--region asia-east1`ï¼šéƒ¨ç½²åˆ°äºæ´²æ±éƒ¨ï¼ˆå°ç£é„°è¿‘åœ°å€ï¼‰
- `--allow-unauthenticated`ï¼šå…è¨±æœªèªè­‰çš„è«‹æ±‚ï¼ˆå…¬é–‹å­˜å–ï¼‰
- `--set-env-vars ...`ï¼šè¨­å®šç’°å¢ƒè®Šæ•¸

---

**æ­¥é©Ÿ 3ï¼šå–å¾—éƒ¨ç½² URL**

éƒ¨ç½²å®Œæˆå¾Œï¼Œä½ æœƒçœ‹åˆ°ï¼š

```
Service [rag-system] revision [rag-system-00001-abc] has been deployed and is serving 100 percent of traffic.
Service URL: https://rag-system-abcdefg-de.a.run.app
```

è¤‡è£½ Service URLï¼Œä¾‹å¦‚ï¼š`https://rag-system-abcdefg-de.a.run.app`

---

**æ­¥é©Ÿ 4ï¼šé–‹å•Ÿå‰ç«¯**

ç€è¦½å™¨å‰å¾€ï¼š`https://rag-system-abcdefg-de.a.run.app/static/index.html`

ç¾åœ¨ä½ çš„ RAG ç³»çµ±å·²ç¶“åœ¨é›²ç«¯ä¸Šé‹è¡Œäº†ï¼

---

### 5.5 å¸¸è¦‹å•é¡Œæ’è§£

**Q1: CORS éŒ¯èª¤**

```
Access to fetch at 'http://localhost:8000/api/rag/stats/' from origin 'http://localhost:3000' has been blocked by CORS policy
```

**A**ï¼šç¢ºèª `app/main.py` æœ‰åŠ å…¥ CORS middleware

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

---

**Q2: ä¸Šå‚³æª”æ¡ˆå¤±æ•—**

```
HTTPException: Supabase bucket 'documents' not found
```

**A**ï¼šæª¢æŸ¥ Supabase Storage bucket æ˜¯å¦å»ºç«‹

1. å‰å¾€ Supabase Dashboard â†’ Storage
2. å»ºç«‹ä¸€å€‹åç‚º `documents` çš„ bucket
3. è¨­å®šç‚º Publicï¼ˆæˆ–è¨­å®šé©ç•¶çš„å­˜å–æ¬Šé™ï¼‰

---

**Q3: æœå°‹æ²’æœ‰çµæœ**

**A**ï¼šé™ä½ç›¸ä¼¼åº¦é–€æª»

- é è¨­é–€æª»æ˜¯ `0.7`ï¼ˆ70% ç›¸ä¼¼åº¦ï¼‰
- è©¦è‘—é™ä½åˆ° `0.5` æˆ– `0.3`
- æˆ–è€…å¢åŠ  `top_k` æ•¸é‡ï¼ˆå¾ 5 æ”¹æˆ 10ï¼‰

---

**Q4: Database connection failed**

**A**ï¼šæª¢æŸ¥ `DATABASE_URL` æ ¼å¼

ç¢ºä¿ `.env` æª”æ¡ˆä¸­çš„ `DATABASE_URL` æ ¼å¼æ­£ç¢ºï¼š

```bash
DATABASE_URL=postgresql://postgres.xxx:password@aws-0-ap-southeast-1.pooler.supabase.com:5432/postgres
```

---

**Q5: OpenAI API rate limit**

```
openai.error.RateLimitError: You exceeded your current quota
```

**A**ï¼šæª¢æŸ¥ OpenAI API é¡åº¦

1. å‰å¾€ https://platform.openai.com/account/usage
2. ç¢ºèªä½ æœ‰è¶³å¤ çš„é¡åº¦
3. æˆ–å‡ç´šåˆ°ä»˜è²»æ–¹æ¡ˆ

---

### 5.6 ç¸½çµ

æ­å–œï¼ä½ å·²ç¶“å»ºç«‹äº†ä¸€å€‹å®Œæ•´çš„ RAG æ–‡ä»¶ç®¡ç†ç³»çµ±ï¼

**åŠŸèƒ½æ¸…å–®**ï¼š
- âœ… ä¸Šå‚³ PDF æ–‡ä»¶
- âœ… è‡ªå‹•åˆ‡ç‰‡ + ç”Ÿæˆ embeddings
- âœ… æ–‡ä»¶åˆ—è¡¨èˆ‡çµ±è¨ˆ
- âœ… Chunks CRUD ç®¡ç†
- âœ… å‘é‡ç›¸ä¼¼åº¦æœå°‹
- âœ… æ¼‚äº®çš„å‰ç«¯ä»‹é¢
- âœ… éƒ¨ç½²åˆ° Cloud Run

**ä½ å­¸åˆ°äº†**ï¼š

1. **å¾Œç«¯é–‹ç™¼**ï¼š
   - FastAPI è·¯ç”±è¨­è¨ˆ
   - SQLAlchemy ORM
   - Pydantic è³‡æ–™é©—è­‰
   - éåŒæ­¥è™•ç†ï¼ˆasync/awaitï¼‰
   - CORS è¨­å®š

2. **å‰ç«¯é–‹ç™¼**ï¼š
   - HTML/CSS/JavaScript
   - Fetch APIï¼ˆAJAX è«‹æ±‚ï¼‰
   - DOM æ“ä½œ
   - æ‹–æ‹‰ä¸Šå‚³åŠŸèƒ½
   - Modal å½ˆå‡ºè¦–çª—

3. **ç³»çµ±æ•´åˆ**ï¼š
   - å‰å¾Œç«¯æºé€š
   - RESTful API è¨­è¨ˆ
   - ç’°å¢ƒè®Šæ•¸ç®¡ç†
   - Docker å®¹å™¨åŒ–
   - Cloud Run éƒ¨ç½²

**ä¸‹ä¸€æ­¥**ï¼š

1. ğŸ¨ **å®¢è£½åŒ–ä»‹é¢æ¨£å¼**ï¼šä¿®æ”¹ CSS é¡è‰²ã€å­—å‹ã€æ’ç‰ˆ
2. ğŸ” **åŠ å…¥ä½¿ç”¨è€…èªè­‰**ï¼šä½¿ç”¨ Supabase Auth æˆ– JWT
3. ğŸ“Š **é€²éšçµ±è¨ˆåˆ†æ**ï¼šåœ–è¡¨è¦–è¦ºåŒ–ï¼ˆChart.jsï¼‰
4. ğŸ¤– **æ•´åˆ Chatbot åŠŸèƒ½**ï¼šä½¿ç”¨ OpenAI Chat API + RAG æœå°‹çµæœ
5. ğŸ“± **RWD éŸ¿æ‡‰å¼è¨­è¨ˆ**ï¼šæ”¯æ´æ‰‹æ©Ÿã€å¹³æ¿
6. ğŸ§ª **å–®å…ƒæ¸¬è©¦**ï¼šä½¿ç”¨ pytest æ¸¬è©¦ API
7. ğŸ“ˆ **ç›£æ§èˆ‡æ—¥èªŒ**ï¼šä½¿ç”¨ Sentry æˆ– Google Cloud Logging

---

## é™„éŒ„

### å¸¸è¦‹å•é¡Œ FAQ

**Q1ï¼šä¸Šå‚³æ–‡ä»¶å¾Œå¤šä¹…å¯ä»¥æœå°‹ï¼Ÿ**

Aï¼šç«‹å³å¯ä»¥æœå°‹ï¼æµç¨‹å¦‚ä¸‹ï¼š
- ä¸Šå‚³ PDFï¼ˆ5 ç§’ï¼‰
- æå–æ–‡å­—ï¼ˆ5 ç§’ï¼‰
- åˆ‡ç‰‡ + ç”Ÿæˆå‘é‡ï¼ˆ10-20 ç§’ï¼‰
- ç¸½è¨ˆï¼šç´„ 20-30 ç§’

---

**Q2ï¼šæ”¯æ´å“ªäº›æª”æ¡ˆæ ¼å¼ï¼Ÿ**

Aï¼šç›®å‰æ”¯æ´ï¼š
- âœ… PDF
- âœ… ç´”æ–‡å­—ï¼ˆ.txtï¼‰
- âœ… ç¶²é  URLï¼ˆè‡ªå‹•çˆ¬å–ï¼‰
- âš ï¸ Wordï¼ˆéœ€è½‰ PDFï¼‰
- âš ï¸ PowerPointï¼ˆéœ€è½‰ PDFï¼‰

---

**Q3ï¼šæ–‡ä»¶å¤ªå¤šæœƒå¾ˆæ…¢å—ï¼Ÿ**

Aï¼šä¸æœƒï¼å‘é‡æœå°‹çš„ç‰¹æ€§ï¼š
- 1000 å€‹æ®µè½ï¼š< 100 ms
- 10000 å€‹æ®µè½ï¼š< 300 ms
- 100000 å€‹æ®µè½ï¼š< 1 ç§’

**åŸå› **ï¼špgvector ä½¿ç”¨ IVFFlat ç´¢å¼•ï¼Œæ™‚é–“è¤‡é›œåº¦æ¥è¿‘ O(log n)

---

**Q4ï¼šå¦‚ä½•åˆªé™¤æˆ–æ›´æ–°æ–‡ä»¶ï¼Ÿ**

Aï¼š
```bash
# åˆªé™¤æ–‡ä»¶ï¼ˆæœƒè‡ªå‹•åˆªé™¤æ‰€æœ‰æ®µè½å’Œå‘é‡ï¼‰
curl -X DELETE "https://your-api-url.com/api/rag/documents/123"

# æ›´æ–°ï¼šå…ˆåˆªé™¤ï¼Œå†é‡æ–°ä¸Šå‚³
curl -X DELETE ".../documents/123"
curl -X POST ".../ingest/files" -F "file=@new_version.pdf"
```

---

**Q5ï¼šæœå°‹çµæœä¸æº–ç¢ºæ€éº¼è¾¦ï¼Ÿ**

**æ–¹æ³• 1ï¼šèª¿æ•´åˆ‡ç‰‡åƒæ•¸**
```json
{
  "chunk_size": 300,  // æ”¹å°ä¸€é»ï¼Œæ›´ç²¾æº–
  "overlap": 100      // é‡ç–Šå¤šä¸€é»ï¼Œé¿å…æ–·å¥
}
```

**æ–¹æ³• 2ï¼šé™ä½ç›¸ä¼¼åº¦é–€æª»**
```json
{
  "similarity_threshold": 0.6  // å¾ 0.7 é™åˆ° 0.6
}
```

**æ–¹æ³• 3ï¼šå¢åŠ æª¢ç´¢æ•¸é‡**
```json
{
  "top_k": 10  // å¾ 5 å¢åŠ åˆ° 10
}
```

---

**Q6ï¼šä¸­æ–‡å’Œè‹±æ–‡å¯ä»¥æ··åˆæœå°‹å—ï¼Ÿ**

Aï¼šå¯ä»¥ï¼OpenAI Embedding æ”¯æ´å¤šèªè¨€ï¼š
```
å•é¡Œï¼ˆä¸­æ–‡ï¼‰ï¼šã€Œå¦‚ä½•é‡è¨­å¯†ç¢¼ï¼Ÿã€
æ‰¾åˆ°æ–‡ä»¶ï¼ˆè‹±æ–‡ï¼‰ï¼š"How to reset password..."
âœ… å¯ä»¥æ‰¾åˆ°ï¼
```

---

**Q7ï¼šæˆæœ¬æœƒå¾ˆé«˜å—ï¼Ÿ**

Aï¼šéå¸¸ä¾¿å®œï¼ä»¥ 20 ä»½æ–‡ä»¶ç‚ºä¾‹ï¼š

| é …ç›® | ç”¨é‡ | æˆæœ¬ |
|-----|------|------|
| ä¸Šå‚³æ–‡ä»¶ï¼ˆä¸€æ¬¡æ€§ï¼‰ | 100,000 å­— | $0.003 |
| æ¯æœˆ 1000 æ¬¡æŸ¥è©¢ | 100,000 å­— | $0.003 |
| æ¯æœˆ GPT-4 å›ç­” | 1000 æ¬¡ Ã— 500 tokens | $15 |
| **ç¸½è¨ˆ** | | **ç´„ $15.01/æœˆ** |

**æœ€è²´çš„æ˜¯ GPT-4 ç”Ÿæˆ**ï¼Œä¸æ˜¯ Embeddingï¼

---

**Q8ï¼šå¯ä»¥é™åˆ¶ç‰¹å®šä½¿ç”¨è€…åªèƒ½æœå°‹ç‰¹å®šæ–‡ä»¶å—ï¼Ÿ**

Aï¼šå¯ä»¥ï¼å…©ç¨®æ–¹å¼ï¼š

**æ–¹å¼ 1ï¼šä½¿ç”¨ Agent éš”é›¢**ï¼ˆæœ¬å°ˆæ¡ˆå·²å¯¦ä½œï¼‰
```sql
-- æ¯å€‹éƒ¨é–€å»ºç«‹å°ˆå±¬ Agent
INSERT INTO agents (name, slug) VALUES
  ('äººäº‹éƒ¨é–€', 'hr'),
  ('æŠ€è¡“éƒ¨é–€', 'tech');

-- ä¸Šå‚³æ™‚æŒ‡å®š Agent
POST /api/rag/ingest/files?agent=hr

-- æœå°‹æ™‚éæ¿¾
POST /api/rag/search?agent=hr
```

**æ–¹å¼ 2ï¼šä½¿ç”¨æ¨™ç±¤éæ¿¾**
```sql
-- ç‚ºæ–‡ä»¶åŠ æ¨™ç±¤
UPDATE documents SET tags = ['internal', 'hr'] WHERE id = 123;

-- æœå°‹æ™‚éæ¿¾
WHERE '{"hr"}' && tags
```

---

### åè©å°ç…§è¡¨

| è‹±æ–‡ | ä¸­æ–‡ | è§£é‡‹ |
|-----|------|------|
| RAG | æª¢ç´¢å¢å¼·ç”Ÿæˆ | å…ˆæœå°‹å†å›ç­”çš„ AI ç³»çµ± |
| Embedding | å‘é‡åµŒå…¥ | æŠŠæ–‡å­—è½‰æˆæ•¸å­—é™£åˆ— |
| Vector | å‘é‡ | ä¸€ä¸²æ•¸å­—ï¼ˆä¾‹å¦‚ 1536 å€‹æµ®é»æ•¸ï¼‰ |
| Chunk | æ–‡å­—ç‰‡æ®µ/æ®µè½ | åˆ‡å¥½çš„æ–‡å­—æ®µè½ |
| Similarity | ç›¸ä¼¼åº¦ | å…©å€‹å‘é‡çš„è·é›¢ï¼ˆè¶Šå°è¶Šç›¸ä¼¼ï¼‰ |
| pgvector | PostgreSQL å‘é‡æ“´å…… | è³‡æ–™åº«çš„å‘é‡æœå°‹åŠŸèƒ½ |
| Top-K | å‰ K å | å–æœ€ç›¸é—œçš„å‰å¹¾å€‹çµæœ |
| Threshold | é–€æª»å€¼ | æœ€ä½ç›¸ä¼¼åº¦æ¨™æº– |
| Token | æ¨™è¨˜/è©å…ƒ | AI è™•ç†çš„æœ€å°å–®ä½ï¼ˆç´„ 0.75 è‹±æ–‡å­—ï¼‰ |

---

### å»¶ä¼¸å­¸ç¿’è³‡æº

**å®˜æ–¹æ–‡ä»¶**ï¼š
- [OpenAI Embeddings Guide](https://platform.openai.com/docs/guides/embeddings)
- [Supabase Vector Documentation](https://supabase.com/docs/guides/ai)
- [pgvector GitHub](https://github.com/pgvector/pgvector)

**é€²éšä¸»é¡Œ**ï¼š
- Hybrid Searchï¼ˆæ··åˆæœå°‹ï¼šé—œéµå­— + èªæ„ï¼‰
- Re-rankingï¼ˆé‡æ–°æ’åºæå‡ç²¾ç¢ºåº¦ï¼‰
- Fine-tuning Embeddingsï¼ˆå®¢è£½åŒ– Embedding æ¨¡å‹ï¼‰
- Multi-Agent RAGï¼ˆå¤šçŸ¥è­˜åº«ç®¡ç†ï¼‰

**ç›¸é—œå·¥å…·**ï¼š
- [LangChain](https://www.langchain.com/)ï¼ˆRAG æ¡†æ¶ï¼‰
- [LlamaIndex](https://www.llamaindex.ai/)ï¼ˆRAG æ¡†æ¶ï¼‰
- [Weaviate](https://weaviate.io/)ï¼ˆå‘é‡è³‡æ–™åº«ï¼‰
- [Pinecone](https://www.pinecone.io/)ï¼ˆå‘é‡è³‡æ–™åº«ï¼‰

---

## ç¸½çµ

æ­å–œä½ å®Œæˆ RAG ç³»çµ±æ•™å­¸ï¼ğŸ‰

**ä½ ç¾åœ¨å·²ç¶“å­¸æœƒ**ï¼š
1. âœ… RAG æ˜¯ä»€éº¼ã€ç‚ºä»€éº¼éœ€è¦å®ƒ
2. âœ… Embedding å¦‚ä½•æŠŠæ–‡å­—è½‰æˆå‘é‡
3. âœ… Supabase + pgvector å¦‚ä½•å„²å­˜å’Œæœå°‹å‘é‡
4. âœ… å¦‚ä½•ä¸Šå‚³æ–‡ä»¶ã€æ¸¬è©¦æœå°‹ã€æ•´åˆåˆ°æ‡‰ç”¨

**ä¸‹ä¸€æ­¥å»ºè­°**ï¼š
1. ğŸš€ ä¸Šå‚³ä½ è‡ªå·±çš„æ–‡ä»¶ï¼Œå»ºç«‹ç¬¬ä¸€å€‹çŸ¥è­˜åº«
2. ğŸ§ª æ¸¬è©¦ä¸åŒçš„åˆ‡ç‰‡åƒæ•¸ï¼ˆchunk_sizeã€overlapï¼‰
3. ğŸ¨ æ•´åˆåˆ°ä½ çš„ç”¢å“ï¼ˆç¶²ç«™ã€Appã€Chatbotï¼‰
4. ğŸ“ˆ ç›£æ§ä½¿ç”¨é‡å’Œæˆæœ¬
5. ğŸ”§ é€²éšï¼šç ”ç©¶ Hybrid Searchã€Re-ranking

**éœ€è¦å¹«åŠ©ï¼Ÿ**
- ğŸ“§ Email: your-email@example.com
- ğŸ’¬ Slack: #rag-support
- ğŸ“– å…§éƒ¨æ–‡ä»¶: [é€£çµ]

---

**æœ€å¾Œæ›´æ–°**ï¼š2024-10-30
**ç‰ˆæœ¬**ï¼šv1.0
**ä½œè€…**ï¼šClaude Code
