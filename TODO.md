# TODO - é–‹ç™¼ä»»å‹™æ¸…å–®

**æœ€å¾Œæ›´æ–°**: 2025-12-27

---

## ä»»å‹™ä¸€ï¼šWeb æ”¹ç‰ˆï¼ˆWeb Realtime Consoleï¼‰

### 1.1 ç´…ç¶ ç‡ˆå¡ç‰‡æ©Ÿåˆ¶ï¼ˆè¦–è¦ºåŒ–é¢¨éšªç­‰ç´šï¼‰

**Backend âœ… å·²å®Œæˆ**
- Response schema åŒ…å« risk_level, severity, suggested_interval_seconds
- å‹•æ…‹åˆ†æé–“éš”ï¼šGreen 60s / Yellow 30s / Red 15s

**Frontend å¾…å®Œæˆ**:
- [ ] æ ¹æ“š suggested_interval_seconds å‹•æ…‹èª¿æ•´ Timer
- [ ] ç´…é»ƒç¶ è¦–è¦ºåŒ–ï¼ˆé¡è‰²ã€å¤§å°ã€å‹•ç•«ï¼‰

---

## ä»»å‹™ä¸‰ï¼šiOS API æ”¹ç‰ˆ - island_parents ç§Ÿæˆ¶

### 3.1 Multi-Tenant æ¶æ§‹æ“´å……
- [ ] æ‰€æœ‰ table éƒ½æœ‰ tenant_id æ¬„ä½
- [ ] API è‡ªå‹•æ³¨å…¥ tenant_idï¼ˆåŸºæ–¼ JWTï¼‰
- [ ] Query è‡ªå‹•éæ¿¾ tenantï¼ˆé¿å…è·¨ç§Ÿæˆ¶è³‡æ–™æ´©æ¼ï¼‰

### 3.2 Client ç‰©ä»¶ç°¡åŒ–ï¼ˆisland_parents å°ˆç”¨ï¼‰
- [ ] island_parents çš„ Client åªéœ€å…©å€‹ required æ¬„ä½ï¼šname + grade (1-12)
- [ ] Optional æ¬„ä½ï¼šbirth_date, gender, notes
- [ ] DB Schema èª¿æ•´ï¼šæ–°å¢ grade æ¬„ä½ï¼Œæ—¢æœ‰æ¬„ä½æ”¹ nullable
- [ ] Schema Validationï¼šClientCreateIslandParents
- [ ] API è·¯ç”±åˆ†é›¢ï¼šPOST /api/v1/island/clients

### 3.3 Session è³‡æ–™çµæ§‹èª¿æ•´

**3.3.1 æ–°å¢æ¬„ä½**:
- [ ] scenario_topic (String, optional) - ç·´ç¿’æƒ…å¢ƒ
- [ ] mode (String, required) - practice / emergency
- [ ] partial_segments (JSONB) - å„²å­˜ partial åˆ†æç‰‡æ®µ
- [ ] partial_last_updated_at (DateTime)

**3.3.2 éŒ„éŸ³åŒæ„æµç¨‹ï¼ˆå¯¦æˆ°æ¨¡å¼ï¼‰**:
- [ ] è¨­è¨ˆéŒ„éŸ³åŒæ„æ–‡æ¡ˆèˆ‡æµç¨‹ï¼ˆæ³•å‹™å¯©æ ¸ï¼‰
- [ ] POST /api/v1/island/sessions/{id}/consent API
- [ ] RecordingConsent Model + migration
- [ ] iOSï¼šå¯¦æˆ°æ¨¡å¼é–‹å§‹å‰é¡¯ç¤ºåŒæ„å½ˆçª—
- [ ] éš±ç§æ”¿ç­–èˆ‡åˆè¦å¯©æŸ¥ï¼ˆGDPR, å€‹è³‡æ³•ï¼‰

**3.3.3 ä½¿ç”¨è¨˜éŒ„é‚Šç•Œæƒ…å¢ƒè™•ç†**:
- [ ] å®šç¾©é‚Šç•Œæƒ…å¢ƒè¦å‰‡ï¼ˆä¸­é€”å–æ¶ˆã€é›¢ç·šã€éœéŸ³ï¼‰
- [ ] å¢é‡æ›´æ–° SessionUsageï¼ˆæ¯ 30 ç§’ï¼‰
- [ ] Session ç•°å¸¸çµæŸè‡ªå‹•è£œå®Œï¼ˆcron jobï¼‰
- [ ] Admin çˆ­è­°è™•ç† API

**3.3.4 å‰ç«¯ä½¿ç”¨æ™‚é•·èˆ‡é»æ•¸é¡¯ç¤º**:
- [ ] GET /api/v1/island/credits/balance API
- [ ] ä½é»æ•¸è­¦å‘Šé‚è¼¯ï¼ˆ< 100 é»ƒè‰²ï¼Œ< 20 ç´…è‰²ï¼‰
- [ ] iOS/Web å³æ™‚é¡¯ç¤º UI

### 3.4 è‡ªå‹•å­˜æª”åŠŸèƒ½ï¼ˆä¸‰æ®µå¼ APIï¼‰

**Phase 1: é–‹å§‹éŒ„éŸ³**:
- [ ] POST /api/v1/island/sessions - å»ºç«‹ç©º Session
- [ ] å›å‚³ session_id çµ¦ App

**Phase 2: éŒ„éŸ³ä¸­**:
- [ ] POST /api/v1/island/sessions/{id}/analyze-partial
- [ ] å„²å­˜ partial segment åˆ° JSONB
- [ ] åŸ·è¡Œå³æ™‚åˆ†æï¼ˆç´…é»ƒç¶ ç‡ˆåˆ¤æ–·ï¼‰
- [ ] è¨ˆç®—èˆ‡å‰ä¸€å¼µå¡ç‰‡çš„ç›¸ä¼¼åº¦
- [ ] å›å‚³åˆ†æçµæœï¼ˆå« should_mergeï¼‰

**Phase 3: çµæŸéŒ„éŸ³**:
- [ ] PATCH /api/v1/island/sessions/{id}/complete
- [ ] æ›´æ–°å®Œæ•´é€å­—ç¨¿
- [ ] Fallback æ©Ÿåˆ¶ï¼šè‹¥ full_transcript ç‚ºç©ºï¼Œä½¿ç”¨ partial_segments æ‹¼æ¥

**3.4.2 å ±å‘Šå±•ç¤ºå±¤ç´šèˆ‡RAGè¡“èªå¯è¦‹æ€§**:
- [ ] å®šç¾© RAG ç†è«–æ¨™ç±¤é¡¯ç¤ºè¦å‰‡ï¼ˆç”¢å“æ±ºç­–ï¼‰
- [ ] å®šç¾©å°ˆæ¥­è¡“èªè™•ç†æ–¹å¼ï¼ˆç”¢å“æ±ºç­–ï¼‰
- [ ] å ±å‘Š Schema èª¿æ•´ï¼ˆæ”¯æ´å¯é¸é¡¯ç¤ºï¼‰
- [ ] iOS/Web UI èª¿æ•´ï¼ˆæ‘ºç–Š/å±•é–‹ã€tooltipï¼‰

### 3.5 å³æ™‚åˆ†æ API æ”¹ç‰ˆ
- [ ] ä½¿ç”¨ç›¸åŒçš„ response schemaï¼ˆèˆ‡ Web ç‰ˆä¸€è‡´ï¼‰
- [ ] island_parents ç§Ÿæˆ¶å°ˆç”¨çš„ Prompt èª¿æ•´
- [ ] RAG çŸ¥è­˜åº«ï¼šä½¿ç”¨è¦ªå­æ•™é¤Šç›¸é—œçŸ¥è­˜

### 3.6 Case ç®¡ç†ç°¡åŒ–
- [ ] é è¨­ Case è‡ªå‹•å»ºç«‹ï¼ˆã€Œè¦ªå­æºé€šæˆé•·ã€ï¼‰
- [ ] API ç°¡åŒ–ï¼šCreate Session æ™‚è‡ªå‹•ä½¿ç”¨é è¨­ Case

**3.6.3 é»æ•¸æœ‰æ•ˆæœŸèˆ‡çµç®—ç´°å‰‡**:
- [ ] å®šç¾©é»æ•¸æœ‰æ•ˆæœŸè¦å‰‡ï¼ˆç”¢å“æ±ºç­–ï¼šæ¯å­¸æœŸ/åŠå¹´/ä¸€å¹´ï¼‰
- [ ] å®šç¾©åˆ°æœŸè™•ç†è¦å‰‡ï¼ˆæ­¸é›¶/æ»¾å­˜/å»¶æœŸï¼‰
- [ ] CreditPackage Model æ›´æ–°ï¼ˆæ–°å¢ expires_at ç­‰æ¬„ä½ï¼‰
- [ ] åˆ°æœŸè‡ªå‹•è™•ç† Cron Jobï¼ˆæ¯æ—¥ 00:00ï¼‰
- [ ] GET /api/v1/island/credits/expiry API
- [ ] POST /api/v1/admin/credits/extend-expiry APIï¼ˆAdmin æ‰‹å‹•å»¶æœŸï¼‰
- [ ] Email é€šçŸ¥æ•´åˆï¼ˆåˆ°æœŸå‰ 7 å¤© + 1 å¤©ï¼‰

---

## ä»»å‹™å››ï¼šå¯†ç¢¼ç®¡ç†èˆ‡é€šçŸ¥ç³»çµ±

### 4.1 å¸³è™Ÿå»ºç«‹å¾Œè‡ªå‹•ç™¼é€å¯†ç¢¼ä¿¡ä»¶
- [ ] æ•´åˆ Email æœå‹™ï¼ˆSendGrid / AWS SES / SMTPï¼‰
- [ ] è¨­å®š Email æ¨¡æ¿ï¼ˆæ­¡è¿ä¿¡ä»¶ï¼‰
- [ ] ä¿®æ”¹ POST /api/v1/admin/counselors è§¸ç™¼ç™¼é€
- [ ] EmailLog Modelï¼ˆè¨˜éŒ„ç™¼é€ç‹€æ…‹ï¼‰

### 4.2 å¯†ç¢¼é‡è¨­é é¢ï¼ˆWebï¼‰
- [ ] å¯†ç¢¼é‡è¨­è«‹æ±‚é é¢ï¼ˆ/reset-passwordï¼‰
- [ ] PasswordResetToken Modelï¼ˆtoken, expires_at, usedï¼‰
- [ ] å¯†ç¢¼é‡è¨­ç¢ºèªé é¢ï¼ˆ/reset-password/confirm?token={token}ï¼‰
- [ ] ç™¼é€å¯†ç¢¼é‡è¨­ä¿¡ä»¶

### 4.3 å¯†ç¢¼é‡è¨­ APIï¼ˆçµ¦ iOS ä½¿ç”¨ï¼‰
- [ ] POST /api/v1/auth/password-reset/request
- [ ] POST /api/v1/auth/password-reset/verify
- [ ] POST /api/v1/auth/password-reset/confirm
- [ ] Token å®‰å…¨ï¼šåŠ å¯†éš¨æ©Ÿå­—ä¸²ï¼ˆ32+ å­—å…ƒï¼‰ã€1 å°æ™‚æœ‰æ•ˆæœŸã€åªèƒ½ä½¿ç”¨ä¸€æ¬¡
- [ ] è«‹æ±‚é »ç‡é™åˆ¶ï¼ˆ5 åˆ†é˜å…§åªèƒ½è«‹æ±‚ä¸€æ¬¡ï¼‰

### 4.4 æ•´åˆæ¸¬è©¦èˆ‡æ–‡æª”
- [ ] å®Œæ•´æµç¨‹æ¸¬è©¦ï¼ˆå»ºç«‹å¸³è™Ÿ â†’ æ­¡è¿ä¿¡ â†’ å¯†ç¢¼é‡è¨­ï¼‰
- [ ] API æ–‡æª”æ›´æ–°ï¼ˆSwagger UIï¼‰
- [ ] é–‹ç™¼è€…æ–‡æª”ï¼ˆç’°å¢ƒè®Šæ•¸ã€éƒ¨ç½²æŒ‡å—ï¼‰

### 4.5 ç™»å…¥å¤±æ•—æç¤ºèªçµ±ä¸€ï¼ˆè³‡å®‰ï¼‰
- [ ] Backend: çµ±ä¸€ API éŒ¯èª¤è¨Šæ¯ï¼ˆå¯†ç¢¼éŒ¯èª¤ = å¸³è™Ÿä¸å­˜åœ¨ = "ç™»å…¥è³‡æ–™æœ‰èª¤"ï¼‰
- [ ] iOS/Web: çµ±ä¸€å‰ç«¯éŒ¯èª¤æç¤º UI
- [ ] æ–‡æª”: ç™»å…¥å¤±æ•—è¨Šæ¯è¦ç¯„

### 4.6 Email ç™¼ä¿¡ç³»çµ±èˆ‡éŒ¯èª¤è™•ç†
- [ ] é¸æ“‡ä¸¦è¨­å®š Email æœå‹™å•†ï¼ˆGmail SMTP / SendGrid / AWS SESï¼‰
- [ ] EmailLog Modelï¼ˆstatus: pending/sent/delivered/bounced/failedï¼‰
- [ ] Email Service å¯¦ä½œï¼ˆç™¼é€ + éŒ¯èª¤è™•ç† + é€€ä¿¡è™•ç†ï¼‰
- [ ] GET /api/v1/admin/emails/logs API
- [ ] POST /api/v1/admin/emails/resend API
- [ ] ç”¨æˆ¶ç«¯é‡ç™¼æ©Ÿåˆ¶ï¼ˆ5 åˆ†é˜é™åˆ¶ï¼‰

### 4.7 å¯†ç¢¼å¼·åº¦æ”¿ç­–èˆ‡å®‰å…¨ç­–ç•¥
- [ ] å®šç¾©å¯†ç¢¼è¦å‰‡ï¼ˆæœ€ä½ 8 å­—å…ƒï¼Œè‹±æ–‡ + æ•¸å­—ï¼‰
- [ ] å¼±å¯†ç¢¼é»‘åå–®ï¼ˆ123456, password, qwerty...ï¼‰
- [ ] Counselor Model æ›´æ–°ï¼ˆfailed_login_attempts, locked_untilï¼‰
- [ ] ç™»å…¥å¤±æ•—é–å®šæ©Ÿåˆ¶ï¼ˆ5 æ¬¡å¤±æ•— â†’ é–å®š 15 åˆ†é˜ï¼‰
- [ ] å¯†ç¢¼é©—è­‰é‚è¼¯ï¼ˆBackendï¼‰
- [ ] iOS/Web å³æ™‚å¯†ç¢¼å¼·åº¦æª¢æŸ¥ UI

---

## ~~ä»»å‹™äº”ï¼šæµ®å³¶ App iOS å®Œæ•´åŠŸèƒ½äº¤ä»˜~~ âœ… å·²åˆä½µè‡³ä»»å‹™ä¸‰

**ğŸ“Œ é‡è¦é€šçŸ¥**: æ­¤ä»»å‹™å·²æ–¼ 2025-12-27 åˆä½µè‡³ **ä»»å‹™ä¸‰ï¼šiOS API æ”¹ç‰ˆ - island_parents ç§Ÿæˆ¶**

**åˆä½µåŸå› **:
- ä»»å‹™ä¸‰å’Œä»»å‹™äº”å…§å®¹é«˜åº¦é‡ç–Šï¼ˆçš†ç‚º island_parents ç§Ÿæˆ¶ç›¸é—œ APIï¼‰
- åˆä½µå¾Œå¯æ›´å¥½åœ°è¿½è¹¤å®Œæ•´çš„ iOS API é–‹ç™¼é€²åº¦

**ğŸ“‹ è©³ç´°ä»»å‹™å…§å®¹è«‹åƒè€ƒ**:
1. **ä»»å‹™ä¸‰**ï¼ˆæœ¬æ–‡ä»¶ä¸Šæ–¹ï¼‰- åŒ…å«å®Œæ•´çš„ iOS API é–‹ç™¼ä»»å‹™
2. **docs/ISLAND_APP_TASKS_REORGANIZED.md** - é‡æ–°çµ„ç¹”å¾Œçš„ä»»å‹™åˆ†è§£ï¼ˆWEB vs iOS APIï¼‰

**åŸä»»å‹™äº”å…§å®¹å·²æ•´åˆè‡³ä»»å‹™ä¸‰**:
- 5.1 æ‰‹æ©Ÿè™Ÿç¢¼ç™»å…¥èˆ‡ SMS èªè­‰ â†’ ä»»å‹™ä¸‰ 3.1.1 SMS Authentication
- 5.2 å­©å­ç®¡ç† API â†’ ä»»å‹™ä¸‰ 3.1.2 Children Management
- 5.3 å››æ ¼æƒ…å¢ƒé¸æ“‡ â†’ ä»»å‹™ä¸‰ 3.2.1 Practice Scenarios
- 5.4 éŒ„éŸ³èˆ‡å³æ™‚æé†’ â†’ ä»»å‹™ä¸‰ 3.3.1 Three-phase Session API
- 5.5 å ±å‘Šç”Ÿæˆ â†’ ä»»å‹™ä¸‰ 3.4.1 Reports
- 5.6 æ­·å²è¨˜éŒ„æŸ¥è©¢ â†’ ä»»å‹™ä¸‰ 3.5.1 History
- 5.7 è¨­ç½®é  API â†’ ä»»å‹™ä¸‰ 3.6.1 Settings
- 5.8 å…Œæ›ç¢¼èˆ‡é»æ•¸ç³»çµ± â†’ ä»»å‹™ä¸‰ 3.6.2 Redeem Codes
- 5.9 Web Admin Console â†’ ä»»å‹™ä¸‰ 3.7 Web Admin APIs

**ğŸš€ è«‹ç›´æ¥æŸ¥çœ‹ä»»å‹™ä¸‰é€²è¡Œé–‹ç™¼**

---
