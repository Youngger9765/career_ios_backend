{% extends "rag/base_sidebar.html" %}

{% block page_title %}è©•ä¼°çŸ©é™£ - SERVER RENDERED{% endblock %}

{% block page_content %}
<div class="mb-4">
    <h2 class="text-2xl font-bold">ğŸ“Š è©•ä¼°çŸ©é™£ï¼ˆServer Renderedï¼‰</h2>
    <p class="text-gray-600">æ‰€æœ‰æ•¸æ“šç”±å¾Œç«¯çµ„ç¹”ä¸¦ç›´æ¥æ¸²æŸ“</p>
</div>

<div class="overflow-x-auto">
    <table class="min-w-full bg-white border border-gray-300">
        <thead class="bg-gray-100">
            <tr>
                <th class="px-4 py-2 border">Chunk ç­–ç•¥</th>
                <th class="px-4 py-2 border">Prompt</th>
                {% for testset in testsets %}
                <th class="px-4 py-2 border">{{ testset.name }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for chunk_strategy in chunk_strategies %}
                {% for prompt in prompts %}
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-4 py-2 border">
                        <strong>{{ chunk_strategy.name }}</strong><br>
                        <small class="text-gray-500">{{ chunk_strategy.chunk_size }}/{{ chunk_strategy.chunk_overlap }}</small>
                    </td>
                    <td class="px-4 py-2 border font-mono">{{ prompt.version }}</td>
                    {% for testset in testsets %}
                    <td class="px-4 py-2 border">
                        {% set exp = matrix[chunk_strategy.name][prompt.version][testset.name] %}
                        {% if exp %}
                            <div class="bg-green-50 p-2 rounded">
                                <div class="text-xs font-bold text-green-800">âœ… å®Œæˆ</div>
                                <div class="text-xs mt-1">
                                    <div>F: <strong>{{ "%.3f"|format(exp.faithfulness if exp.faithfulness else 0) }}</strong></div>
                                    <div>AR: <strong>{{ "%.3f"|format(exp.answer_relevancy if exp.answer_relevancy else 0) }}</strong></div>
                                    <div>CR: <strong>{{ "%.3f"|format(exp.context_recall if exp.context_recall else 0) }}</strong></div>
                                    <div>CP: <strong>{{ "%.3f"|format(exp.context_precision if exp.context_precision else 0) }}</strong></div>
                                </div>
                            </div>
                        {% else %}
                            <div class="text-gray-400 text-center text-sm">æœªè©•ä¼°</div>
                        {% endif %}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="mt-4 p-4 bg-blue-50 rounded">
    <h3 class="font-bold">Debug Info:</h3>
    <div class="text-sm">
        <p>Testsets: {{ testsets|length }}</p>
        <p>Prompts: {{ prompts|length }}</p>
        <p>Chunk Strategies: {{ chunk_strategies|length }}</p>
        <p>Total cells: {{ testsets|length * prompts|length * chunk_strategies|length }}</p>
    </div>
</div>
{% endblock %}
