{% extends "rag/base_sidebar.html" %}

{% block page_title %}Dashboard{% endblock %}

{% block page_content %}
<div class="mb-6">
    <h2 class="text-3xl font-bold text-white mb-2">Dashboard</h2>
    <p class="text-gray-400">系統總覽與快速統計</p>
</div>

<div class="grid grid-cols-2 gap-6 mb-8">
    <!-- Stats Card 1 -->
    <div class="bg-gray-800 rounded-lg p-6">
        <div class="text-4xl mb-3">📚</div>
        <h3 class="text-xl font-semibold text-white mb-2">文件數量</h3>
        <p class="text-3xl font-bold text-blue-400" id="docCount">-</p>
    </div>

    <!-- Stats Card 2 -->
    <div class="bg-gray-800 rounded-lg p-6">
        <div class="text-4xl mb-3">🧩</div>
        <h3 class="text-xl font-semibold text-white mb-2">Chunk 數量</h3>
        <p class="text-3xl font-bold text-green-400" id="chunkCount">-</p>
    </div>

    <!-- Stats Card 3 -->
    <div class="bg-gray-800 rounded-lg p-6">
        <div class="text-4xl mb-3">🔢</div>
        <h3 class="text-xl font-semibold text-white mb-2">Embeddings</h3>
        <p class="text-3xl font-bold text-purple-400" id="agentCount">-</p>
    </div>

    <!-- Stats Card 4 -->
    <div class="bg-gray-800 rounded-lg p-6">
        <div class="text-4xl mb-3">📊</div>
        <h3 class="text-xl font-semibold text-white mb-2">資料來源</h3>
        <p class="text-3xl font-bold text-yellow-400" id="chatCount">-</p>
    </div>
</div>

<div class="bg-gray-800 rounded-lg p-6">
    <h3 class="text-xl font-semibold text-white mb-4">快速操作</h3>
    <div class="grid grid-cols-2 gap-4">
        <a href="/rag/stats" class="bg-blue-600 hover:bg-blue-700 text-white rounded-lg p-4 text-center transition">
            <div class="text-2xl mb-2">📊</div>
            <div>查看資料庫</div>
        </a>
        <a href="/rag/chat" class="bg-green-600 hover:bg-green-700 text-white rounded-lg p-4 text-center transition">
            <div class="text-2xl mb-2">💬</div>
            <div>開始對話</div>
        </a>
        <a href="/rag/report" class="bg-purple-600 hover:bg-purple-700 text-white rounded-lg p-4 text-center transition">
            <div class="text-2xl mb-2">📋</div>
            <div>生成報告</div>
        </a>
        <a href="/rag/upload" class="bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg p-4 text-center transition">
            <div class="text-2xl mb-2">⬆️</div>
            <div>上傳文件</div>
        </a>
    </div>
</div>

<script>
// Load stats
async function loadStats() {
    try {
        const response = await fetch('/api/rag/stats/');
        const data = await response.json();

        document.getElementById('docCount').textContent = data.total_documents || 0;
        document.getElementById('chunkCount').textContent = data.total_chunks || 0;
        document.getElementById('agentCount').textContent = data.total_embeddings || 0;
        document.getElementById('chatCount').textContent = data.total_datasources || 0;
    } catch (error) {
        console.error('Failed to load stats:', error);
        // Set to 0 on error
        document.getElementById('docCount').textContent = '0';
        document.getElementById('chunkCount').textContent = '0';
        document.getElementById('agentCount').textContent = '0';
        document.getElementById('chatCount').textContent = '0';
    }
}

loadStats();
</script>
{% endblock %}
