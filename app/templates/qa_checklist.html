<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>島嶼家長 - QA 驗收測試</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans TC', sans-serif;
            background: #faf9f7;
            color: #3d3833;
            line-height: 1.7;
        }
        .page { max-width: 840px; margin: 0 auto; padding: 32px 24px 64px; }

        /* Header */
        .header {
            text-align: center;
            padding: 40px 0 32px;
            border-bottom: 2px solid #e8dfd3;
            margin-bottom: 32px;
        }
        .header h1 {
            font-size: 28px;
            font-weight: 700;
            color: #2d6a4f;
            margin-bottom: 6px;
        }
        .header .subtitle {
            font-size: 16px;
            color: #6b7280;
        }
        .console-link {
            display: inline-block;
            margin-top: 14px;
            padding: 8px 24px;
            background: #2d6a4f;
            color: #fff;
            text-decoration: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.2s;
        }
        .console-link:hover { background: #1b5e3a; }

        /* Progress bar */
        .progress-wrap {
            position: sticky;
            top: 0;
            z-index: 100;
            background: #faf9f7;
            padding: 12px 0 8px;
            margin-bottom: 24px;
        }
        .progress-bar-bg {
            background: #e8dfd3;
            border-radius: 8px;
            height: 14px;
            overflow: hidden;
        }
        .progress-bar-fill {
            background: linear-gradient(90deg, #2d6a4f, #52b788);
            height: 100%;
            border-radius: 8px;
            transition: width 0.4s ease;
            width: 0%;
        }
        .progress-text {
            text-align: center;
            font-size: 14px;
            color: #6b7280;
            margin-top: 6px;
        }
        .progress-text strong { color: #2d6a4f; }

        /* Flow sections */
        .flow-section {
            margin-bottom: 36px;
        }
        .flow-title {
            font-size: 20px;
            font-weight: 700;
            color: #2d6a4f;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #c8e6c9;
        }

        /* Test card */
        .test-card {
            background: #fff;
            border-radius: 12px;
            padding: 20px 24px;
            margin-bottom: 14px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            transition: box-shadow 0.2s;
        }
        .test-card.checked {
            background: #f0fdf4;
            border-left: 4px solid #2d6a4f;
        }
        .test-header {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            cursor: pointer;
        }
        .test-checkbox {
            width: 22px;
            height: 22px;
            accent-color: #2d6a4f;
            flex-shrink: 0;
            margin-top: 2px;
            cursor: pointer;
        }
        .test-name {
            font-size: 16px;
            font-weight: 600;
            color: #3d3833;
        }
        .test-card.checked .test-name {
            text-decoration: line-through;
            color: #888;
        }
        .test-body { margin-top: 12px; padding-left: 34px; }

        .step-label {
            font-size: 13px;
            font-weight: 700;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        .step-text {
            font-size: 14px;
            color: #555;
            margin-bottom: 12px;
        }
        .step-text ol {
            padding-left: 20px;
        }
        .step-text li {
            margin-bottom: 4px;
        }
        .expected {
            background: #f9f5ed;
            border-left: 3px solid #e0d6c2;
            padding: 8px 14px;
            border-radius: 0 8px 8px 0;
            font-size: 14px;
            color: #5a4a3a;
        }

        /* Celebration */
        .celebration {
            display: none;
            text-align: center;
            padding: 40px 20px;
            margin-top: 20px;
            background: linear-gradient(135deg, #d4edda, #e8f5e9);
            border-radius: 16px;
        }
        .celebration.show { display: block; }
        .celebration h2 {
            font-size: 28px;
            color: #2d6a4f;
            margin-bottom: 8px;
        }
        .celebration p {
            font-size: 16px;
            color: #555;
        }

        /* Reset button */
        .reset-btn {
            display: block;
            margin: 32px auto 0;
            padding: 10px 28px;
            background: none;
            border: 2px solid #ccc;
            border-radius: 8px;
            color: #888;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .reset-btn:hover { border-color: #e65100; color: #e65100; }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 48px;
            padding-top: 20px;
            border-top: 2px solid #e8dfd3;
            color: #aaa;
            font-size: 13px;
        }

        /* Mobile */
        @media (max-width: 640px) {
            .page { padding: 16px 12px 40px; }
            .header h1 { font-size: 22px; }
            .test-body { padding-left: 0; }
        }
    </style>
</head>
<body>
<div class="page">

    <!-- Header -->
    <div class="header">
        <h1>島嶼家長 — QA 驗收測試</h1>
        <div class="subtitle">請依序完成以下測試項目，逐一勾選確認</div>
        <a class="console-link" href="/console" target="_blank">開啟 API Console 測試工具</a>
    </div>

    <!-- Progress -->
    <div class="progress-wrap">
        <div class="progress-bar-bg">
            <div class="progress-bar-fill" id="progressFill"></div>
        </div>
        <div class="progress-text">
            已完成 <strong><span id="doneCount">0</span> / <span id="totalCount">0</span></strong> 項測試
        </div>
    </div>

    <!-- Flow 1: 帳號系統 -->
    <div class="flow-section">
        <div class="flow-title">Flow 1：帳號系統</div>

        <div class="test-card" data-test="1-1">
            <div class="test-header" onclick="toggleCheck(this)">
                <input type="checkbox" class="test-checkbox">
                <div class="test-name">1-1. 註冊新帳號</div>
            </div>
            <div class="test-body">
                <div class="step-label">步驟</div>
                <div class="step-text">
                    <ol>
                        <li>開啟 API Console</li>
                        <li>選擇 tenant: <strong>island_parents</strong></li>
                        <li>輸入 email 和密碼（密碼至少 8 碼，含字母+數字）</li>
                        <li>點擊 Register</li>
                    </ol>
                </div>
                <div class="step-label">預期結果</div>
                <div class="expected">收到 201 回應，並收到驗證 email</div>
            </div>
        </div>

        <div class="test-card" data-test="1-2">
            <div class="test-header" onclick="toggleCheck(this)">
                <input type="checkbox" class="test-checkbox">
                <div class="test-name">1-2. Email 驗證</div>
            </div>
            <div class="test-body">
                <div class="step-label">步驟</div>
                <div class="step-text">
                    <ol>
                        <li>前往信箱，找到驗證信</li>
                        <li>點擊 email 中的驗證連結</li>
                    </ol>
                </div>
                <div class="step-label">預期結果</div>
                <div class="expected">瀏覽器顯示「驗證成功」頁面</div>
            </div>
        </div>

        <div class="test-card" data-test="1-3">
            <div class="test-header" onclick="toggleCheck(this)">
                <input type="checkbox" class="test-checkbox">
                <div class="test-name">1-3. 登入</div>
            </div>
            <div class="test-body">
                <div class="step-label">步驟</div>
                <div class="step-text">
                    <ol>
                        <li>在 Console 使用剛註冊的帳號登入</li>
                        <li>點擊 Login</li>
                    </ol>
                </div>
                <div class="step-label">預期結果</div>
                <div class="expected">收到 token 和 user 資訊（包含 counselor_id）</div>
            </div>
        </div>

        <div class="test-card" data-test="1-4">
            <div class="test-header" onclick="toggleCheck(this)">
                <input type="checkbox" class="test-checkbox">
                <div class="test-name">1-4. 密碼重設</div>
            </div>
            <div class="test-body">
                <div class="step-label">步驟</div>
                <div class="step-text">
                    <ol>
                        <li>點擊「忘記密碼」功能</li>
                        <li>輸入 email，送出請求</li>
                        <li>前往信箱收取 6 碼驗證碼</li>
                        <li>輸入驗證碼與新密碼，送出</li>
                    </ol>
                </div>
                <div class="step-label">預期結果</div>
                <div class="expected">密碼成功重設，可用新密碼登入</div>
            </div>
        </div>
    </div>

    <!-- Flow 2: 個案管理 -->
    <div class="flow-section">
        <div class="flow-title">Flow 2：個案管理</div>

        <div class="test-card" data-test="2-1">
            <div class="test-header" onclick="toggleCheck(this)">
                <input type="checkbox" class="test-checkbox">
                <div class="test-name">2-1. 建立個案 (Client)</div>
            </div>
            <div class="test-body">
                <div class="step-label">步驟</div>
                <div class="step-text">
                    <ol>
                        <li>確認已登入</li>
                        <li>執行 Create Client</li>
                        <li>填寫個案基本資料（姓名等）</li>
                    </ol>
                </div>
                <div class="step-label">預期結果</div>
                <div class="expected">成功建立，回應中包含個案 ID (client_id)</div>
            </div>
        </div>

        <div class="test-card" data-test="2-2">
            <div class="test-header" onclick="toggleCheck(this)">
                <input type="checkbox" class="test-checkbox">
                <div class="test-name">2-2. 建立案件 (Case)</div>
            </div>
            <div class="test-body">
                <div class="step-label">步驟</div>
                <div class="step-text">
                    <ol>
                        <li>使用剛建立的 client_id</li>
                        <li>執行 Create Case</li>
                    </ol>
                </div>
                <div class="step-label">預期結果</div>
                <div class="expected">成功建立案件，回應中包含 case_id</div>
            </div>
        </div>

        <div class="test-card" data-test="2-3">
            <div class="test-header" onclick="toggleCheck(this)">
                <input type="checkbox" class="test-checkbox">
                <div class="test-name">2-3. 查看個案列表</div>
            </div>
            <div class="test-body">
                <div class="step-label">步驟</div>
                <div class="step-text">
                    <ol>
                        <li>執行 List Clients</li>
                    </ol>
                </div>
                <div class="step-label">預期結果</div>
                <div class="expected">看到剛建立的個案出現在列表中</div>
            </div>
        </div>
    </div>

    <!-- Flow 3: 諮詢紀錄 -->
    <div class="flow-section">
        <div class="flow-title">Flow 3：諮詢紀錄</div>

        <div class="test-card" data-test="3-1">
            <div class="test-header" onclick="toggleCheck(this)">
                <input type="checkbox" class="test-checkbox">
                <div class="test-name">3-1. 建立諮詢紀錄 (Session)</div>
            </div>
            <div class="test-body">
                <div class="step-label">步驟</div>
                <div class="step-text">
                    <ol>
                        <li>執行 Create Session</li>
                        <li>選擇對應的 Case ID</li>
                    </ol>
                </div>
                <div class="step-label">預期結果</div>
                <div class="expected">成功建立 Session，回應中包含 session_id</div>
            </div>
        </div>

        <div class="test-card" data-test="3-2">
            <div class="test-header" onclick="toggleCheck(this)">
                <input type="checkbox" class="test-checkbox">
                <div class="test-name">3-2. 新增錄音片段</div>
            </div>
            <div class="test-body">
                <div class="step-label">步驟</div>
                <div class="step-text">
                    <ol>
                        <li>執行 Append Recording</li>
                        <li>輸入一段模擬逐字稿（例如：「孩子今天在學校和同學吵架了，回家之後一直哭...」）</li>
                    </ol>
                </div>
                <div class="step-label">預期結果</div>
                <div class="expected">成功新增錄音片段</div>
            </div>
        </div>

        <div class="test-card" data-test="3-3">
            <div class="test-header" onclick="toggleCheck(this)">
                <input type="checkbox" class="test-checkbox">
                <div class="test-name">3-3. 即時快速分析 (Quick Feedback)</div>
            </div>
            <div class="test-body">
                <div class="step-label">步驟</div>
                <div class="step-text">
                    <ol>
                        <li>對剛建立的 Session 執行 Analyze Partial</li>
                    </ol>
                </div>
                <div class="step-label">預期結果</div>
                <div class="expected">收到 AI 回應，包含：安全等級（綠/黃/紅）、即時建議、情緒摘要</div>
            </div>
        </div>

        <div class="test-card" data-test="3-4">
            <div class="test-header" onclick="toggleCheck(this)">
                <input type="checkbox" class="test-checkbox">
                <div class="test-name">3-4. 深度分析 (Deep Analyze)</div>
            </div>
            <div class="test-body">
                <div class="step-label">步驟</div>
                <div class="step-text">
                    <ol>
                        <li>對同一個 Session 執行 Deep Analyze</li>
                    </ol>
                </div>
                <div class="step-label">預期結果</div>
                <div class="expected">收到詳細分析報告，包含：親職教養理論標籤、具體建議、RAG 知識來源引用</div>
            </div>
        </div>
    </div>

    <!-- Flow 4: 報告生成 -->
    <div class="flow-section">
        <div class="flow-title">Flow 4：報告生成</div>

        <div class="test-card" data-test="4-1">
            <div class="test-header" onclick="toggleCheck(this)">
                <input type="checkbox" class="test-checkbox">
                <div class="test-name">4-1. 生成諮詢報告</div>
            </div>
            <div class="test-body">
                <div class="step-label">步驟</div>
                <div class="step-text">
                    <ol>
                        <li>對已有分析結果的 Session 執行 Generate Report</li>
                    </ol>
                </div>
                <div class="step-label">預期結果</div>
                <div class="expected">成功產生完整諮詢報告</div>
            </div>
        </div>

        <div class="test-card" data-test="4-2">
            <div class="test-header" onclick="toggleCheck(this)">
                <input type="checkbox" class="test-checkbox">
                <div class="test-name">4-2. 查看報告內容</div>
            </div>
            <div class="test-body">
                <div class="step-label">步驟</div>
                <div class="step-text">
                    <ol>
                        <li>執行 Get Report</li>
                    </ol>
                </div>
                <div class="step-label">預期結果</div>
                <div class="expected">看到完整的報告文字內容，包含諮詢摘要、分析結論、建議事項</div>
            </div>
        </div>
    </div>

    <!-- Flow 5: 計費系統 -->
    <div class="flow-section">
        <div class="flow-title">Flow 5：計費系統</div>

        <div class="test-card" data-test="5-1">
            <div class="test-header" onclick="toggleCheck(this)">
                <input type="checkbox" class="test-checkbox">
                <div class="test-name">5-1. 查詢使用量</div>
            </div>
            <div class="test-body">
                <div class="step-label">步驟</div>
                <div class="step-text">
                    <ol>
                        <li>執行 Usage Stats API</li>
                    </ol>
                </div>
                <div class="step-label">預期結果</div>
                <div class="expected">看到月度使用量、已使用分鐘數、剩餘額度</div>
            </div>
        </div>

        <div class="test-card" data-test="5-2">
            <div class="test-header" onclick="toggleCheck(this)">
                <input type="checkbox" class="test-checkbox">
                <div class="test-name">5-2. Apple Review 帳號測試</div>
            </div>
            <div class="test-body">
                <div class="step-label">步驟</div>
                <div class="step-text">
                    <ol>
                        <li>登出目前帳號</li>
                        <li>使用 Apple Review 帳號登入：<br><strong>Email:</strong> apple_review@islandparents.app<br><strong>Password:</strong> Island2026</li>
                        <li>嘗試執行任一功能（如 List Clients）</li>
                    </ol>
                </div>
                <div class="step-label">預期結果</div>
                <div class="expected">成功登入，可正常執行所有功能</div>
            </div>
        </div>
    </div>

    <!-- Celebration -->
    <div class="celebration" id="celebration">
        <h2>全部通過！</h2>
        <p>所有測試項目均已完成驗收，感謝您的耐心測試。</p>
    </div>

    <!-- Reset -->
    <button class="reset-btn" onclick="resetAll()">重設所有測試進度</button>

    <!-- Footer -->
    <div class="footer">
        <p>島嶼家長 QA 驗收測試表 | 2026-02-07</p>
        <p style="margin-top:4px;">
            <a href="/closure-report" style="color:#2d6a4f;text-decoration:none;">查看結案報告</a>
        </p>
    </div>

</div>

<script>
(function() {
    var STORAGE_KEY = 'ip_qa_checks';
    var cards = document.querySelectorAll('.test-card');
    var totalEl = document.getElementById('totalCount');
    var doneEl = document.getElementById('doneCount');
    var fillEl = document.getElementById('progressFill');
    var celebEl = document.getElementById('celebration');
    var total = cards.length;
    totalEl.textContent = total;

    // Load state
    var saved = {};
    try { saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}'); } catch(e) {}

    cards.forEach(function(card) {
        var key = card.getAttribute('data-test');
        var cb = card.querySelector('.test-checkbox');
        if (saved[key]) {
            cb.checked = true;
            card.classList.add('checked');
        }
    });
    updateProgress();

    window.toggleCheck = function(header) {
        var card = header.closest('.test-card');
        var cb = card.querySelector('.test-checkbox');
        cb.checked = !cb.checked;
        card.classList.toggle('checked', cb.checked);
        saveState();
        updateProgress();
    };

    function saveState() {
        var state = {};
        cards.forEach(function(card) {
            var key = card.getAttribute('data-test');
            if (card.querySelector('.test-checkbox').checked) {
                state[key] = true;
            }
        });
        try { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } catch(e) {}
    }

    function updateProgress() {
        var done = document.querySelectorAll('.test-checkbox:checked').length;
        doneEl.textContent = done;
        var pct = total > 0 ? Math.round((done / total) * 100) : 0;
        fillEl.style.width = pct + '%';
        celebEl.classList.toggle('show', done === total && total > 0);
    }

    window.resetAll = function() {
        if (!confirm('確定要重設所有測試進度嗎？')) return;
        cards.forEach(function(card) {
            card.querySelector('.test-checkbox').checked = false;
            card.classList.remove('checked');
        });
        try { localStorage.removeItem(STORAGE_KEY); } catch(e) {}
        updateProgress();
    };
})();
</script>
</body>
</html>