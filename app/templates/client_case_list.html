<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂÄãÊ°àÂàóË°® - iOS App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            background: #f5f5f7;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* iPhone Frame */
        .iphone-frame {
            width: 390px;
            height: 844px;
            background: #000;
            border-radius: 50px;
            padding: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        /* Notch */
        .notch {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 30px;
            background: #000;
            border-radius: 0 0 20px 20px;
            z-index: 10;
        }

        /* Screen */
        .screen {
            width: 100%;
            height: 100%;
            background: #fff;
            border-radius: 40px;
            overflow: hidden;
            position: relative;
        }

        /* Status Bar */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            height: 44px;
            background: #fff;
            font-size: 15px;
            font-weight: 600;
        }

        .status-bar .time {
            margin-left: 60px;
        }

        .status-bar .icons {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        /* Navigation Bar */
        .nav-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: #fff;
            border-bottom: 1px solid #e5e5e7;
        }

        .nav-bar .back-btn {
            font-size: 17px;
            color: #007aff;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .nav-bar .title {
            font-size: 17px;
            font-weight: 600;
            flex: 1;
            text-align: center;
        }

        .nav-bar .add-btn {
            width: 36px;
            height: 36px;
            background: #5ac8fa;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-bar .add-btn:hover {
            background: #2ab7f3;
            transform: scale(1.05);
        }

        /* Content Area */
        .content {
            height: calc(100% - 44px - 60px - 50px);
            overflow-y: auto;
            padding: 12px 16px;
            background: #f9f9f9;
        }

        /* Case Card */
        .case-card {
            background: #fff;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            transition: all 0.2s;
            position: relative;
        }

        .case-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }

        .case-card .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .case-card .client-name {
            font-size: 18px;
            font-weight: 600;
            color: #1d1d1f;
        }

        .case-card .more-btn {
            color: #86868b;
            font-size: 20px;
            cursor: pointer;
        }

        .case-card .info-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 14px;
            color: #6e6e73;
        }

        .case-card .info-row svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        .case-card .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin-top: 8px;
        }

        .status-badge.completed {
            background: #d1f4e0;
            color: #0d894f;
        }

        .status-badge.not-started {
            background: #e0f0ff;
            color: #0071e3;
        }

        .status-badge.in-progress {
            background: #fff4e6;
            color: #f5a623;
        }

        /* Tab Bar */
        .tab-bar {
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 50px;
            background: #f9f9f9;
            border-top: 1px solid #e5e5e7;
        }

        .tab-bar .tab {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            cursor: pointer;
            color: #86868b;
            transition: color 0.2s;
        }

        .tab-bar .tab.active {
            color: #5ac8fa;
        }

        .tab-bar .tab svg {
            width: 24px;
            height: 24px;
        }

        .tab-bar .tab span {
            font-size: 10px;
            font-weight: 500;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #86868b;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #86868b;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 16px;
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <div class="iphone-frame">
        <div class="notch"></div>
        <div class="screen">
            <!-- Status Bar -->
            <div class="status-bar">
                <span class="time">9:41</span>
                <div class="icons">
                    <span>‚ö°Ô∏è</span>
                    <span>üì∂</span>
                    <span>üîã</span>
                </div>
            </div>

            <!-- Navigation Bar -->
            <div class="nav-bar">
                <div class="back-btn" onclick="goBack()">‚Äπ</div>
                <div class="title">ÂÄãÊ°àÂàóË°®</div>
                <div class="add-btn" onclick="addNewCase()">+</div>
            </div>

            <!-- Content -->
            <div class="content" id="caseList">
                <div class="loading">ËºâÂÖ•‰∏≠...</div>
            </div>

            <!-- Tab Bar -->
            <div class="tab-bar">
                <div class="tab active">
                    <svg fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 6.5C14.76 6.5 17 8.74 17 11.5C17 12.54 16.65 13.5 16.08 14.29L20.79 19L19 20.79L14.29 16.08C13.5 16.65 12.54 17 11.5 17C8.74 17 6.5 14.76 6.5 12C6.5 9.24 8.74 7 11.5 7M11.5 9C9.85 9 8.5 10.35 8.5 12C8.5 13.65 9.85 15 11.5 15C13.15 15 14.5 13.65 14.5 12C14.5 10.35 13.15 9 11.5 9Z"/>
                    </svg>
                    <span>ÂÆ¢Êà∂ÁÆ°ÁêÜ</span>
                </div>
                <div class="tab">
                    <svg fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M11,6H13V13H11V6M11,15H13V17H11V15Z"/>
                    </svg>
                    <span>Ë®≠ÂÆö</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE_URL = window.location.origin;
        const API_ENDPOINT = '/api/v1/ui/client-case-list';

        // Get token from localStorage (you'll need to implement login first)
        let authToken = localStorage.getItem('auth_token') || '';

        // Status mapping
        const statusMap = {
            'active': { label: 'ÈÄ≤Ë°å‰∏≠', class: 'in-progress' },
            'completed': { label: 'Â∑≤ÂÆåÊàê', class: 'completed' },
            'suspended': { label: 'Êú™ÈñãÂßã', class: 'not-started' },
            'referred': { label: 'Â∑≤ËΩâ‰ªã', class: 'not-started' }
        };

        // Load cases on page load
        async function loadCases() {
            const container = document.getElementById('caseList');

            try {
                // Show loading
                container.innerHTML = '<div class="loading">ËºâÂÖ•‰∏≠...</div>';

                const response = await fetch(`${API_BASE_URL}${API_ENDPOINT}?skip=0&limit=100`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();

                if (data.items && data.items.length > 0) {
                    renderCases(data.items);
                } else {
                    showEmptyState();
                }
            } catch (error) {
                console.error('ËºâÂÖ•Â§±Êïó:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 48px; margin-bottom: 16px;">‚ö†Ô∏è</div>
                        <div>ËºâÂÖ•Â§±Êïó</div>
                        <div style="font-size: 12px; margin-top: 8px; color: #ef4444;">${error.message}</div>
                        <div style="margin-top: 16px;">
                            <button onclick="loadCases()" style="padding: 8px 24px; background: #007aff; color: #fff; border: none; border-radius: 8px; cursor: pointer;">ÈáçË©¶</button>
                        </div>
                    </div>
                `;
            }
        }

        function renderCases(cases) {
            const container = document.getElementById('caseList');

            const html = cases.map(caseItem => {
                const status = statusMap[caseItem.case_status] || { label: caseItem.case_status_label, class: 'not-started' };

                return `
                    <div class="case-card" onclick="viewCase('${caseItem.case_id}')">
                        <div class="header">
                            <div class="client-name">${caseItem.client_name}</div>
                            <div class="more-btn">‚ãØ</div>
                        </div>

                        <div class="info-row">
                            <svg fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"/>
                            </svg>
                            <span>${caseItem.client_email}</span>
                        </div>

                        <div class="info-row">
                            <svg fill="currentColor" viewBox="0 0 24 24">
                                <path d="M20,6C20.58,6 21.05,6.2 21.42,6.59C21.8,7 22,7.45 22,8V19C22,19.55 21.8,20 21.42,20.41C21.05,20.8 20.58,21 20,21H4C3.42,21 2.95,20.8 2.58,20.41C2.2,20 2,19.55 2,19V8C2,7.45 2.2,7 2.58,6.59C2.95,6.2 3.42,6 4,6H8V4C8,3.42 8.2,2.95 8.58,2.58C8.95,2.2 9.42,2 10,2H14C14.58,2 15.05,2.2 15.42,2.58C15.8,2.95 16,3.42 16,4V6H20M4,8V19H20V8H4M10,4V6H14V4H10Z"/>
                            </svg>
                            <span>${caseItem.identity_option}</span>
                        </div>

                        <div class="info-row">
                            <svg fill="currentColor" viewBox="0 0 24 24">
                                <path d="M9,10H7V12H9V10M13,10H11V12H13V10M17,10H15V12H17V10M19,3H18V1H16V3H8V1H6V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M19,19H5V8H19V19Z"/>
                            </svg>
                            <span>ÊúÄÂæåË´ÆË©¢Ôºö${caseItem.last_session_date_display || 'Êú™ÈñãÂßã'}</span>
                        </div>

                        <div class="status-badge ${status.class}">${status.label}</div>
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
        }

        function showEmptyState() {
            const container = document.getElementById('caseList');
            container.innerHTML = `
                <div class="empty-state">
                    <svg fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
                    </svg>
                    <div>Â∞öÁÑ°ÂÄãÊ°à</div>
                    <div style="font-size: 12px; margin-top: 8px;">ÈªûÊìäÂè≥‰∏äËßí + Êñ∞Â¢ûÂÄãÊ°à</div>
                </div>
            `;
        }

        function viewCase(caseId) {
            console.log('View case:', caseId);
            // TODO: Navigate to case detail page
            alert(`Êü•ÁúãÂÄãÊ°àÔºö${caseId}`);
        }

        function goBack() {
            window.history.back();
        }

        function addNewCase() {
            alert('Êñ∞Â¢ûÂÄãÊ°àÂäüËÉΩÈñãÁôº‰∏≠...');
            // TODO: Navigate to add case page
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            // Check if we have a token
            if (!authToken) {
                // For demo purposes, prompt for token
                const token = prompt('Ë´ãËº∏ÂÖ• API Token (ÊàñÊåâÂèñÊ∂à‰ΩøÁî®Ê∏¨Ë©¶Ê®°Âºè):');
                if (token) {
                    authToken = token;
                    localStorage.setItem('auth_token', token);
                } else {
                    // Demo mode - show sample data
                    showDemoData();
                    return;
                }
            }

            loadCases();
        });

        function showDemoData() {
            const demoData = [
                {
                    client_name: 'ÈªÉÂÖàÁîü',
                    client_email: 'bb123@gmail.com',
                    identity_option: 'Âú®ËÅ∑‰∏≠',
                    case_status: 'completed',
                    case_status_label: 'Â∑≤ÂÆåÊàê',
                    last_session_date_display: '2026/01/22 19:30',
                    case_id: 'demo-1'
                },
                {
                    client_name: 'Èô≥ÂÆ∂ÂÆ∂',
                    client_email: 'bb123@gmail.com',
                    identity_option: 'Ê±ÇËÅ∑',
                    case_status: 'suspended',
                    case_status_label: 'Êú™ÈñãÂßã',
                    last_session_date_display: '2026/01/22 19:30',
                    case_id: 'demo-2'
                },
                {
                    client_name: 'Jennie Hsiao',
                    client_email: 'bb123@gmail.com',
                    identity_option: 'Ê±ÇËÅ∑‰∏≠',
                    case_status: 'active',
                    case_status_label: 'ÈÄ≤Ë°å‰∏≠',
                    last_session_date_display: '2026/01/22 19:30',
                    case_id: 'demo-3'
                }
            ];

            renderCases(demoData);
        }
    </script>
</body>
</html>
