# å¤šç§Ÿæˆ¶å¾Œç«¯æ¶æ§‹è¨­è¨ˆï¼ˆè·æ¸¸ + æµ®å³¶ï¼‰

## æ ¸å¿ƒéœ€æ±‚

### é—œéµåŸå‰‡
1. **åŒä¸€ä»½ Code**ï¼šè·æ¸¸å’Œæµ®å³¶ä½¿ç”¨ç›¸åŒçš„ç¨‹å¼ç¢¼åº«
2. **ç¨ç«‹éƒ¨ç½²**ï¼šå¯éƒ¨ç½²åˆ°ä¸åŒè³‡æ–™åº«ï¼ˆè·æ¸¸ DB / æµ®å³¶ DBï¼‰
3. **å½ˆæ€§é…ç½®**ï¼šé€éç’°å¢ƒè®Šæ•¸åˆ‡æ›ç§Ÿæˆ¶æ¨¡å¼
4. **æ¬Šé™éš”é›¢**ï¼šè·æ¸¸çœ‹å…¨éƒ¨ï¼Œæµ®å³¶åªçœ‹è‡ªå·±çš„è³‡æ–™

### æ¥­å‹™å®šä½
- **è·æ¸¸**ï¼šæ“æœ‰æ‰€æœ‰è³‡æ–™æ¬Šé™ï¼ˆåŒ…å«æµ®å³¶è³‡æ–™ï¼‰
- **æµ®å³¶**ï¼šåªèƒ½å­˜å–è‡ªå·±ç”¢ç”Ÿçš„è³‡æ–™ï¼ˆé¡ä¼¼ Power BI æ¦‚å¿µï¼‰
- **æµç¨‹èˆ‡é«”é©—**ï¼šå®Œå…¨ä¸€è‡´ï¼Œåƒ…éœ€æ›çš®ï¼ˆå‰ç«¯ï¼‰

---

## æ ¸å¿ƒè§’è‰²å®šç¾©

### é›™é‚Šæ¥­å‹™è§’è‰²å°ç…§

| è§’è‰² | è·æ¸¸ (Career Journey) | æµ®å³¶ (Floating Island) |
|------|----------------------|----------------------|
| **ä¸»è¦ä½¿ç”¨è€…** | è«®è©¢å¸« (Counselor) | è€å¸« (Teacher) |
| **æœå‹™å°è±¡** | å€‹æ¡ˆ (Client) | å­¸ç”Ÿ (Student) |
| **æ¥­å‹™å ´æ™¯** | è·æ¶¯è«®è©¢ã€å¿ƒç†è«®å•† | å‡å­¸è¼”å°ã€æ•™è‚²è«®è©¢ |

### çµ±ä¸€è¡“èªï¼ˆç¨‹å¼ç¢¼å±¤ç´šï¼‰

ç‚ºäº†ç¶­è­·åŒä¸€ä»½ codeï¼Œ**å¾Œç«¯çµ±ä¸€ä½¿ç”¨ `counselor` å’Œ `client`**

- è³‡æ–™åº« table åç¨±ï¼š`counselors`, `clients`
- API è·¯ç”±ï¼š`/api/v1/counselors`, `/api/v1/clients`
- å‰ç«¯é¡¯ç¤ºæ–‡æ¡ˆï¼šæ ¹æ“šé€£æ¥çš„ API domain è‡ªå‹•èª¿æ•´
  - è·æ¸¸ App â†’ `api.career-journey.com` â†’ é¡¯ç¤ºã€Œè«®è©¢å¸«ã€ã€ã€Œå€‹æ¡ˆã€
  - æµ®å³¶ App â†’ `api.floating-island.com` â†’ é¡¯ç¤ºã€Œè€å¸«ã€ã€ã€Œå­¸ç”Ÿã€

---

## éƒ¨ç½²æ¶æ§‹ç¸½è¦½è¡¨

### å®Œæ•´æ¶æ§‹å°ç…§è¡¨

| å±¤ç´š | è·æ¸¸ | æµ®å³¶ | æ˜¯å¦å…±ç”¨ | èªªæ˜ |
|------|------|------|----------|------|
| **Source Code (Git Repo)** | `career_ios_backend` | `career_ios_backend` | ğŸŸ¢ å…±ç”¨ | åŒä¸€ä»½ç¨‹å¼ç¢¼ |
| **CI/CD (GitHub Actions)** | åŒä¸€å€‹ workflow | åŒä¸€å€‹ workflow | ğŸŸ¢ å…±ç”¨ | åŒæ™‚éƒ¨ç½²å…©é‚Š |
| **Docker Image** | åŒä¸€å€‹ Dockerfile | åŒä¸€å€‹ Dockerfile | ğŸŸ¢ å…±ç”¨ | åŒä¸€å€‹æ˜ åƒæª” |
| **Cloud Run å¯¦ä¾‹ (æ©Ÿå™¨)** | `career-journey-api` | `floating-island-api` | ğŸŸ£ åˆ†é–‹ | ç¨ç«‹éƒ¨ç½²ï¼Œç’°å¢ƒè®Šæ•¸ä¸åŒ |
| **API Domain** | `api.career-journey.com` | `api.floating-island.com` | ğŸŸ£ åˆ†é–‹ | ä¸åŒç¶²åŸŸï¼Œå®‰å…¨éš”é›¢ |
| **è³‡æ–™åº«å¯¦ä¾‹** | è·æ¸¸ Supabase | æµ®å³¶ Supabase | ğŸŸ£ åˆ†é–‹ | å®Œå…¨ç¨ç«‹è³‡æ–™åº« |
| **è³‡æ–™åº« Schema** | åŒä¸€å¥— SQL schema | åŒä¸€å¥— SQL schema | ğŸŸ¢ å…±ç”¨ | çµæ§‹ç›¸åŒ |
| **ç’°å¢ƒè®Šæ•¸** | `TENANT_ID=career_journey` | `TENANT_ID=floating_island` | ğŸŸ£ åˆ†é–‹ | ä¸åŒé…ç½® |
| **Supabase Storage** | è·æ¸¸ bucket | æµ®å³¶ bucket | ğŸŸ£ åˆ†é–‹ | æª”æ¡ˆéš”é›¢ |
| **Monitoring Logs** | è·æ¸¸ logs | æµ®å³¶ logs | ğŸŸ£ åˆ†é–‹ | ç¨ç«‹è¿½è¹¤ |
| **iOS App** | è·æ¸¸ App | æµ®å³¶ App | ğŸŸ£ åˆ†é–‹ | ä¸åŒ Bundle IDï¼Œä¸åŒæ–‡æ¡ˆ |

---

## å®Œæ•´æ¶æ§‹åœ–ï¼ˆå« Source Code, CI/CD, æ©Ÿå™¨ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Source Code (GitHub Repository)                       â”‚
â”‚                      career_ios_backend/                                 â”‚
â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ app/                    (FastAPI ç¨‹å¼ç¢¼)                             â”‚
â”‚  â”œâ”€â”€ Dockerfile              (å®¹å™¨å®šç¾©)                                   â”‚
â”‚  â”œâ”€â”€ requirements.txt        (ä¾è³´å¥—ä»¶)                                   â”‚
â”‚  â”œâ”€â”€ .env.career_journey     (è·æ¸¸ç’°å¢ƒè®Šæ•¸ç¯„æœ¬)                           â”‚
â”‚  â”œâ”€â”€ .env.floating_island    (æµ®å³¶ç’°å¢ƒè®Šæ•¸ç¯„æœ¬)                           â”‚
â”‚  â””â”€â”€ .github/workflows/      (CI/CD è¨­å®š)                                â”‚
â”‚      â””â”€â”€ deploy.yml          (éƒ¨ç½²å…©é‚Šçš„ workflow)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ Git Push (è§¸ç™¼éƒ¨ç½²)
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        GitHub Actions (CI/CD)                            â”‚
â”‚                                                                          â”‚
â”‚  Jobs:                                                                   â”‚
â”‚    1. Build Docker Image (åŒä¸€å€‹)                                        â”‚
â”‚    2. Deploy to Career Journey Cloud Run                                â”‚
â”‚    3. Deploy to Floating Island Cloud Run                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                               â”‚
                    â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     è·æ¸¸éƒ¨ç½²å¯¦ä¾‹ (æ©Ÿå™¨)           â”‚  â”‚     æµ®å³¶éƒ¨ç½²å¯¦ä¾‹ (æ©Ÿå™¨)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚  â”‚                                 â”‚
â”‚ â˜ï¸  GCP Cloud Run               â”‚  â”‚ â˜ï¸  GCP Cloud Run               â”‚
â”‚    Service: career-journey-api  â”‚  â”‚    Service: floating-island-api â”‚
â”‚    Region: asia-east1           â”‚  â”‚    Region: asia-east1           â”‚
â”‚    Container: åŒä¸€å€‹ Docker Imageâ”‚  â”‚    Container: åŒä¸€å€‹ Docker Imageâ”‚
â”‚                                 â”‚  â”‚                                 â”‚
â”‚    ç’°å¢ƒè®Šæ•¸:                     â”‚  â”‚    ç’°å¢ƒè®Šæ•¸:                     â”‚
â”‚      TENANT_ID=career_journey   â”‚  â”‚      TENANT_ID=floating_island  â”‚
â”‚      DATABASE_URL=è·æ¸¸ DB URL   â”‚  â”‚      DATABASE_URL=æµ®å³¶ DB URL   â”‚
â”‚                                 â”‚  â”‚                                 â”‚
â”‚    Domain å°æ‡‰:                  â”‚  â”‚    Domain å°æ‡‰:                  â”‚
â”‚      api.career-journey.com     â”‚  â”‚      api.floating-island.com    â”‚
â”‚           â”‚                     â”‚  â”‚           â”‚                     â”‚
â”‚           â–¼                     â”‚  â”‚           â–¼                     â”‚
â”‚ ğŸ—„ï¸  Supabase Database           â”‚  â”‚ ğŸ—„ï¸  Supabase Database           â”‚
â”‚    Project: career-journey-db   â”‚  â”‚    Project: floating-island-db  â”‚
â”‚    Region: ap-northeast-1       â”‚  â”‚    Region: ap-northeast-1       â”‚
â”‚                                 â”‚  â”‚                                 â”‚
â”‚    Tables (åŒä¸€å¥— Schema):      â”‚  â”‚    Tables (åŒä¸€å¥— Schema):      â”‚
â”‚      - counselors (è«®è©¢å¸«)      â”‚  â”‚      - counselors (è€å¸«)        â”‚
â”‚      - clients (å€‹æ¡ˆï¼Œæ‰€æœ‰)     â”‚  â”‚      - clients (å­¸ç”Ÿï¼Œæµ®å³¶çš„)   â”‚
â”‚      - counseling_sessions      â”‚  â”‚      - counseling_sessions      â”‚
â”‚      - case_reports             â”‚  â”‚      - case_reports             â”‚
â”‚                                 â”‚  â”‚                                 â”‚
â”‚    æ¬Šé™ (RLS):                   â”‚  â”‚    æ¬Šé™ (RLS):                   â”‚
â”‚      - å¯çœ‹åˆ°æ‰€æœ‰è³‡æ–™            â”‚  â”‚      - åªèƒ½çœ‹åˆ°æµ®å³¶å»ºç«‹çš„è³‡æ–™    â”‚
â”‚                                 â”‚  â”‚                                 â”‚
â”‚           â”‚                     â”‚  â”‚           â”‚                     â”‚
â”‚           â–¼                     â”‚  â”‚           â–¼                     â”‚
â”‚ ğŸ“¦ Supabase Storage             â”‚  â”‚ ğŸ“¦ Supabase Storage             â”‚
â”‚    Bucket: career-journey-audio â”‚  â”‚    Bucket: floating-island-audioâ”‚
â”‚                                 â”‚  â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–²                                      â–²
           â”‚                                      â”‚
           â”‚                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“± è·æ¸¸ iOS App      â”‚              â”‚ ğŸ“± æµ®å³¶ iOS App      â”‚
â”‚  Bundle: com.career â”‚              â”‚  Bundle: com.float  â”‚
â”‚  æ–‡æ¡ˆ: è«®è©¢å¸«ã€å€‹æ¡ˆ  â”‚              â”‚  æ–‡æ¡ˆ: è€å¸«ã€å­¸ç”Ÿ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Source Code â†’ CI/CD â†’ æ©Ÿå™¨ æµç¨‹èªªæ˜

### 1. Source Code (Git Repository)

**ä½ç½®**: GitHub `career_ios_backend`

**å…§å®¹**:
- FastAPI æ‡‰ç”¨ç¨‹å¼
- çµ±ä¸€çš„è³‡æ–™åº« Schema (SQL)
- Dockerfile (å®¹å™¨å®šç¾©)
- CI/CD workflow (`.github/workflows/deploy.yml`)

**ç‰¹é»**:
- âœ… åªæœ‰ä¸€ä»½ç¨‹å¼ç¢¼
- âœ… åŒæ™‚æœå‹™è·æ¸¸å’Œæµ®å³¶

---

### 2. CI/CD Pipeline (GitHub Actions)

**è§¸ç™¼æ™‚æ©Ÿ**: `git push` åˆ° `main` æˆ– `staging` branch

**åŸ·è¡Œæµç¨‹**:

```
Step 1: Build Docker Image
  â””â”€ ä½¿ç”¨ Dockerfile å»ºç«‹å®¹å™¨æ˜ åƒæª”
  â””â”€ åŒä¸€å€‹ Image ç”¨æ–¼å…©é‚Šéƒ¨ç½²

Step 2: Deploy to Career Journey
  â””â”€ gcloud run deploy career-journey-api
  â””â”€ è¨­å®šç’°å¢ƒè®Šæ•¸: TENANT_ID=career_journey
  â””â”€ è¨­å®šç’°å¢ƒè®Šæ•¸: DATABASE_URL=è·æ¸¸ Supabase

Step 3: Deploy to Floating Island
  â””â”€ gcloud run deploy floating-island-api
  â””â”€ è¨­å®šç’°å¢ƒè®Šæ•¸: TENANT_ID=floating_island
  â””â”€ è¨­å®šç’°å¢ƒè®Šæ•¸: DATABASE_URL=æµ®å³¶ Supabase
```

**çµæœ**:
- âœ… ä¸€æ¬¡ push â†’ åŒæ™‚éƒ¨ç½²å…©å€‹ Cloud Run å¯¦ä¾‹
- âœ… å®Œå…¨è‡ªå‹•åŒ–ï¼Œä¸éœ€æ‰‹å‹•æ“ä½œ

---

### 3. æ©Ÿå™¨ (Cloud Run Instances)

**è·æ¸¸æ©Ÿå™¨**:
- Service Name: `career-journey-api`
- Container: å¾ GitHub Actions éƒ¨ç½²çš„ Docker Image
- ç’°å¢ƒè®Šæ•¸: `TENANT_ID=career_journey`
- Domain: `api.career-journey.com`

**æµ®å³¶æ©Ÿå™¨**:
- Service Name: `floating-island-api`
- Container: å¾ GitHub Actions éƒ¨ç½²çš„ Docker Image (åŒä¸€å€‹)
- ç’°å¢ƒè®Šæ•¸: `TENANT_ID=floating_island`
- Domain: `api.floating-island.com`

**é—œéµå·®ç•°**:
- ä¸åŒçš„ **ç’°å¢ƒè®Šæ•¸** â†’ é€£åˆ°ä¸åŒè³‡æ–™åº«
- ä¸åŒçš„ **Domain** â†’ iOS App é€£ä¸åŒ URL

---

## è³‡æ–™åº«æ¶æ§‹

### çµ±ä¸€ Schema (å…©é‚Šçµæ§‹ç›¸åŒ)

**ä¸»è¦ Tables**:

```
counselors (è«®è©¢å¸« / è€å¸«)
â”œâ”€ id (UUID)
â”œâ”€ email
â”œâ”€ name
â”œâ”€ tenant_id (æ¨™è¨˜ç§Ÿæˆ¶)
â””â”€ metadata (JSONB å½ˆæ€§æ¬„ä½)

clients (å€‹æ¡ˆ / å­¸ç”Ÿ)
â”œâ”€ id (UUID)
â”œâ”€ counselor_id (å¤–éµ)
â”œâ”€ name
â”œâ”€ tenant_id
â”œâ”€ created_by_app (æ¨™è¨˜ä¾†æº)
â””â”€ background_info (JSONB)

counseling_sessions (è«®è©¢ / è¼”å°ç´€éŒ„)
â”œâ”€ id (UUID)
â”œâ”€ client_id (å¤–éµ)
â”œâ”€ counselor_id (å¤–éµ)
â”œâ”€ session_date
â”œâ”€ audio_file_url
â”œâ”€ transcript (é€å­—ç¨¿)
â”œâ”€ tenant_id
â””â”€ created_by_app

case_reports (å€‹æ¡ˆå ±å‘Š)
â”œâ”€ id (UUID)
â”œâ”€ session_id (å¤–éµ)
â”œâ”€ client_id (å¤–éµ)
â”œâ”€ report_content (JSONB)
â”œâ”€ report_pdf_url
â”œâ”€ tenant_id
â””â”€ created_by_app
```

### Row-Level Security (RLS) æ¬Šé™æ§åˆ¶

**è·æ¸¸ Supabase**:
- `tenant_id = 'career_journey'` â†’ å¯çœ‹åˆ°æ‰€æœ‰è³‡æ–™ï¼ˆåŒ…å«æµ®å³¶å»ºç«‹çš„ï¼‰

**æµ®å³¶ Supabase**:
- `tenant_id = 'floating_island'` â†’ åªèƒ½çœ‹åˆ° `created_by_app = 'floating_island'` çš„è³‡æ–™

**å¯¦ä½œæ–¹å¼**:
- PostgreSQL RLS Policy
- æ ¹æ“š `current_setting('app.tenant_id')` è‡ªå‹•éæ¿¾

---

## API è¨­è¨ˆ

### çµ±ä¸€è·¯ç”±çµæ§‹

| ç«¯é» | è·æ¸¸é¡¯ç¤ºæ–‡æ¡ˆ | æµ®å³¶é¡¯ç¤ºæ–‡æ¡ˆ | èªªæ˜ |
|------|------------|------------|------|
| `GET /api/v1/counselors` | è«®è©¢å¸«åˆ—è¡¨ | è€å¸«åˆ—è¡¨ | åŒä¸€å€‹ API |
| `POST /api/v1/counselors` | å»ºç«‹è«®è©¢å¸« | å»ºç«‹è€å¸« | åŒä¸€å€‹ API |
| `GET /api/v1/clients` | å€‹æ¡ˆåˆ—è¡¨ | å­¸ç”Ÿåˆ—è¡¨ | åŒä¸€å€‹ APIï¼ŒRLS è‡ªå‹•éæ¿¾ |
| `POST /api/v1/clients` | å»ºç«‹å€‹æ¡ˆ | å»ºç«‹å­¸ç”Ÿ | è‡ªå‹•æ¨™è¨˜ `created_by_app` |
| `POST /api/v1/sessions` | å»ºç«‹è«®è©¢ | å»ºç«‹è¼”å° | åŒä¸€å€‹ API |
| `POST /api/v1/sessions/{id}/complete` | å®Œæˆè«®è©¢ | å®Œæˆè¼”å° | ä¸Šå‚³éŒ„éŸ³ + æ¨™ç±¤ |
| `GET /api/v1/reports/{id}` | å–å¾—å€‹æ¡ˆå ±å‘Š | å–å¾—å­¸ç”Ÿå ±å‘Š | åŒä¸€å€‹ API |

### å‰ç«¯æ–‡æ¡ˆè™•ç†

iOS App æ ¹æ“šé€£æ¥çš„ API domain åˆ¤æ–·ç§Ÿæˆ¶ï¼Œé¡¯ç¤ºä¸åŒæ–‡æ¡ˆï¼š

**è·æ¸¸ App**:
- API Base URL: `https://api.career-journey.com`
- é¡¯ç¤º: è«®è©¢å¸«ã€å€‹æ¡ˆã€è«®è©¢

**æµ®å³¶ App**:
- API Base URL: `https://api.floating-island.com`
- é¡¯ç¤º: è€å¸«ã€å­¸ç”Ÿã€è¼”å°

---

## å…±ç”¨ vs åˆ†é–‹çš„æ±ºç­–é‚è¼¯

### ğŸŸ¢ å…±ç”¨çš„ï¼ˆæé«˜æ•ˆç‡ï¼‰

| é …ç›® | ç†ç”± |
|------|------|
| **Git Repository** | åŒä¸€ä»½ç¨‹å¼ç¢¼ï¼Œé¿å…é‡è¤‡é–‹ç™¼ |
| **CI/CD Pipeline** | ä¸€æ¬¡éƒ¨ç½²å…©é‚Šï¼Œè‡ªå‹•åŒ– |
| **Docker Image** | æ¸›å°‘æ§‹å»ºæ™‚é–“ï¼Œç¢ºä¿ä¸€è‡´æ€§ |
| **è³‡æ–™åº« Schema** | çµ±ä¸€çµæ§‹ï¼Œé™ä½ç¶­è­·æˆæœ¬ |
| **API è·¯ç”±çµæ§‹** | çµ±ä¸€ä»‹é¢ï¼Œå‰ç«¯å°æ¥ç°¡å–® |

### ğŸŸ£ åˆ†é–‹çš„ï¼ˆå®‰å…¨èˆ‡éš”é›¢ï¼‰

| é …ç›® | ç†ç”± |
|------|------|
| **Cloud Run å¯¦ä¾‹ (æ©Ÿå™¨)** | è³‡æºéš”é›¢ï¼Œç¨ç«‹æ“´å±•ï¼Œç¨ç«‹è¨ˆè²» |
| **API Domain** | å®‰å…¨éš”é›¢ï¼Œé˜²æ­¢è·¨ç§Ÿæˆ¶è«‹æ±‚ |
| **è³‡æ–™åº«å¯¦ä¾‹** | è³‡æ–™å®Œå…¨éš”é›¢ï¼Œç¬¦åˆéš±ç§è¦æ±‚ |
| **ç’°å¢ƒè®Šæ•¸** | ä¸åŒé…ç½®ï¼Œé€£åˆ°ä¸åŒè³‡æº |
| **Storage Bucket** | æª”æ¡ˆéš”é›¢ï¼Œé¿å…æ··æ·† |
| **Monitoring Logs** | ç¨ç«‹è¿½è¹¤ï¼Œæ–¹ä¾¿ debug |
| **iOS App** | ä¸åŒå®¢æˆ¶ï¼Œä¸åŒå“ç‰Œï¼Œä¸åŒæ–‡æ¡ˆ |

### ğŸŸ¡ é¸æ“‡æ€§å…±ç”¨

| é …ç›® | å…±ç”¨ | åˆ†é–‹ | å»ºè­° |
|------|------|------|------|
| **OpenAI API Key** | çœæˆæœ¬ | æˆæœ¬é€æ˜ | åˆæœŸå…±ç”¨ï¼Œæœªä¾†åˆ†é–‹ |
| **éŒ¯èª¤è¿½è¹¤ (Sentry)** | çµ±ä¸€ dashboard | ç¨ç«‹å°ˆæ¡ˆ | å…±ç”¨ï¼ˆç”¨ tag å€åˆ†ï¼‰ |

---

## éƒ¨ç½²æµç¨‹èªªæ˜

### ç’°å¢ƒè®Šæ•¸é…ç½®

**è·æ¸¸ Cloud Run**:
- `TENANT_ID=career_journey`
- `DATABASE_URL=postgresql://...@career-journey.supabase.co/...`
- `SUPABASE_URL=https://xxx.supabase.co`
- `STORAGE_BUCKET=career-journey-audio`

**æµ®å³¶ Cloud Run**:
- `TENANT_ID=floating_island`
- `DATABASE_URL=postgresql://...@floating-island.supabase.co/...`
- `SUPABASE_URL=https://yyy.supabase.co`
- `STORAGE_BUCKET=floating-island-audio`

### éƒ¨ç½²æ­¥é©Ÿ

1. é–‹ç™¼è€… `git push` åˆ° GitHub
2. GitHub Actions è‡ªå‹•è§¸ç™¼
3. Build åŒä¸€å€‹ Docker Image
4. éƒ¨ç½²åˆ°è·æ¸¸ Cloud Run (è¨­å®šè·æ¸¸ç’°å¢ƒè®Šæ•¸)
5. éƒ¨ç½²åˆ°æµ®å³¶ Cloud Run (è¨­å®šæµ®å³¶ç’°å¢ƒè®Šæ•¸)
6. å…©å€‹ Cloud Run å¯¦ä¾‹åŒæ™‚ä¸Šç·š

---

## æˆæœ¬ä¼°ç®—ï¼ˆæ¯æœˆï¼‰

| é …ç›® | è·æ¸¸ | æµ®å³¶ | å…±ç”¨çœä¸‹ | ç¸½è¨ˆ |
|------|------|------|---------|------|
| **Cloud Run (æ©Ÿå™¨)** | $5-20 | $5-20 | - | $10-40 |
| **Supabase (å…©å€‹å°ˆæ¡ˆå…±ç”¨å¸³è™Ÿ)** | - | - | **å…±ç”¨ Pro æ–¹æ¡ˆ** | **$25** |
| **Domain** | $1 | $1 | - | $2 |
| **OpenAI API** | $10-50 | - | å…±ç”¨ | $10-50 |
| **CI/CD (GitHub Actions)** | $0 | - | å…±ç”¨ | $0 |
| **Monitoring (Sentry)** | $0 | - | å…±ç”¨ | $0 |
| **ç¸½è¨ˆ** | - | - | **çœ $25** | **$47-117** |

### Supabase æ–¹æ¡ˆèªªæ˜

**å…±ç”¨åŒä¸€å€‹ Supabase å¸³è™Ÿï¼Œé–‹å…©å€‹å°ˆæ¡ˆ**ï¼š
- âœ… **Free Tier** (åˆæœŸ)ï¼š$0/æœˆï¼Œå¯é–‹ 2 å€‹å°ˆæ¡ˆ
  - æ¯å€‹å°ˆæ¡ˆï¼š500 MB è³‡æ–™åº« + 1 GB å„²å­˜ç©ºé–“
  - é©åˆ MVP æ¸¬è©¦éšæ®µ

- âœ… **Pro Plan** (æ­£å¼ç‡Ÿé‹)ï¼š$25/æœˆï¼Œç„¡é™å°ˆæ¡ˆæ•¸é‡
  - æ¯å€‹å°ˆæ¡ˆï¼š8 GB è³‡æ–™åº« + 100 GB å„²å­˜ç©ºé–“
  - è·æ¸¸å°ˆæ¡ˆ + æµ®å³¶å°ˆæ¡ˆå…±ç”¨åŒä¸€å€‹å¸³è™Ÿ

**æˆæœ¬å„ªåŒ–**ï¼š
- åŸæœ¬å…©å€‹ç¨ç«‹å¸³è™Ÿï¼š$25 + $25 = $50/æœˆ
- å…±ç”¨å¸³è™Ÿå…©å€‹å°ˆæ¡ˆï¼š$25/æœˆ
- **çœä¸‹ $25/æœˆ**

---

## ç›£æ§èˆ‡ç¶­è­·

### åˆ†é–‹ç›£æ§

| é …ç›® | è·æ¸¸ | æµ®å³¶ |
|------|------|------|
| **API å¥åº·æª¢æŸ¥** | `api.career-journey.com/health` | `api.floating-island.com/health` |
| **Cloud Run Logs** | filter: `career-journey-api` | filter: `floating-island-api` |
| **è³‡æ–™åº«ç›£æ§** | è·æ¸¸ Supabase Dashboard | æµ®å³¶ Supabase Dashboard |

### å…±ç”¨ç›£æ§

| é …ç›® | å·¥å…· |
|------|------|
| **CI/CD ç‹€æ…‹** | GitHub Actions Dashboard |
| **ç¨‹å¼ç¢¼å“è³ª** | SonarQube (åŒä¸€å€‹ repo) |
| **ä¾è³´å®‰å…¨æƒæ** | Dependabot (åŒä¸€å€‹ repo) |

---

## ç¸½çµ

### æ ¸å¿ƒæ¶æ§‹

```
Source Code (1 ä»½)
    â†“
CI/CD (1 å€‹ pipeline, éƒ¨ç½² 2 æ¬¡)
    â†“
   â”œâ”€â†’ è·æ¸¸ Cloud Run (æ©Ÿå™¨ 1)  â†’  è·æ¸¸ Supabase
   â””â”€â†’ æµ®å³¶ Cloud Run (æ©Ÿå™¨ 2)  â†’  æµ®å³¶ Supabase
```

### é—œéµå„ªå‹¢

1. **åŒä¸€ä»½ Code** â†’ é¿å…é‡è¤‡é–‹ç™¼ï¼Œbug ä¿®å¾©åŒæ­¥
2. **è‡ªå‹•éƒ¨ç½²** â†’ Git push â†’ è‡ªå‹•éƒ¨ç½²å…©é‚Š
3. **å®‰å…¨éš”é›¢** â†’ ä¸åŒ Domainã€ä¸åŒè³‡æ–™åº«
4. **æˆæœ¬å„ªåŒ–** â†’ å…±ç”¨ CI/CDã€Docker Imageã€OpenAI Key

### iOS é–‹ç™¼è€…è¦–è§’

- è·æ¸¸ App â†’ é€£ `api.career-journey.com` â†’ çœ‹åˆ°ã€Œè«®è©¢å¸«ã€ã€ã€Œå€‹æ¡ˆã€
- æµ®å³¶ App â†’ é€£ `api.floating-island.com` â†’ çœ‹åˆ°ã€Œè€å¸«ã€ã€ã€Œå­¸ç”Ÿã€
- **ä¸éœ€è¦å‚³ä»»ä½•ç§Ÿæˆ¶åƒæ•¸**ï¼Œå¾Œç«¯è‡ªå‹•æ ¹æ“š domain è­˜åˆ¥

### å¾Œç«¯é–‹ç™¼è€…è¦–è§’

- **ç¶­è­·ä¸€ä»½ç¨‹å¼ç¢¼**
- **ç¶­è­·ä¸€å¥— Schema**
- **Git push â†’ è‡ªå‹•éƒ¨ç½²å…©é‚Š**
- **ç’°å¢ƒè®Šæ•¸æ§åˆ¶è¡Œç‚º**

---

## å·²ç¢ºèªäº‹é …

1. **æ–‡æ¡ˆç´°ç¯€** âœ…
   - è·æ¸¸ï¼šã€Œè«®è©¢å¸«ã€ã€ã€Œå€‹æ¡ˆã€
   - æµ®å³¶ï¼šã€Œè€å¸«ã€ã€ã€Œå­¸ç”Ÿã€

2. **æ¥­å‹™æµç¨‹** âœ…
   - è«®è©¢æµç¨‹å®Œå…¨ä¸€æ¨£
   - **å ±å‘Šæ ¼å¼ä¸åŒ**ï¼ˆéœ€è¦ä¸åŒæ¨¡æ¿ï¼‰

---

## å ±å‘Šæ ¼å¼å·®ç•°è™•ç†

### ç­–ç•¥ï¼šå®Œå…¨å½ˆæ€§çš„ JSONB æ¶æ§‹

**å ±å‘Šæ ¼å¼ç‰¹æ€§**ï¼š
- âœ… è·æ¸¸å’Œæµ®å³¶å ±å‘Šæ ¼å¼**å·®ç•°å¾ˆå¤§**
- âœ… æ¬„ä½**å®Œå…¨æµ®å‹•**ï¼Œæ²’æœ‰å›ºå®šçµæ§‹
- âœ… å¯èƒ½éš¨æ™‚æ–°å¢/ä¿®æ”¹æ¬„ä½

**è³‡æ–™åº«è¨­è¨ˆï¼ˆæ¥µç°¡å½ˆæ€§ï¼‰**ï¼š
```
case_reports
â”œâ”€ id (UUID)
â”œâ”€ session_id (UUID)
â”œâ”€ client_id (UUID)
â”œâ”€ counselor_id (UUID)
â”œâ”€ tenant_id (VARCHAR)
â”œâ”€ created_by_app (VARCHAR)
â”œâ”€ report_content (JSONB)  â† å®Œå…¨å½ˆæ€§ï¼Œä»»æ„çµæ§‹
â”œâ”€ report_pdf_url (TEXT)   â† å¦‚æœæœ‰ PDF
â”œâ”€ status (VARCHAR)
â”œâ”€ created_at (TIMESTAMPTZ)
â””â”€ updated_at (TIMESTAMPTZ)
```

**report_content ç¯„ä¾‹ï¼ˆè·æ¸¸ï¼‰**ï¼š
```json
{
  "title": "å€‹æ¡ˆæ¦‚å¿µåŒ–å ±å‘Š",
  "sections": [
    {
      "name": "åŸºæœ¬è³‡æ–™",
      "fields": {
        "å¹´é½¡": "28æ­²",
        "è·æ¥­": "è»Ÿé«”å·¥ç¨‹å¸«"
      }
    },
    {
      "name": "ä¸»è¨´å•é¡Œ",
      "content": "è·æ¶¯è¿·èŒ«ï¼Œä¸çŸ¥é“æœªä¾†æ–¹å‘"
    },
    {
      "name": "å€‹æ¡ˆæ¦‚å¿µåŒ–",
      "framework": "4P åˆ†æ",
      "data": {
        "predisposing": ["å®Œç¾ä¸»ç¾©", "å®¶åº­æœŸå¾…é«˜"],
        "precipitating": ["å·¥ä½œå€¦æ€ ", "åŒå„•æ¯”è¼ƒ"],
        "perpetuating": ["è¿´é¿æ±ºç­–", "éåº¦æ€è€ƒ"],
        "protective": ["å­¸ç¿’èƒ½åŠ›å¼·", "æœ‰æ”¯æŒç³»çµ±"]
      }
    }
  ],
  "custom_fields": {
    "è«®è©¢æŠ€å·§": ["åŒç†å›æ‡‰", "èªçŸ¥é‡æ§‹"],
    "ç†è«–ä¾æ“š": "Super ç”Ÿæ¶¯ç™¼å±•ç†è«–"
  }
}
```

**report_content ç¯„ä¾‹ï¼ˆæµ®å³¶ï¼‰**ï¼š
```json
{
  "report_type": "å‡å­¸è¼”å°å ±å‘Š",
  "student_info": {
    "grade": "é«˜ä¸‰",
    "school": "XXé«˜ä¸­",
    "rank": "10/300"
  },
  "academic_analysis": {
    "strengths": ["æ•¸å­¸", "ç‰©ç†"],
    "weaknesses": ["è‹±æ–‡ä½œæ–‡"],
    "target_score": {
      "math": 95,
      "english": 85
    }
  },
  "university_planning": {
    "targets": ["å°å¤§é›»æ©Ÿ", "æ¸…å¤§è³‡å·¥", "äº¤å¤§è³‡å·¥"],
    "strategy": "ç”³è«‹å…¥å­¸ç‚ºä¸»ï¼ŒæŒ‡è€ƒç‚ºè¼”",
    "timeline": [
      {"date": "2024-11", "task": "æº–å‚™å‚™å¯©è³‡æ–™"},
      {"date": "2024-12", "task": "å®Œæˆè‡ªå‚³"}
    ]
  },
  "counseling_summary": "å­¸ç”Ÿå­¸ç¿’å‹•æ©Ÿå¼·ï¼Œå»ºè­°åŠ å¼·è‹±æ–‡ä½œæ–‡..."
}
```

**API å¯¦ä½œæ–¹å¼**ï¼š
1. `POST /api/v1/reports`
   - æ¥æ”¶ä»»æ„ JSON çµæ§‹
   - ç›´æ¥å­˜å…¥ `report_content` JSONB
   - ä¸é©—è­‰æ¬„ä½ï¼ˆå®Œå…¨å½ˆæ€§ï¼‰

2. `GET /api/v1/reports/{id}`
   - å›å‚³å®Œæ•´ JSONB
   - å‰ç«¯è‡ªè¡Œè§£æé¡¯ç¤º

3. å‰ç«¯æ ¹æ“š `tenant_id` æ±ºå®šé¡¯ç¤ºæ–¹å¼
   - è·æ¸¸ Appï¼šè§£æè·æ¸¸æ ¼å¼
   - æµ®å³¶ Appï¼šè§£ææµ®å³¶æ ¼å¼

**å„ªé»**ï¼š
- âœ… å®Œå…¨å½ˆæ€§ï¼Œä»»æ„æ¬„ä½
- âœ… ä¸éœ€è¦ migration å°±èƒ½æ–°å¢æ¬„ä½
- âœ… è·æ¸¸å’Œæµ®å³¶å¯ä»¥å®Œå…¨ä¸åŒçµæ§‹
- âœ… æœªä¾†æ ¼å¼è®Šæ›´ä¸å½±éŸ¿è³‡æ–™åº«

**ç¼ºé»**ï¼š
- âš ï¸ ç„¡æ³•åœ¨è³‡æ–™åº«å±¤ç´šé©—è­‰æ¬„ä½
- âš ï¸ æŸ¥è©¢ç‰¹å®šæ¬„ä½è¼ƒè¤‡é›œï¼ˆéœ€ç”¨ JSONB æŸ¥è©¢èªæ³•ï¼‰

**å»ºè­°**ï¼š
- åœ¨æ‡‰ç”¨å±¤ï¼ˆPythonï¼‰å®šç¾© Pydantic Schema é©—è­‰æ ¼å¼
- è³‡æ–™åº«å±¤ä¸å¼·åˆ¶ï¼Œä¿æŒå½ˆæ€§

---

## å·²ç¢ºèªäº‹é …ï¼ˆçºŒï¼‰

3. **tenant_id æ¬„ä½** âœ… ä¿ç•™
   - ä¿ç•™ `tenant_id` å’Œ `created_by_app` æ¬„ä½
   - ç”¨é€”ï¼šè³‡æ–™ä¾†æºæ¨™è¨˜ã€æœªä¾†æ“´å……ã€é™¤éŒ¯è¿½è¹¤
   - ä¸ç”¨æ–¼æ¬Šé™æ§åˆ¶ï¼ˆè³‡æ–™åº«å·²åˆ†é–‹ï¼‰

---

## å·²ç¢ºèªäº‹é …ï¼ˆçºŒï¼‰

4. **å ±å‘Šæ ¼å¼** âœ… å·®ç•°å¾ˆå¤§ï¼Œä¸”éƒ½æ˜¯æµ®å‹•çš„
   - è·æ¸¸å ±å‘Šï¼šæ¬„ä½æµ®å‹•ï¼Œæ ¼å¼ä¸å›ºå®š
   - æµ®å³¶å ±å‘Šï¼šæ¬„ä½æµ®å‹•ï¼Œæ ¼å¼ä¸å›ºå®š
   - **è§£æ±ºæ–¹æ¡ˆ**ï¼šå®Œå…¨ä½¿ç”¨ JSONBï¼Œä¸é è¨­ä»»ä½•å›ºå®šæ¬„ä½

---

## æœªä¾†æ“´å……è€ƒé‡

### ç¬¬ä¸‰å€‹æ¥­å‹™ç·šï¼ˆæœªç¢ºå®šï¼‰

**å¦‚æœæœ‰ç¬¬ä¸‰å€‹æ¥­å‹™ç·šï¼Œæ¶æ§‹å¯ç›´æ¥æ“´å……**ï¼š

1. å»ºç«‹æ–°çš„ Supabase å°ˆæ¡ˆï¼ˆåŒä¸€å€‹å¸³è™Ÿï¼‰
2. éƒ¨ç½²æ–°çš„ Cloud Run å¯¦ä¾‹
3. ä½¿ç”¨åŒä¸€ä»½ç¨‹å¼ç¢¼
4. è¨­å®šæ–°çš„ç’°å¢ƒè®Šæ•¸ï¼š`TENANT_ID=new_tenant`
5. è¨­å®šæ–°çš„ Domainï¼š`api.new-tenant.com`

**æˆæœ¬å¢åŠ **ï¼š
- Cloud Runï¼š+$5-20/æœˆ
- Supabaseï¼š$0ï¼ˆå…±ç”¨åŒä¸€å€‹ Pro å¸³è™Ÿï¼‰
- Domainï¼š+$1/æœˆ

**ä¸éœ€è¦ä¿®æ”¹ç¨‹å¼ç¢¼**ï¼Œåªéœ€è¦ï¼š
- æ–°å¢ç’°å¢ƒè®Šæ•¸é…ç½®
- æ–°å¢ CI/CD deploy job
- æ–°å¢è³‡æ–™åº« Schemaï¼ˆåŸ·è¡ŒåŒä¸€ä»½ SQLï¼‰

**ç¸½çµï¼šæ¶æ§‹å·²å…·å‚™æ“´å……æ€§** âœ…
