# ============================================================
# PRODUCTION ENVIRONMENT CONFIGURATION
# ============================================================
# This file documents all production environment variables
# Actual values are stored in GitHub Secrets (PROD_* prefix)
#
# Created: 2026-01-06
# Updated: 2026-01-29 (Added comprehensive configuration)
# Status: Production setup completed
#
# GitHub Secrets naming convention:
# - PROD_* prefix: Production-specific values
# - No prefix: Shared between Staging/Production
# ============================================================

# ============================================================
# APPLICATION SETTINGS
# ============================================================
PROD_APP_NAME="Career Counseling API"
PROD_APP_VERSION="0.1.0"
PROD_DEBUG=false
PROD_ENVIRONMENT=production

# API Configuration
PROD_API_V1_PREFIX="/api/v1"
PROD_HOST="0.0.0.0"
PROD_PORT=8000

# Base URL (éƒ¨ç½²å¾Œè‡ªå‹•å¡«å…¥ï¼Œæˆ–å¾ž Cloud Run ç²å–)
PROD_APP_URL=https://career-app-api-prod-978304030758.us-central1.run.app

# Default Tenant (for public pages)
PROD_DEFAULT_TENANT=island_parents

# ============================================================
# SECURITY & AUTHENTICATION
# ============================================================
# ðŸ” GitHub Secret: PROD_SECRET_KEY (ç¨ç«‹ç”¢ç”Ÿï¼Œèˆ‡ staging ä¸åŒ)
# Generate with: openssl rand -hex 32
PROD_SECRET_KEY=xxx

PROD_ALGORITHM=HS256
PROD_ACCESS_TOKEN_EXPIRE_MINUTES=129600  # 90 days
PROD_REFRESH_TOKEN_EXPIRE_DAYS=90

# Internal Portal Password
# ðŸ” GitHub Secret: PROD_INTERNAL_PORTAL_PASSWORD
PROD_INTERNAL_PORTAL_PASSWORD=xxx

# API Admin Key (for billing endpoints)
# ðŸ” GitHub Secret: PROD_API_ADMIN_KEY
PROD_API_ADMIN_KEY=xxx

# ============================================================
# DATABASE & STORAGE
# ============================================================
# âš ï¸ TODO: å»ºç«‹ç¨ç«‹çš„ Production Database
# ç›®å‰ç‹€æ…‹: æ²¿ç”¨ Staging Supabase PostgreSQL
# æœªä¾†è¨ˆç•«: å»ºç«‹ç¨ç«‹çš„ Production Supabase å°ˆæ¡ˆ

# PostgreSQL Database (Supabase)
# ðŸ” GitHub Secret: PROD_DATABASE_URL
PROD_DATABASE_URL=postgresql://postgres.xxx:password@aws-0-us-east-1.pooler.supabase.com:6543/postgres

# Direct Connection (for migrations)
# ðŸ” GitHub Secret: PROD_DATABASE_URL_DIRECT
PROD_DATABASE_URL_DIRECT=postgresql://postgres.xxx:password@aws-0-us-east-1.pooler.supabase.com:5432/postgres

PROD_DATABASE_POOL_SIZE=20
PROD_DATABASE_MAX_OVERFLOW=0

# Redis (Optional - for caching)
# PROD_REDIS_URL=redis://xxx

# ============================================================
# SUPABASE STORAGE
# ============================================================
# âš ï¸ TODO: å»ºç«‹ç¨ç«‹çš„ Production Supabase
# ç›®å‰ç‹€æ…‹: æ²¿ç”¨ Staging Supabase
# æœªä¾†è¨ˆç•«: å»ºç«‹ç¨ç«‹çš„ Production Supabase å°ˆæ¡ˆ

# ðŸ” GitHub Secret: PROD_SUPABASE_URL
PROD_SUPABASE_URL=https://xxx.supabase.co

# ðŸ” GitHub Secret: PROD_SUPABASE_ANON_KEY
PROD_SUPABASE_ANON_KEY=xxx

# ðŸ” GitHub Secret: PROD_SUPABASE_SERVICE_KEY
PROD_SUPABASE_SERVICE_KEY=xxx

PROD_SUPABASE_BUCKET=documents
PROD_STORAGE_TYPE=supabase

# ============================================================
# AI / LLM PROVIDERS (Shared Secrets)
# ============================================================
# These secrets are shared between Staging/Production (no PROD_ prefix)

# OpenAI (Embeddings, Whisper STT, RAG Chat)
# ðŸ” GitHub Secret: OPENAI_API_KEY
OPENAI_API_KEY=sk-proj-xxx
PROD_OPENAI_EMBEDDING_MODEL=text-embedding-3-small
PROD_OPENAI_CHAT_MODEL=gpt-4o-mini

# Gemini / Vertex AI (Primary LLM)
PROD_GEMINI_PROJECT_ID=groovy-iris-473015-h3
PROD_GEMINI_LOCATION=global
PROD_GEMINI_CHAT_MODEL=gemini-3-flash-preview

# LLM Provider Selection
PROD_DEFAULT_LLM_PROVIDER=gemini  # "openai" or "gemini"

# ElevenLabs (Text-to-Speech)
# ðŸ” GitHub Secret: ELEVEN_LABS_API_KEY
ELEVEN_LABS_API_KEY=sk_xxx

# Codeer AI Agent (Career Counseling)
# ðŸ” GitHub Secrets: CODEER_API_KEY, CODEER_DEFAULT_AGENT, CODEER_AGENT_*
CODEER_API_KEY=xxx
CODEER_DEFAULT_AGENT=default-agent-id
CODEER_AGENT_CAREER_01=agent-id-1
CODEER_AGENT_CAREER_02=agent-id-2

# ============================================================
# EMAIL / SMTP CONFIGURATION
# ============================================================
# å®˜æ–¹éƒµä»¶æœå‹™: CC_BDS@careercreator.tw
# Gmail æ‡‰ç”¨ç¨‹å¼å¯†ç¢¼è¨­ç½®: https://myaccount.google.com/apppasswords
# These secrets are shared between Staging/Production (no PROD_ prefix)

# ðŸ” GitHub Secret: SMTP_USER
SMTP_USER=CC_BDS@careercreator.tw

# ðŸ” GitHub Secret: SMTP_PASSWORD (Gmail æ‡‰ç”¨ç¨‹å¼å¯†ç¢¼)
SMTP_PASSWORD=your-16-char-app-password

# ðŸ” GitHub Secret: FROM_EMAIL
FROM_EMAIL=CC_BDS@careercreator.tw

PROD_SMTP_HOST=smtp.gmail.com
PROD_SMTP_PORT=587
PROD_BILLING_REPORT_EMAIL=dev02@careercreator.tw

# ============================================================
# RAG (Retrieval-Augmented Generation) SETTINGS
# ============================================================
PROD_VECTOR_DIMENSIONS=1536
PROD_DEFAULT_TOP_K=5
PROD_DEFAULT_CHUNK_SIZE=400
PROD_DEFAULT_CHUNK_OVERLAP=80
PROD_MAX_FILE_SIZE_MB=30
PROD_PIPELINE_TIMEOUT_SECONDS=180

# ============================================================
# GOOGLE CLOUD PLATFORM
# ============================================================
# Authentication: Workload Identity Federation (WIF)
# No service account key needed - uses OIDC token from GitHub Actions

# Google Cloud Storage (Optional - for backups)
# PROD_GCS_BUCKET=career-prod-backups
# PROD_GCS_PROJECT=groovy-iris-473015-h3

# BigQuery (for billing analytics)
PROD_BIGQUERY_PROJECT=groovy-iris-473015-h3
PROD_BIGQUERY_DATASET=billing_analytics_prod
PROD_BILLING_TABLE_ID=gcp_billing_export_prod

# ============================================================
# CORS & SECURITY
# ============================================================
# Production CORS: Only allow production frontend domains
PROD_CORS_ORIGINS=https://app.careercreator.tw,https://islandparents.com

# ============================================================
# LOGGING & MONITORING
# ============================================================
PROD_LOG_LEVEL=INFO
PROD_LOG_FILE=/var/log/app.log

# ============================================================
# CLOUD RUN DEPLOYMENT SETTINGS
# ============================================================
# Service Name: career-app-api-prod
# Region: us-central1
# Project ID: groovy-iris-473015-h3
#
# Resources:
# - CPU: 1
# - Memory: 512Mi
# - Min instances: 1 (always warm, no cold starts)
# - Max instances: 5 (auto-scaling)
# - Concurrency: 80 requests per instance
# - Timeout: 300s (5 minutes)
#
# Scaling Strategy:
# - Min 1 instance: Ensure 24/7 availability
# - Max 5 instances: Handle traffic spikes
# - Auto-scale based on CPU and concurrency
#
# Environment Variables Set in Cloud Run:
# - All PROD_* variables above
# - Shared secrets (OPENAI_API_KEY, SMTP_*, etc.)
#
# Health Check:
# - Path: /health
# - Initial delay: 10s
# - Period: 10s
# - Timeout: 5s
#
# Deployment Command (from CI/CD):
# gcloud run deploy career-app-api-prod \
#   --image=us-central1-docker.pkg.dev/.../career-backend:prod-latest \
#   --region=us-central1 \
#   --platform=managed \
#   --min-instances=1 \
#   --max-instances=5 \
#   --set-env-vars="ENVIRONMENT=production,DEBUG=false,..." \
#   --set-secrets="SECRET_KEY=PROD_SECRET_KEY:latest,..."

# ============================================================
# MONITORING & ALERTS
# ============================================================
# TODO: Setup monitoring alerts
# - Error rate > 5%
# - Response time > 2s
# - Instance count > 4
# - Database connection failures
# - Email sending failures

# ============================================================
# BACKUP & DISASTER RECOVERY
# ============================================================
# Database Backup:
# - Supabase automated daily backups (7-day retention)
# - Manual backup before major deployments
#
# Recovery Plan:
# 1. Restore from Supabase backup
# 2. Re-deploy previous Docker image
# 3. Verify all services operational
# 4. Monitor logs for 1 hour

# ============================================================
# SECURITY BEST PRACTICES
# ============================================================
# âœ… Never commit actual secrets to git
# âœ… Use GitHub Secrets for all sensitive values
# âœ… Rotate secrets every 90 days
# âœ… Separate production/staging secrets
# âœ… Use HTTPS only (enforced by Cloud Run)
# âœ… Enable CORS restrictions (production domains only)
# âœ… Monitor unusual access patterns
# âœ… Enable Cloud Run authentication for admin endpoints

# ============================================================
# DEPENDENCIES & VERSIONS
# ============================================================
# Python: 3.11+
# FastAPI: 0.115.6
# SQLAlchemy: 2.0.36
# Pydantic: 2.10.6
# PostgreSQL: 15 (Supabase)
# Poetry: 1.8.5

# ============================================================
# REFERENCES
# ============================================================
# - GitHub Repository: https://github.com/Youngger9765/career_ios_backend
# - Documentation: /docs/
# - API Documentation: https://career-app-api-prod-xxx.run.app/docs
# - Health Check: https://career-app-api-prod-xxx.run.app/health
